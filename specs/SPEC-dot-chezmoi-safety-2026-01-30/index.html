
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Minimalist ZSH workflow tools with smart dispatchers. Track work sessions, manage multiple projects, visualize productivity metrics with ADHD-friendly design.">
      
      
        <meta name="author" content="DT">
      
      
        <link rel="canonical" href="https://data-wise.github.io/flow-cli/specs/SPEC-dot-chezmoi-safety-2026-01-30/">
      
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>SPEC: Dot Dispatcher - Chezmoi Safety & Health Enhancements - Flow CLI Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../stylesheets/adhd-colors.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="brown" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#spec-dot-dispatcher-chezmoi-safety-health-enhancements" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Flow CLI Documentation" class="md-header__button md-logo" aria-label="Flow CLI Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Flow CLI Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SPEC: Dot Dispatcher - Chezmoi Safety &amp; Health Enhancements
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="brown" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="brown" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/data-wise/flow-cli" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    flow-cli
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../DOC-INDEX/" class="md-tabs__link">
        
  
  
    
  
  üìö Documentation Hub

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting-started/choose-your-path/" class="md-tabs__link">
          
  
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tutorials/" class="md-tabs__link">
          
  
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../teaching/" class="md-tabs__link">
          
  
  
  üéì Teaching

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/WORKFLOWS-QUICK-WINS/" class="md-tabs__link">
          
  
  
  Workflows

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/00-START-HERE/" class="md-tabs__link">
          
  
  
  Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../conventions/adhd/" class="md-tabs__link">
          
  
  
  Visuals

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../help/00-START-HERE/" class="md-tabs__link">
          
  
  
  Help & Quick Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../reference/MASTER-API-REFERENCE/" class="md-tabs__link">
          
  
  
  Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../commands/flow/" class="md-tabs__link">
          
  
  
  Commands

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/TESTING/" class="md-tabs__link">
          
  
  
  Testing

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/DEVELOPER-GUIDE/" class="md-tabs__link">
          
  
  
  Development

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../architecture/DOT-SAFETY-ARCHITECTURE/" class="md-tabs__link">
          
  
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../planning/V4.3-ROADMAP/" class="md-tabs__link">
          
  
  
  Planning

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Flow CLI Documentation" class="md-nav__button md-logo" aria-label="Flow CLI Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Flow CLI Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/data-wise/flow-cli" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    flow-cli
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DOC-INDEX/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üìö Documentation Hub
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/choose-your-path/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üéØ Choose Your Path
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/quick-start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ‚ö° Quick Start (5-min)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üì¶ Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/im-stuck/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üÜò I'm Stuck
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/00-welcome/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ‚ùì FAQ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/faq-dependencies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ‚ùì FAQ - Dependencies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üîÑ Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CHANGELOG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üìú Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview & Learning Path
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/01-first-session/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. Your First Session
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/02-multiple-projects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. Multiple Projects
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/03-status-visualizations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. Status Visualizations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/04-web-dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. Web Dashboard
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/05-ai-commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. AI-Powered Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/06-dopamine-features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6. Dopamine Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/07-sync-command/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7. Sync Command
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/08-git-feature-workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8. Git Feature Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/09-worktrees/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    9. Worktrees
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/10-cc-dispatcher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10. CC Dispatcher
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/11-tm-dispatcher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    11. TM Dispatcher
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/12-dot-dispatcher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    12. DOT Dispatcher
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/13-prompt-dispatcher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    13. Prompt Dispatcher
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/15-nvim-quick-start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    15. Nvim Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/16-vim-motions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    16. Vim Motions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/17-lazyvim-basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    17. LazyVim Basics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/18-lazyvim-showcase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    18. LazyVim Showcase
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/22-plugin-optimization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    22. Plugin Optimization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/23-token-automation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    23. Token Automation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    üéì Teaching
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    üéì Teaching
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../teaching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/14-teach-dispatcher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/teach-init/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setup & Initialization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/TEACHING-WORKFLOW-V3-GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Complete v3.0 Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Core Workflows
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core Workflows
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/INTELLIGENT-CONTENT-ANALYSIS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Content Creation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/19-teaching-git-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Git Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/TEACHING-WORKFLOW-VISUAL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Visual Workflow Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/21-teach-analyze/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Content Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/28-teach-prompt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI-Powered Prompts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/24-template-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Template Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/26-latex-macros/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LaTeX Macros
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/27-lesson-plan-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lesson Plans
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/25-lesson-plan-migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lesson Plan Migration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/BACKUP-SYSTEM-GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backup & Safety
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/teach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Command Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_5_2" id="__nav_5_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Quick Reference Cards
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Quick Reference Cards
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/REFCARD-TEMPLATES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Templates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/REFCARD-MACROS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LaTeX Macros
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/REFCARD-TEACH-PLAN/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lesson Plans
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/REFCARD-PROMPTS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Prompts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/HELP-SYSTEM-GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Help System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Advanced
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Advanced
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6_1" >
        
          
          <label class="md-nav__link" for="__nav_5_6_1" id="__nav_5_6_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Scholar Integration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Scholar Integration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/scholar-enhancement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview & Learning Path
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/scholar-enhancement/01-getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Level 1 - Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/scholar-enhancement/02-intermediate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Level 2 - Intermediate
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/scholar-enhancement/03-advanced/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Level 3 - Advanced
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/COURSE-PLANNING-BEST-PRACTICES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Course Planning Best Practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/TEACHING-V3-MIGRATION-GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Migration from v2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/TEACHING-SYSTEM-ARCHITECTURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    System Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6_5" >
        
          
          <label class="md-nav__link" for="__nav_5_6_5" id="__nav_5_6_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Course Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Course Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/course-planning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/course-planning/intermediate-stats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    STAT 545 (Graduate)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Legacy (v2.x)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Legacy (v2.x)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/TEACHING-WORKFLOW/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    v2 Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/TEACHING-COMMANDS-DETAILED/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Commands Deep Dive
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/TEACHING-DATES-GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dates Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/TEACHING-DEMO-GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Demo & GIFs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Workflows
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Workflows
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/WORKFLOWS-QUICK-WINS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Wins
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/08-git-feature-workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8. Git Feature Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/WORKTREE-WORKFLOW/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Worktree Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/DOT-WORKFLOW/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dotfile Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/ALIAS-MANAGEMENT-WORKFLOW/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Alias Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/YOLO-MODE-WORKFLOW/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    YOLO Mode
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/WORKFLOW-TUTORIAL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow Tutorial
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/PLUGIN-MANAGEMENT-WORKFLOW/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Plugin Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/CONFIG-MANAGEMENT-WORKFLOW/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Config Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/00-START-HERE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Start Here
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/ZSH-PLUGIN-ECOSYSTEM-GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üîå ZSH Plugin Ecosystem
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/TOKEN-MANAGEMENT-COMPLETE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üîê Token Management Complete Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    üöÄ Quarto Workflow Phase 2
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    üöÄ Quarto Workflow Phase 2
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/QUARTO-WORKFLOW-PHASE-2-GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Phase 2 Complete Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/CHEZMOI-SAFETY-GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üõ°Ô∏è Chezmoi Safety Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/DOTFILE-MANAGEMENT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dotfile Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/DOPAMINE-FEATURES-GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dopamine Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/MERMAID-DIAGRAMS-QUICK-START/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mermaid Diagrams
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/ENHANCED-HELP-QUICK-START/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Enhanced Help
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/MONOREPO-COMMANDS-TUTORIAL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Monorepo Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/PROJECT-SCOPE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Project Scope
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Visuals
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Visuals
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../conventions/adhd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Documentation Templates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../conventions/adhd/GIF-GUIDELINES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GIF Creation Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Help & Quick Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Help & Quick Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../help/00-START-HERE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üè† Start Here
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../help/QUICK-REFERENCE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ‚ö° Quick Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/REFCARD-TOKEN-SECRETS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üîê Token & Secrets Quick Ref
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/REFCARD-DOT-SAFETY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üõ°Ô∏è Chezmoi Safety Quick Ref
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../help/WORKFLOWS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üîß Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../help/TROUBLESHOOTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ü©∫ Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../troubleshooting/CLAUDE-CODE-ENVIRONMENT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ü§ñ Claude Code Environment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/MASTER-API-REFERENCE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üìö Master API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/MASTER-DISPATCHER-GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üéØ Master Dispatcher Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/MASTER-ARCHITECTURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üèóÔ∏è Master Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/API-DOT-SAFETY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üõ°Ô∏è Chezmoi Safety API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DOC-DASHBOARD/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üìä Documentation Dashboard
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Commands
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Commands
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/flow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    flow (main)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/work/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    work
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/finish/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    finish
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/hop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    hop
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/pick/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    pick
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/alias/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    alias
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/capture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    capture (win/yay/catch)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/timer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    timer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/morning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    morning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/dash/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    dash
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/status/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    status
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/sync/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    sync
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/doctor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    doctor
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    config
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/plugin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    plugin
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/ai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ai
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/do/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    do
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    install
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    upgrade
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commands/dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    dashboard
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Testing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Testing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/TESTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üß™ Testing Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/SAFE-TESTING-v5.9.0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Safe Testing (v5.9.0)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../testing/DOG-FEEDING-TEST-README/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Interactive Dog Test
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../testing/INTERACTIVE-TEST-GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Interactive Test Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/DEVELOPER-GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üõ†Ô∏è Developer Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/CONTRIBUTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/BRANCH-WORKFLOW/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Branch Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/PR-WORKFLOW-GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PR Workflow Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/DOCUMENTATION-STYLE-GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Documentation Style Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ZSH-DEVELOPMENT-GUIDELINES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Guidelines
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CONVENTIONS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Conventions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PHILOSOPHY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Philosophy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/DOT-SAFETY-ARCHITECTURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üõ°Ô∏è Chezmoi Safety
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/DOCTOR-TOKEN-ARCHITECTURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üîê Doctor Token System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/TEACHING-DATES-ARCHITECTURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üìÖ Teaching Dates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/SCHOLAR-ENHANCEMENT-ARCHITECTURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    üéì Scholar Enhancement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_15" >
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Planning
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    Planning
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../planning/V4.3-ROADMAP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    v4.3.0+ Roadmap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../planning/INSTALL-IMPROVEMENTS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Install Improvements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problem-statement" class="md-nav__link">
    <span class="md-ellipsis">
      
        Problem Statement
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Problem Statement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue-1-redundant-git-directory-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue 1: Redundant .git Directory Tracking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-2-manual-chezmoiignore-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue 2: Manual .chezmoiignore Management
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-3-no-repository-health-visibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue 3: No Repository Health Visibility
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-4-no-safety-checks-before-add" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue 4: No Safety Checks Before Add
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#primary-user-story" class="md-nav__link">
    <span class="md-ellipsis">
      
        Primary User Story
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secondary-user-stories" class="md-nav__link">
    <span class="md-ellipsis">
      
        Secondary User Stories
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Secondary User Stories">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-git-directory-detection" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Git Directory Detection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-ignore-pattern-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Ignore Pattern Management
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-repository-size-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Repository Size Analysis
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-preview-before-add" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Preview Before Add
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-doctor-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Doctor Integration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-auto-suggestions-for-common-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Auto-Suggestions for Common Patterns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#technical-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Technical Requirements
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Technical Requirements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-targets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Targets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        File Structure
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cross-platform-compatibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cross-Platform Compatibility
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cross-Platform Compatibility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue-bsd-vs-gnu-command-differences" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue: BSD vs GNU Command Differences
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Issue: BSD vs GNU Command Differences">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-file-size-detection" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. File Size Detection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-ignore-pattern-removal" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Ignore Pattern Removal
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-human-readable-sizes" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Human-Readable Sizes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-optimizations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Optimizations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance Optimizations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue-find-performance-on-large-directories" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue: find Performance on Large Directories
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution-1-add-timeout-wrapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution 1: Add Timeout Wrapper
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution-2-optimize-for-git-repos" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution 2: Optimize for Git Repos
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-targets-updated" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Targets (Updated)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Integration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integration-with-existing-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration with Existing Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integration with Existing Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-leverage-existing-cache-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Leverage Existing Cache Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-doctor-integration-point" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Doctor Integration Point
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-update-dot-status-command" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Update dot status Command
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-edge-case-symlink-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Edge Case: Symlink Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-integration-with-gitignore" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Integration with .gitignore
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test Infrastructure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Test Infrastructure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integration-with-existing-test-framework" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration with Existing Test Framework
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-with-testsrun-allsh" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration with ./tests/run-all.sh
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-guide-for-existing-users" class="md-nav__link">
    <span class="md-ellipsis">
      
        Migration Guide for Existing Users
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Migration Guide for Existing Users">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-users-who-already-have-git-directories-tracked" class="md-nav__link">
    <span class="md-ellipsis">
      
        For Users Who Already Have .git Directories Tracked
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="For Users Who Already Have .git Directories Tracked">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-audit-your-repository" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Audit Your Repository
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-add-ignore-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Add Ignore Patterns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-remove-tracked-git-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Remove Tracked .git Files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-commit-changes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Commit Changes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-verify-cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Verify Cleanup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-6-re-add-directories-clean" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6: Re-add Directories (Clean)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-patterns-to-add-to-chezmoiignore" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Patterns to Add to .chezmoiignore
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troubleshooting-migration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting Migration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-plan" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Plan
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Plan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-0-foundation-cross-platform-days-1-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 0: Foundation &amp; Cross-Platform (Days 1-2)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase 0: Foundation &amp; Cross-Platform (Days 1-2)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#01-cross-platform-helpers" class="md-nav__link">
    <span class="md-ellipsis">
      
        0.1 Cross-Platform Helpers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#02-cache-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      
        0.2 Cache Infrastructure
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-1-safety-features-week-1-days-3-5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 1: Safety Features (Week 1, Days 3-5)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase 1: Safety Features (Week 1, Days 3-5)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-git-directory-detection-with-performance-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1 Git Directory Detection (with Performance Optimization)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-preview-before-add" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.2 Preview Before Add
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-ignore-management-commands" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.3 Ignore Management Commands
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-health-visibility-week-2-days-6-8" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2: Health &amp; Visibility (Week 2, Days 6-8)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase 2: Health &amp; Visibility (Week 2, Days 6-8)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-repository-size-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 Repository Size Analysis
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-doctor-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 Doctor Integration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-integration-architecture-week-2-days-9-10" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 3: Integration &amp; Architecture (Week 2, Days 9-10)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase 3: Integration &amp; Architecture (Week 2, Days 9-10)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-doctor-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 Doctor Integration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-update-dot-status-command" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 Update dot status Command
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-gitignore-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3 .gitignore Integration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-4-testing-documentation-week-2-days-11-14" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 4: Testing &amp; Documentation (Week 2, Days 11-14)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase 4: Testing &amp; Documentation (Week 2, Days 11-14)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-test-suite-creation" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 Test Suite Creation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-completions-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 Completions &amp; Documentation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#31-update-completions" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 Update Completions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-update-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 Update Documentation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Strategy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unit-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Unit Tests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration Tests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-test-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Manual Test Checklist
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documentation-updates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Documentation Updates
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Documentation Updates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quick-reference-card" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quick Reference Card
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#help-text" class="md-nav__link">
    <span class="md-ellipsis">
      
        Help Text
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#success-criteria" class="md-nav__link">
    <span class="md-ellipsis">
      
        Success Criteria
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Success Criteria">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#functional-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functional Requirements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-functional-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Non-Functional Requirements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-experience" class="md-nav__link">
    <span class="md-ellipsis">
      
        User Experience
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rollback-plan" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rollback Plan
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#frequently-asked-questions-faq" class="md-nav__link">
    <span class="md-ellipsis">
      
        Frequently Asked Questions (FAQ)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Frequently Asked Questions (FAQ)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general-questions" class="md-nav__link">
    <span class="md-ellipsis">
      
        General Questions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#technical-questions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Technical Questions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-enhancements-out-of-scope" class="md-nav__link">
    <span class="md-ellipsis">
      
        Future Enhancements (Out of Scope)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Future Enhancements (Out of Scope)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-4-candidates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 4 Candidates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-opportunities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration Opportunities
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix" class="md-nav__link">
    <span class="md-ellipsis">
      
        Appendix
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Appendix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-outputs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example Outputs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example Outputs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dot-add-with-git-detection" class="md-nav__link">
    <span class="md-ellipsis">
      
        dot add with git detection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dot-size-output" class="md-nav__link">
    <span class="md-ellipsis">
      
        dot size output
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flow-doctor-with-chezmoi-checks" class="md-nav__link">
    <span class="md-ellipsis">
      
        flow doctor with chezmoi checks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/data-wise/flow-cli/edit/main/docs/specs/SPEC-dot-chezmoi-safety-2026-01-30.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="spec-dot-dispatcher-chezmoi-safety-health-enhancements">SPEC: Dot Dispatcher - Chezmoi Safety &amp; Health Enhancements<a class="headerlink" href="#spec-dot-dispatcher-chezmoi-safety-health-enhancements" title="Permanent link">&para;</a></h1>
<p><strong>Status:</strong> Draft (Awaiting Approval - Updated with Review Feedback)
<strong>Created:</strong> 2026-01-30
<strong>Updated:</strong> 2026-01-30 (Incorporated orchestrator review recommendations)
<strong>Target Release:</strong> flow-cli v6.0.0
<strong>Estimated Effort:</strong> 16-20 hours over 2 weeks
<strong>Dependencies:</strong> flow-cli v5.23.0+, chezmoi v2.69.3+
<strong>Review Score:</strong> 4.3/5.0 (Approve with revisions)</p>
<hr />
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>Enhance the <code>dot</code> dispatcher with intelligent safety features to prevent redundant file tracking (e.g., .git directories), provide repository health visibility, and streamline ignore pattern management. These improvements address real issues discovered during chezmoi setup cleanup (196KB of redundant nvim/.git files tracked).</p>
<p><strong>Key Benefits:</strong>
- <strong>Prevention:</strong> Auto-detects problematic patterns before they're committed
- <strong>Visibility:</strong> Repository size analysis identifies bloat proactively
- <strong>Convenience:</strong> User-friendly ignore pattern management
- <strong>Health:</strong> Integrated doctor checks catch issues early
- <strong>Safety:</strong> Preview-before-add prevents costly mistakes</p>
<hr />
<h2 id="problem-statement">Problem Statement<a class="headerlink" href="#problem-statement" title="Permanent link">&para;</a></h2>
<h3 id="issue-1-redundant-git-directory-tracking">Issue 1: Redundant .git Directory Tracking<a class="headerlink" href="#issue-1-redundant-git-directory-tracking" title="Permanent link">&para;</a></h3>
<p><strong>Discovery:</strong> While setting up CLAUDE.md in <code>~/.config</code>, found 30 .git metadata files (196KB) from LazyVim starter template accidentally tracked by chezmoi.</p>
<p><strong>Impact:</strong>
- Bloated chezmoi repository (196KB for single .git directory)
- Sync conflicts when LazyVim updates its git state
- Confusion between nvim config tracking vs LazyVim template tracking
- No warning during <code>chezmoi add ~/.config/nvim</code></p>
<p><strong>Root Cause:</strong> <code>chezmoi add</code> doesn't detect or warn about nested .git directories</p>
<h3 id="issue-2-manual-chezmoiignore-management">Issue 2: Manual .chezmoiignore Management<a class="headerlink" href="#issue-2-manual-chezmoiignore-management" title="Permanent link">&para;</a></h3>
<p><strong>Discovery:</strong> Had to manually create <code>.chezmoiignore</code> and add <code>**/.git</code> patterns</p>
<p><strong>Impact:</strong>
- Requires knowledge of chezmoi ignore syntax
- No discovery mechanism for what patterns are active
- No validation of patterns (typos persist silently)
- Manual file editing (not integrated into <code>dot</code> workflow)</p>
<h3 id="issue-3-no-repository-health-visibility">Issue 3: No Repository Health Visibility<a class="headerlink" href="#issue-3-no-repository-health-visibility" title="Permanent link">&para;</a></h3>
<p><strong>Discovery:</strong> Only discovered the 196KB bloat by manually checking git log and file sizes</p>
<p><strong>Impact:</strong>
- No proactive monitoring of repository size
- Large files go unnoticed until sync becomes slow
- No visibility into what chezmoi is tracking
- Reactive rather than proactive management</p>
<h3 id="issue-4-no-safety-checks-before-add">Issue 4: No Safety Checks Before Add<a class="headerlink" href="#issue-4-no-safety-checks-before-add" title="Permanent link">&para;</a></h3>
<p><strong>Discovery:</strong> <code>dot add ~/.config/nvim</code> silently added 45 files including all .git metadata</p>
<p><strong>Impact:</strong>
- No preview of what will be tracked
- No warnings about generated files (.log, .sqlite, .db)
- No size warnings for large files
- Trust-based operation (can't verify before committing)</p>
<hr />
<h2 id="primary-user-story">Primary User Story<a class="headerlink" href="#primary-user-story" title="Permanent link">&para;</a></h2>
<p><strong>As a</strong> flow-cli user managing dotfiles with chezmoi,
<strong>I want</strong> intelligent safety checks and repository health visibility,
<strong>So that</strong> I never accidentally track bloated or inappropriate files.</p>
<p><strong>Acceptance Criteria:</strong>
1. <code>dot add &lt;path&gt;</code> detects .git directories and warns before adding
2. <code>dot add &lt;path&gt;</code> shows preview with file count, size, warnings
3. <code>dot ignore add &lt;pattern&gt;</code> adds patterns without manual file editing
4. <code>dot ignore list</code> shows all active ignore patterns
5. <code>dot size</code> reports repository size and identifies bloat
6. <code>flow doctor</code> includes chezmoi health checks (large files, .git dirs, .chezmoiignore existence)
7. Auto-suggestions for common generated files (.log, .sqlite, .db, .cache)
8. All operations maintain &lt; 3s performance target
9. Zero false positives in git directory detection
10. Help text updated with new commands</p>
<hr />
<h2 id="secondary-user-stories">Secondary User Stories<a class="headerlink" href="#secondary-user-stories" title="Permanent link">&para;</a></h2>
<h3 id="1-git-directory-detection">1. Git Directory Detection<a class="headerlink" href="#1-git-directory-detection" title="Permanent link">&para;</a></h3>
<p><strong>As a</strong> user adding a directory to chezmoi,
<strong>I want</strong> automatic detection of .git directories,
<strong>So that</strong> I don't accidentally track git metadata.</p>
<p><strong>Scenario:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>$<span class="w"> </span>dot<span class="w"> </span>add<span class="w"> </span>~/.config/ghostty
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>‚ö†Ô∏è<span class="w">  </span>Git<span class="w"> </span>directory<span class="w"> </span>detected<span class="w"> </span><span class="k">in</span><span class="w"> </span>/Users/dt/.config/ghostty
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span>Git<span class="w"> </span>metadata<span class="w"> </span>should<span class="w"> </span>not<span class="w"> </span>be<span class="w"> </span>tracked<span class="w"> </span>by<span class="w"> </span>chezmoi.
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>Auto-create<span class="w"> </span>ignore<span class="w"> </span>rule?<span class="w"> </span><span class="o">(</span>Y/n<span class="o">)</span>:<span class="w"> </span>y
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>‚úì<span class="w"> </span>Added<span class="w"> </span>.config/ghostty/.git<span class="w"> </span>to<span class="w"> </span>.chezmoiignore
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>‚úì<span class="w"> </span>Added<span class="w"> </span>.config/ghostty/.git/**<span class="w"> </span>to<span class="w"> </span>.chezmoiignore
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>Adding<span class="w"> </span>.config/ghostty<span class="w"> </span>to<span class="w"> </span>chezmoi...
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>‚úì<span class="w"> </span>Added<span class="w"> </span><span class="m">12</span><span class="w"> </span>files<span class="w"> </span><span class="o">(</span>skipped<span class="w"> </span><span class="m">45</span><span class="w"> </span>.git<span class="w"> </span>files<span class="o">)</span>
</code></pre></div></p>
<p><strong>Acceptance:</strong>
- Detects both <code>path/.git</code> and nested <code>path/subdir/.git</code>
- Offers to auto-create ignore patterns
- Shows how many files were skipped
- Completes in &lt; 2s even with large directories</p>
<h3 id="2-ignore-pattern-management">2. Ignore Pattern Management<a class="headerlink" href="#2-ignore-pattern-management" title="Permanent link">&para;</a></h3>
<p><strong>As a</strong> user managing ignore patterns,
<strong>I want</strong> commands to add/list/remove patterns,
<strong>So that</strong> I don't need to manually edit .chezmoiignore.</p>
<p><strong>Scenario:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Add pattern</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>$<span class="w"> </span>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;**/.git&quot;</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>‚úì<span class="w"> </span>Added<span class="w"> </span>pattern<span class="w"> </span>to<span class="w"> </span>.chezmoiignore:<span class="w"> </span>**/.git
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="c1"># List patterns</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>$<span class="w"> </span>dot<span class="w"> </span>ignore<span class="w"> </span>list
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>.chezmoiignore<span class="w"> </span>patterns:
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">  </span><span class="m">1</span><span class="w">  </span>**/.git
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">  </span><span class="m">2</span><span class="w">  </span>**/.git/**
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">  </span><span class="m">3</span><span class="w">  </span>*.log
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">  </span><span class="m">4</span><span class="w">  </span>*.sqlite
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">  </span><span class="m">5</span><span class="w">  </span>.DS_Store
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="c1"># Remove pattern</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>$<span class="w"> </span>dot<span class="w"> </span>ignore<span class="w"> </span>remove<span class="w"> </span><span class="s2">&quot;*.log&quot;</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>‚úì<span class="w"> </span>Removed<span class="w"> </span>pattern<span class="w"> </span>from<span class="w"> </span>.chezmoiignore:<span class="w"> </span>*.log
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="c1"># Edit directly (fallback)</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>$<span class="w"> </span>dot<span class="w"> </span>ignore<span class="w"> </span>edit
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="c1"># Opens .chezmoiignore in $EDITOR</span>
</code></pre></div></p>
<p><strong>Acceptance:</strong>
- <code>add</code> creates .chezmoiignore if missing
- <code>list</code> shows numbered list for easy reference
- <code>remove</code> validates pattern exists before removing
- <code>edit</code> opens in $EDITOR with syntax highlighting</p>
<h3 id="3-repository-size-analysis">3. Repository Size Analysis<a class="headerlink" href="#3-repository-size-analysis" title="Permanent link">&para;</a></h3>
<p><strong>As a</strong> user maintaining a chezmoi repository,
<strong>I want</strong> visibility into repository size and bloat,
<strong>So that</strong> I can identify and fix tracking issues proactively.</p>
<p><strong>Scenario:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>$<span class="w"> </span>dot<span class="w"> </span>size
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>Chezmoi<span class="w"> </span>Repository<span class="w"> </span>Size
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>Total:<span class="w"> </span><span class="m">1</span>.4<span class="w"> </span>MB
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>Top<span class="w"> </span><span class="m">10</span><span class="w"> </span>largest<span class="w"> </span>files:
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">  </span>‚ö†Ô∏è<span class="w">  </span><span class="m">196</span><span class="w"> </span>KB<span class="w">  </span>dot_config/nvim/dot_git/objects/pack/pack-*.pack
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">              </span><span class="o">(</span>Git<span class="w"> </span>metadata<span class="w"> </span>-<span class="w"> </span>should<span class="w"> </span>be<span class="w"> </span>ignored<span class="o">)</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">      </span><span class="m">7</span>.4<span class="w"> </span>KB<span class="w">  </span>dot_config/wezterm/wezterm.lua
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">      </span><span class="m">6</span>.9<span class="w"> </span>KB<span class="w">  </span>dot_config/CLAUDE.md
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">      </span><span class="m">3</span>.4<span class="w"> </span>KB<span class="w">  </span>dot_config/starship.toml
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">      </span><span class="m">3</span>.1<span class="w"> </span>KB<span class="w">  </span>dot_config/GEMINI.md
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">      </span><span class="m">1</span>.4<span class="w"> </span>KB<span class="w">  </span>dot_config/nvim/lazyvim.json
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">      </span><span class="m">1</span>.2<span class="w"> </span>KB<span class="w">  </span>dot_config/ghostty/config
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">      </span><span class="m">0</span>.8<span class="w"> </span>KB<span class="w">  </span>dot_config/git/ignore
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">      </span><span class="m">0</span>.5<span class="w"> </span>KB<span class="w">  </span>dot_config/git/gitk
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">      </span><span class="m">0</span>.4<span class="w"> </span>KB<span class="w">  </span>dot_zshrc
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>‚ö†<span class="w"> </span>Found<span class="w"> </span><span class="m">1</span><span class="w"> </span>nested<span class="w"> </span>.git<span class="w"> </span>directory<span class="w"> </span><span class="o">(</span>should<span class="w"> </span>be<span class="w"> </span>ignored<span class="o">)</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="w">  </span>Run<span class="w"> </span><span class="s1">&#39;dot ignore add &quot;**/.git&quot;&#39;</span><span class="w"> </span>to<span class="w"> </span>fix
</code></pre></div></p>
<p><strong>Acceptance:</strong>
- Shows total repository size (human-readable)
- Lists top 10 files by size
- Highlights .git directories with warning
- Suggests fix commands for detected issues
- Excludes chezmoi's own .git directory from warnings</p>
<h3 id="4-preview-before-add">4. Preview Before Add<a class="headerlink" href="#4-preview-before-add" title="Permanent link">&para;</a></h3>
<p><strong>As a</strong> user adding files to chezmoi,
<strong>I want</strong> a preview of what will be tracked,
<strong>So that</strong> I can verify before committing.</p>
<p><strong>Scenario:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>$<span class="w"> </span>dot<span class="w"> </span>add<span class="w"> </span>~/.config/obs
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>Preview:<span class="w"> </span>dot<span class="w"> </span>add<span class="w"> </span>/Users/dt/.config/obs
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>Files<span class="w"> </span>to<span class="w"> </span>add:<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>Total<span class="w"> </span>size:<span class="w"> </span><span class="m">163</span><span class="w"> </span>KB
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>‚ö†Ô∏è<span class="w">  </span>Generated<span class="w"> </span>files<span class="w"> </span>detected:
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">  </span>-<span class="w"> </span>vault_db.sqlite<span class="w"> </span><span class="o">(</span><span class="m">163</span><span class="w"> </span>KB<span class="o">)</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">  </span>-<span class="w"> </span>obs.log<span class="w"> </span><span class="o">(</span><span class="m">7</span><span class="w"> </span>KB<span class="o">)</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>üí°<span class="w"> </span>Consider<span class="w"> </span>excluding:
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">  </span>-<span class="w"> </span>*.sqlite<span class="w"> </span><span class="o">(</span>databases<span class="o">)</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">  </span>-<span class="w"> </span>*.log<span class="w"> </span><span class="o">(</span>logs<span class="o">)</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>Auto-add<span class="w"> </span>ignore<span class="w"> </span>patterns?<span class="w"> </span><span class="o">(</span>Y/n<span class="o">)</span>:<span class="w"> </span>y
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>‚úì<span class="w"> </span>Added<span class="w"> </span>*.sqlite<span class="w"> </span>to<span class="w"> </span>.chezmoiignore
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>‚úì<span class="w"> </span>Added<span class="w"> </span>*.log<span class="w"> </span>to<span class="w"> </span>.chezmoiignore
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>Proceed<span class="w"> </span>with<span class="w"> </span>add?<span class="w"> </span><span class="o">(</span>Y/n<span class="o">)</span>:<span class="w"> </span>y
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>‚úì<span class="w"> </span>Added<span class="w"> </span><span class="m">2</span><span class="w"> </span>files<span class="w"> </span><span class="o">(</span>skipped<span class="w"> </span><span class="m">2</span><span class="w"> </span>generated<span class="w"> </span>files<span class="o">)</span>
</code></pre></div></p>
<p><strong>Acceptance:</strong>
- Shows file count and total size before adding
- Warns about large files (&gt;50KB)
- Detects generated files (.log, .sqlite, .db, .cache)
- Offers to auto-add ignore patterns
- Requires explicit confirmation before adding
- Can be bypassed with <code>dot add --no-preview &lt;path&gt;</code></p>
<h3 id="5-doctor-integration">5. Doctor Integration<a class="headerlink" href="#5-doctor-integration" title="Permanent link">&para;</a></h3>
<p><strong>As a</strong> user running flow doctor,
<strong>I want</strong> chezmoi health checks included,
<strong>So that</strong> I catch issues before they become problems.</p>
<p><strong>Scenario:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>$<span class="w"> </span>flow<span class="w"> </span>doctor
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>System<span class="w"> </span>Health<span class="w"> </span>Check
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>...
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>Dotfile<span class="w"> </span>Management:
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">  </span>‚úì<span class="w"> </span>chezmoi<span class="w"> </span>installed<span class="w"> </span><span class="o">(</span>v2.69.3<span class="o">)</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">  </span>‚úì<span class="w"> </span>Repository<span class="w"> </span>initialized
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">  </span>‚úì<span class="w"> </span>Connected<span class="w"> </span>to<span class="w"> </span>remote<span class="w"> </span><span class="o">(</span>github.com/data-wise/dotfiles<span class="o">)</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">  </span>‚úì<span class="w"> </span>.chezmoiignore<span class="w"> </span>configured<span class="w"> </span><span class="o">(</span><span class="m">5</span><span class="w"> </span>patterns<span class="o">)</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">  </span>‚úì<span class="w"> </span><span class="m">47</span><span class="w"> </span>files<span class="w"> </span>managed
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">  </span>‚úì<span class="w"> </span>Repository<span class="w"> </span>size:<span class="w"> </span><span class="m">1</span>.2<span class="w"> </span>MB<span class="w"> </span><span class="o">(</span>healthy<span class="o">)</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">  </span>‚ö†<span class="w"> </span>Large<span class="w"> </span>file<span class="w"> </span>tracked:<span class="w"> </span>dot_config/nvim/lazy-lock.json<span class="w"> </span><span class="o">(</span><span class="m">6</span>.3<span class="w"> </span>KB<span class="o">)</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">     </span>Consider:<span class="w"> </span>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;nvim/lazy-lock.json&quot;</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">  </span>‚úì<span class="w"> </span>No<span class="w"> </span>nested<span class="w"> </span>.git<span class="w"> </span>directories<span class="w"> </span>tracked
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">  </span>‚úì<span class="w"> </span>Last<span class="w"> </span>sync:<span class="w"> </span><span class="m">2</span><span class="w"> </span>hours<span class="w"> </span>ago<span class="w"> </span><span class="o">(</span>synced<span class="o">)</span>
</code></pre></div></p>
<p><strong>Acceptance:</strong>
- Checks chezmoi installation and version
- Verifies repository initialization
- Checks remote connection
- Validates .chezmoiignore exists and is not empty
- Reports managed file count
- Checks repository size (warns if &gt; 5MB)
- Detects large files (&gt; 100KB)
- Detects nested .git directories
- Shows sync status and last sync time</p>
<h3 id="6-auto-suggestions-for-common-patterns">6. Auto-Suggestions for Common Patterns<a class="headerlink" href="#6-auto-suggestions-for-common-patterns" title="Permanent link">&para;</a></h3>
<p><strong>As a</strong> user adding directories with common generated files,
<strong>I want</strong> intelligent suggestions for ignore patterns,
<strong>So that</strong> I don't track unnecessary files.</p>
<p><strong>Trigger Patterns:</strong>
- <code>.log</code> ‚Üí Suggest ignoring <code>*.log</code>
- <code>.sqlite</code>, <code>.db</code> ‚Üí Suggest ignoring <code>*.sqlite</code>, <code>*.db</code>
- <code>.cache</code> ‚Üí Suggest ignoring <code>*.cache</code>
- <code>.git</code> ‚Üí Suggest ignoring <code>**/.git</code>
- <code>node_modules/</code> ‚Üí Suggest ignoring <code>node_modules/</code>
- <code>.DS_Store</code> ‚Üí Suggest ignoring <code>.DS_Store</code></p>
<p><strong>Scenario:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>$<span class="w"> </span>dot<span class="w"> </span>add<span class="w"> </span>~/.config/micro
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>Preview:<span class="w"> </span>dot<span class="w"> </span>add<span class="w"> </span>/Users/dt/.config/micro
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>Files<span class="w"> </span>to<span class="w"> </span>add:<span class="w"> </span><span class="m">8</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>Total<span class="w"> </span>size:<span class="w"> </span><span class="m">12</span><span class="w"> </span>KB
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>‚ö†Ô∏è<span class="w">  </span>Cache<span class="w"> </span>files<span class="w"> </span>detected:
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">  </span>-<span class="w"> </span>backups/2026-01-30.cache
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">  </span>-<span class="w"> </span>buffers/session.cache
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>üí°<span class="w"> </span>These<span class="w"> </span>look<span class="w"> </span>like<span class="w"> </span>temporary<span class="w"> </span>files.<span class="w"> </span>Add<span class="w"> </span>to<span class="w"> </span>ignore?<span class="w"> </span><span class="o">(</span>Y/n<span class="o">)</span>:<span class="w"> </span>y
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>‚úì<span class="w"> </span>Added<span class="w"> </span>*.cache<span class="w"> </span>to<span class="w"> </span>.chezmoiignore
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>Proceed<span class="w"> </span>with<span class="w"> </span>add?<span class="w"> </span><span class="o">(</span>Y/n<span class="o">)</span>:<span class="w"> </span>y
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>‚úì<span class="w"> </span>Added<span class="w"> </span><span class="m">6</span><span class="w"> </span>files<span class="w"> </span><span class="o">(</span>skipped<span class="w"> </span><span class="m">2</span><span class="w"> </span>cache<span class="w"> </span>files<span class="o">)</span>
</code></pre></div></p>
<p><strong>Acceptance:</strong>
- Detects patterns automatically during preview
- Groups suggestions by file type (logs, databases, caches)
- Explains why files should be ignored
- Batch-adds related patterns (e.g., <em>.sqlite + </em>.db)
- Never blocks adding (always optional)</p>
<hr />
<h2 id="technical-requirements">Technical Requirements<a class="headerlink" href="#technical-requirements" title="Permanent link">&para;</a></h2>
<h3 id="architecture">Architecture<a class="headerlink" href="#architecture" title="Permanent link">&para;</a></h3>
<p><strong>Pattern:</strong> Extend existing <code>dot</code> dispatcher (maintain consistency)</p>
<p><strong>New Functions:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>lib/dotfile-helpers.zsh:
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>  - _dot_check_git_in_path()       # Detect .git directories
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>  - _dot_preview_add()              # Preview before add
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>  - _dot_suggest_ignore_patterns()  # Auto-suggest patterns
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>  - _dot_get_repo_size()            # Calculate repository size
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>  - _dot_find_large_files()         # Identify bloat
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>lib/dispatchers/dot-dispatcher.zsh:
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>  - dot ignore [add|list|remove|edit]  # Ignore management
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>  - dot size                            # Repository analysis
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>  - _dot_doctor_check_chezmoi_health() # Doctor integration
</code></pre></div></p>
<p><strong>Modified Commands:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>dot add &lt;path&gt;:
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>  1. Run _dot_preview_add() - show file count, size, warnings
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>  2. Run _dot_check_git_in_path() - detect .git directories
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>  3. Run _dot_suggest_ignore_patterns() - auto-suggest ignores
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>  4. Prompt for confirmation
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>  5. Execute chezmoi add with filtered paths
</code></pre></div></p>
<h3 id="performance-targets">Performance Targets<a class="headerlink" href="#performance-targets" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Target</th>
<th>Current</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>dot add</code> preview</td>
<td>&lt; 2.0s</td>
<td>N/A</td>
<td>New</td>
</tr>
<tr>
<td><code>dot ignore list</code></td>
<td>&lt; 0.5s</td>
<td>N/A</td>
<td>New</td>
</tr>
<tr>
<td><code>dot size</code></td>
<td>&lt; 3.0s</td>
<td>N/A</td>
<td>New</td>
</tr>
<tr>
<td><code>flow doctor</code> (chezmoi)</td>
<td>&lt; 2.0s</td>
<td>N/A</td>
<td>New</td>
</tr>
<tr>
<td>Git detection</td>
<td>&lt; 1.0s</td>
<td>N/A</td>
<td>New</td>
</tr>
</tbody>
</table>
<h3 id="file-structure">File Structure<a class="headerlink" href="#file-structure" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>flow-cli/
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>‚îú‚îÄ‚îÄ lib/
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>‚îÇ   ‚îú‚îÄ‚îÄ dotfile-helpers.zsh               # Add new functions
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>‚îÇ   ‚îî‚îÄ‚îÄ dispatchers/
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>‚îÇ       ‚îî‚îÄ‚îÄ dot-dispatcher.zsh            # Modify for new commands
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>‚îú‚îÄ‚îÄ completions/
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>‚îÇ   ‚îî‚îÄ‚îÄ _dot                              # Add ignore/size completions
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>‚îú‚îÄ‚îÄ tests/
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>‚îÇ   ‚îî‚îÄ‚îÄ test-dot-chezmoi-safety.zsh       # New test suite
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>‚îî‚îÄ‚îÄ docs/specs/
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>    ‚îú‚îÄ‚îÄ dot-dispatcher-refcard.md         # Update with new commands
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>    ‚îî‚îÄ‚îÄ SPEC-dot-chezmoi-safety-2026-01-30.md  # This spec
</code></pre></div>
<hr />
<h2 id="cross-platform-compatibility">Cross-Platform Compatibility<a class="headerlink" href="#cross-platform-compatibility" title="Permanent link">&para;</a></h2>
<h3 id="issue-bsd-vs-gnu-command-differences">Issue: BSD vs GNU Command Differences<a class="headerlink" href="#issue-bsd-vs-gnu-command-differences" title="Permanent link">&para;</a></h3>
<p><strong>Critical:</strong> Commands like <code>stat</code> and <code>sed</code> behave differently on macOS (BSD) vs Linux (GNU).</p>
<h4 id="1-file-size-detection">1. File Size Detection<a class="headerlink" href="#1-file-size-detection" title="Permanent link">&para;</a></h4>
<p><strong>Problem:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># Line 473 uses BSD-specific stat</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nb">local</span><span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="k">$(</span>stat<span class="w"> </span>-f%z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="m">0</span><span class="k">)</span>
</code></pre></div></p>
<p><strong>Solution:</strong> Add cross-platform helper in <code>lib/core.zsh</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># Add to lib/core.zsh</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>_flow_get_file_size<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">    </span><span class="c1"># Detect stat flavor</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>stat<span class="w"> </span>--version<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span>GNU<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">        </span><span class="c1"># GNU stat (Linux)</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">        </span>stat<span class="w"> </span>-c%s<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">        </span><span class="c1"># BSD stat (macOS)</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">        </span>stat<span class="w"> </span>-f%z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="o">}</span>
</code></pre></div>
<p><strong>Usage:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># In _dot_preview_add()</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="nb">local</span><span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="k">$(</span>_flow_get_file_size<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="k">)</span>
</code></pre></div></p>
<h4 id="2-ignore-pattern-removal">2. Ignore Pattern Removal<a class="headerlink" href="#2-ignore-pattern-removal" title="Permanent link">&para;</a></h4>
<p><strong>Problem:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># Line 669 uses sed -i.bak (works differently on BSD vs GNU)</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>sed<span class="w"> </span>-i.bak<span class="w"> </span><span class="s2">&quot;/^</span><span class="si">${</span><span class="nv">escaped</span><span class="si">}</span>$<span class="s2">/d&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span>
</code></pre></div></p>
<p><strong>Solution:</strong> Use temp file approach (portable):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1"># In dot ignore remove command</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="nb">local</span><span class="w"> </span><span class="nv">temp_file</span><span class="o">=</span><span class="k">$(</span>mktemp<span class="k">)</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>grep<span class="w"> </span>-vF<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$temp_file</span><span class="s2">&quot;</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>mv<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$temp_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>_dot_success<span class="w"> </span><span class="s2">&quot;Removed pattern from .chezmoiignore: </span><span class="nv">$3</span><span class="s2">&quot;</span>
</code></pre></div>
<h4 id="3-human-readable-sizes">3. Human-Readable Sizes<a class="headerlink" href="#3-human-readable-sizes" title="Permanent link">&para;</a></h4>
<p><strong>Problem:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># Line 498 assumes numfmt is available</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Total size: </span><span class="k">$(</span>numfmt<span class="w"> </span>--to<span class="o">=</span>iec<span class="w"> </span><span class="nv">$total_size</span><span class="k">)</span><span class="s2">&quot;</span>
</code></pre></div></p>
<p><strong>Solution:</strong> Add fallback helper in <code>lib/core.zsh</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># Add to lib/core.zsh</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>_flow_human_size<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">bytes</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>numfmt<span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">        </span>numfmt<span class="w"> </span>--to<span class="o">=</span>iec<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$bytes</span><span class="s2">&quot;</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">        </span><span class="c1"># Fallback manual conversion</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>bytes<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span><span class="m">1073741824</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$((</span><span class="nv">bytes</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">1073741824</span><span class="k">))</span><span class="s2"> GB&quot;</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w">        </span><span class="k">elif</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>bytes<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span><span class="m">1048576</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$((</span><span class="nv">bytes</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">1048576</span><span class="k">))</span><span class="s2"> MB&quot;</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w">        </span><span class="k">elif</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>bytes<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span><span class="m">1024</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$((</span><span class="nv">bytes</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">1024</span><span class="k">))</span><span class="s2"> KB&quot;</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="w">        </span><span class="k">else</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">bytes</span><span class="si">}</span><span class="s2"> bytes&quot;</span>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="o">}</span>
</code></pre></div>
<hr />
<h2 id="performance-optimizations">Performance Optimizations<a class="headerlink" href="#performance-optimizations" title="Permanent link">&para;</a></h2>
<h3 id="issue-find-performance-on-large-directories">Issue: <code>find</code> Performance on Large Directories<a class="headerlink" href="#issue-find-performance-on-large-directories" title="Permanent link">&para;</a></h3>
<p><strong>Problem:</strong> Lines 381-383 use <code>find</code> with no timeout on potentially large directories:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>gitdir<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">    </span><span class="nv">git_dirs</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$gitdir</span><span class="s2">&quot;</span><span class="o">)</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;.git&quot;</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="o">)</span>
</code></pre></div>
<p><strong>Impact:</strong> Could take 10+ seconds on directories like <code>~/.config</code> with 10,000+ files.</p>
<h3 id="solution-1-add-timeout-wrapper">Solution 1: Add Timeout Wrapper<a class="headerlink" href="#solution-1-add-timeout-wrapper" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>_dot_check_git_in_path<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">target</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">git_dirs</span><span class="o">=()</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">    </span><span class="c1"># Check if target itself has .git</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">/.git&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">        </span><span class="nv">git_dirs</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">/.git&quot;</span><span class="o">)</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">    </span><span class="c1"># Find nested .git directories with timeout</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>timeout<span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="w">        </span><span class="c1"># Use timeout if available (GNU coreutils)</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>gitdir<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="w">            </span><span class="nv">git_dirs</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$gitdir</span><span class="s2">&quot;</span><span class="o">)</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="w">        </span><span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>timeout<span class="w"> </span>2s<span class="w"> </span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;.git&quot;</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="o">)</span>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>gtimeout<span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="w">        </span><span class="c1"># Use gtimeout on macOS (brew install coreutils)</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>gitdir<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="w">            </span><span class="nv">git_dirs</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$gitdir</span><span class="s2">&quot;</span><span class="o">)</span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="w">        </span><span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>gtimeout<span class="w"> </span>2s<span class="w"> </span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;.git&quot;</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="o">)</span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="w">        </span><span class="c1"># No timeout available - warn user if dir is large</span>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="w">        </span><span class="nb">local</span><span class="w"> </span><span class="nv">file_count</span><span class="o">=</span><span class="k">$(</span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="k">)</span>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>file_count<span class="w"> </span>&gt;<span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="w">            </span>_dot_warn<span class="w"> </span><span class="s2">&quot;Large directory detected. Git scan may take a few seconds...&quot;</span>
<a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a>
<a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>gitdir<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="w">            </span><span class="nv">git_dirs</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$gitdir</span><span class="s2">&quot;</span><span class="o">)</span>
<a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="w">        </span><span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;.git&quot;</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="o">)</span>
<a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a>
<a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span><span class="si">${#</span><span class="nv">git_dirs</span><span class="p">[@]</span><span class="si">}</span><span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">git_dirs</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a><span class="o">}</span>
</code></pre></div>
<h3 id="solution-2-optimize-for-git-repos">Solution 2: Optimize for Git Repos<a class="headerlink" href="#solution-2-optimize-for-git-repos" title="Permanent link">&para;</a></h3>
<p>If the target is already a git repository, use <code>git ls-files</code> instead:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># Add optimization for git repos</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">/.git&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">    </span><span class="c1"># It&#39;s a git repo - use git ls-files (much faster)</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">has_nested</span><span class="o">=</span><span class="nb">false</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>git<span class="w"> </span>-C<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span>ls-files<span class="w"> </span>--others<span class="w"> </span>--directory<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;\.git/</span>$<span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">        </span><span class="nv">has_nested</span><span class="o">=</span><span class="nb">true</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$has_nested</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">        </span><span class="nv">git_dirs</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">/.git&quot;</span><span class="o">)</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="k">else</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">    </span><span class="c1"># Not a git repo - use find with timeout</span>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="w">    </span><span class="c1"># ... (timeout logic from Solution 1)</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="k">fi</span>
</code></pre></div>
<h3 id="performance-targets-updated">Performance Targets (Updated)<a class="headerlink" href="#performance-targets-updated" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Target</th>
<th>Worst Case</th>
<th>Mitigation</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>dot add</code> preview</td>
<td>&lt; 2.0s</td>
<td>&lt; 5.0s</td>
<td>Timeout + progress</td>
</tr>
<tr>
<td><code>dot ignore list</code></td>
<td>&lt; 0.5s</td>
<td>&lt; 1.0s</td>
<td>Simple file read</td>
</tr>
<tr>
<td><code>dot size</code></td>
<td>&lt; 3.0s</td>
<td>&lt; 8.0s</td>
<td>Cache results</td>
</tr>
<tr>
<td><code>flow doctor</code> (chezmoi)</td>
<td>&lt; 2.0s</td>
<td>&lt; 4.0s</td>
<td>Skip slow checks</td>
</tr>
<tr>
<td>Git detection</td>
<td>&lt; 1.0s</td>
<td>&lt; 3.0s</td>
<td>Timeout at 2s</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="architecture-integration">Architecture Integration<a class="headerlink" href="#architecture-integration" title="Permanent link">&para;</a></h2>
<h3 id="integration-with-existing-patterns">Integration with Existing Patterns<a class="headerlink" href="#integration-with-existing-patterns" title="Permanent link">&para;</a></h3>
<h4 id="1-leverage-existing-cache-pattern">1. Leverage Existing Cache Pattern<a class="headerlink" href="#1-leverage-existing-cache-pattern" title="Permanent link">&para;</a></h4>
<p><strong>Current Pattern in <code>lib/dotfile-helpers.zsh</code>:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># Existing cache variables</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="nb">typeset</span><span class="w"> </span>-g<span class="w"> </span>_DOT_CHEZMOI_CACHE
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="nb">typeset</span><span class="w"> </span>-g<span class="w"> </span>_DOT_CHEZMOI_CACHE_TIME
</code></pre></div>
<p><strong>Add New Cache Variables:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># Add to lib/dotfile-helpers.zsh</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="nb">typeset</span><span class="w"> </span>-g<span class="w"> </span>_DOT_SIZE_CACHE
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="nb">typeset</span><span class="w"> </span>-g<span class="w"> </span>_DOT_SIZE_CACHE_TIME
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="nb">typeset</span><span class="w"> </span>-g<span class="w"> </span>_DOT_IGNORE_CACHE
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="nb">typeset</span><span class="w"> </span>-g<span class="w"> </span>_DOT_IGNORE_CACHE_TIME
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="c1"># Cache TTL (5 minutes)</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="nb">typeset</span><span class="w"> </span>-g<span class="w"> </span><span class="nv">_DOT_CACHE_TTL</span><span class="o">=</span><span class="m">300</span>
</code></pre></div>
<p><strong>Cache Helper Functions:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># Add to lib/dotfile-helpers.zsh</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>_dot_is_cache_valid<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">cache_time</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">$_DOT_CACHE_TTL</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$cache_time</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">now</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">age</span><span class="o">=</span><span class="k">$((</span><span class="nv">now</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">cache_time</span><span class="k">))</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="w">    </span><span class="o">((</span><span class="w"> </span>age<span class="w"> </span>&lt;<span class="w"> </span>ttl<span class="w"> </span><span class="o">))</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="o">}</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>_dot_get_cached_size<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>_dot_is_cache_valid<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$_DOT_SIZE_CACHE_TIME</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$_DOT_SIZE_CACHE</span><span class="s2">&quot;</span>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a><span class="o">}</span>
<a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a>
<a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a>_dot_cache_size<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a><span class="w">    </span><span class="nv">_DOT_SIZE_CACHE</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a><span class="w">    </span><span class="nv">_DOT_SIZE_CACHE_TIME</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span>
<a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a><span class="o">}</span>
</code></pre></div>
<h4 id="2-doctor-integration-point">2. Doctor Integration Point<a class="headerlink" href="#2-doctor-integration-point" title="Permanent link">&para;</a></h4>
<p><strong>File:</strong> <code>commands/doctor.zsh</code></p>
<p><strong>Integration Location:</strong> After token checks, before final summary</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># In commands/doctor.zsh, add after existing checks:</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="c1"># Source dotfile helpers if available</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">FLOW_PLUGIN_DIR</span><span class="si">}</span><span class="s2">/lib/dotfile-helpers.zsh&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">    </span><span class="nb">source</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">FLOW_PLUGIN_DIR</span><span class="si">}</span><span class="s2">/lib/dotfile-helpers.zsh&quot;</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="k">fi</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="c1"># Dotfile Management Check (if chezmoi installed)</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="k">if</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>chezmoi<span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="w">    </span>_dot_doctor_check_chezmoi_health
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="k">else</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="w">    </span>_flow_log_info<span class="w"> </span><span class="s2">&quot;Dotfile Management: chezmoi not installed (optional)&quot;</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="w">    </span>_flow_log_info<span class="w"> </span><span class="s2">&quot;Install with: brew install chezmoi&quot;</span>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="k">fi</span>
</code></pre></div>
<h4 id="3-update-dot-status-command">3. Update <code>dot status</code> Command<a class="headerlink" href="#3-update-dot-status-command" title="Permanent link">&para;</a></h4>
<p><strong>Enhancement:</strong> Show repository health in status output</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1"># In lib/dispatchers/dot-dispatcher.zsh, _dot_status() function</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="c1"># Add after sync status:</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="c1"># Repository health</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.local/share/chezmoi/.git&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">    </span>_flow_log_info<span class="w"> </span><span class="s2">&quot;Repository Health:&quot;</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">    </span><span class="c1"># Get cached size or calculate</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span>size_display
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">size_display</span><span class="o">=</span><span class="k">$(</span>_dot_get_cached_size<span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  Size: </span><span class="nv">$size_display</span><span class="s2"> (cached)&quot;</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">        </span><span class="nb">local</span><span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="k">$(</span>du<span class="w"> </span>-sh<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.local/share/chezmoi&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f1<span class="k">)</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="w">        </span>_dot_cache_size<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$size</span><span class="s2">&quot;</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  Size: </span><span class="nv">$size</span><span class="s2">&quot;</span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a><span class="w">    </span><span class="c1"># Warn if large</span>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">size_mb</span><span class="o">=</span><span class="k">$(</span>du<span class="w"> </span>-sm<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.local/share/chezmoi&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f1<span class="k">)</span>
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>size_mb<span class="w"> </span>&gt;<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a><span class="w">        </span>_flow_log_warn<span class="w"> </span><span class="s2">&quot;  Repository is large (</span><span class="si">${</span><span class="nv">size_mb</span><span class="si">}</span><span class="s2">MB)&quot;</span>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a><span class="w">        </span>_flow_log_info<span class="w"> </span><span class="s2">&quot;  Run &#39;dot size&#39; to analyze&quot;</span>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a>
<a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a><span class="w">    </span><span class="c1"># Managed file count</span>
<a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">managed_count</span><span class="o">=</span><span class="k">$(</span>chezmoi<span class="w"> </span>managed<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="k">)</span>
<a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  Managed files: </span><span class="nv">$managed_count</span><span class="s2">&quot;</span>
<a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a>
<a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a><span class="w">    </span><span class="c1"># Quick git check</span>
<a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">git_count</span><span class="o">=</span><span class="k">$(</span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.local/share/chezmoi&quot;</span><span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;dot_git&quot;</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="k">)</span>
<a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>git_count<span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a><span class="w">        </span>_flow_log_warn<span class="w"> </span><span class="s2">&quot;  Found </span><span class="nv">$git_count</span><span class="s2"> tracked git directories&quot;</span>
<a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a><span class="w">        </span>_flow_log_info<span class="w"> </span><span class="s2">&quot;  Fix with: dot ignore add &#39;**/.git&#39;&quot;</span>
<a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a><span class="k">fi</span>
</code></pre></div>
<h4 id="4-edge-case-symlink-handling">4. Edge Case: Symlink Handling<a class="headerlink" href="#4-edge-case-symlink-handling" title="Permanent link">&para;</a></h4>
<p><strong>Issue:</strong> Spec doesn't address symlinks</p>
<p><strong>Solution:</strong> Add symlink detection and handling</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># In _dot_check_git_in_path()</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="c1"># Add before find command:</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="c1"># Check if target is a symlink</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-L<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="w">    </span>_dot_warn<span class="w"> </span><span class="s2">&quot;Target is a symlink: </span><span class="nv">$target</span><span class="s2">&quot;</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="w">    </span><span class="nb">read</span><span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;REPLY?Follow symlink and scan target? (Y/n) &quot;</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$REPLY</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>^<span class="o">[</span>Yy<span class="o">]</span>$<span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="nv">$REPLY</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="w">        </span><span class="nv">target</span><span class="o">=</span><span class="k">$(</span>readlink<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="o">||</span><span class="w"> </span>realpath<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="k">)</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="w">        </span>_dot_info<span class="w"> </span><span class="s2">&quot;Following to: </span><span class="nv">$target</span><span class="s2">&quot;</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="w">        </span>_dot_info<span class="w"> </span><span class="s2">&quot;Scanning symlink itself (not following)&quot;</span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="w">        </span><span class="c1"># Only check if symlink target has .git</span>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="w">        </span><span class="nb">local</span><span class="w"> </span><span class="nv">real_target</span><span class="o">=</span><span class="k">$(</span>readlink<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="k">)</span>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">real_target</span><span class="si">}</span><span class="s2">/.git&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a><span class="w">            </span><span class="nv">git_dirs</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">real_target</span><span class="si">}</span><span class="s2">/.git&quot;</span><span class="o">)</span>
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">git_dirs</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a><span class="k">fi</span>
</code></pre></div>
<h4 id="5-integration-with-gitignore">5. Integration with <code>.gitignore</code><a class="headerlink" href="#5-integration-with-gitignore" title="Permanent link">&para;</a></h4>
<p><strong>Enhancement:</strong> Suggest ignore patterns based on existing <code>.gitignore</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1"># Add to lib/dotfile-helpers.zsh</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>_dot_suggest_from_gitignore<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">target</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">gitignore</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">/.gitignore&quot;</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$gitignore</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">suggestions</span><span class="o">=()</span>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="w">    </span><span class="c1"># Parse .gitignore for common patterns</span>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>pattern<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="w">        </span><span class="c1"># Skip comments and empty lines</span>
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="w">        </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$pattern</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>^#<span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">continue</span>
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="w">        </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$pattern</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">continue</span>
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="w">        </span><span class="c1"># Add to suggestions</span>
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="w">        </span><span class="nv">suggestions</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$pattern</span><span class="s2">&quot;</span><span class="o">)</span>
<a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="w">    </span><span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$gitignore</span><span class="s2">&quot;</span>
<a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a>
<a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span><span class="si">${#</span><span class="nv">suggestions</span><span class="p">[@]</span><span class="si">}</span><span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a><span class="w">        </span>_dot_info<span class="w"> </span><span class="s2">&quot;üí° Found .gitignore with </span><span class="si">${#</span><span class="nv">suggestions</span><span class="p">[@]</span><span class="si">}</span><span class="s2"> patterns&quot;</span>
<a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a><span class="w">        </span><span class="nb">read</span><span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;REPLY?Import patterns to .chezmoiignore? (Y/n) &quot;</span>
<a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a><span class="w">        </span><span class="nb">echo</span>
<a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a>
<a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$REPLY</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>^<span class="o">[</span>Yy<span class="o">]</span>$<span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="nv">$REPLY</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span>pattern<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">suggestions</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a><span class="w">                </span>_dot_ignore_add<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$pattern</span><span class="s2">&quot;</span>
<a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a><span class="w">            </span><span class="k">done</span>
<a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a><span class="w">            </span>_dot_success<span class="w"> </span><span class="s2">&quot;Imported </span><span class="si">${#</span><span class="nv">suggestions</span><span class="p">[@]</span><span class="si">}</span><span class="s2"> patterns from .gitignore&quot;</span>
<a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-25-35" name="__codelineno-25-35" href="#__codelineno-25-35"></a><span class="o">}</span>
</code></pre></div>
<hr />
<h2 id="test-infrastructure">Test Infrastructure<a class="headerlink" href="#test-infrastructure" title="Permanent link">&para;</a></h2>
<h3 id="integration-with-existing-test-framework">Integration with Existing Test Framework<a class="headerlink" href="#integration-with-existing-test-framework" title="Permanent link">&para;</a></h3>
<p><strong>File:</strong> <code>tests/test-dot-chezmoi-safety.zsh</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="ch">#!/usr/bin/env zsh</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="c1"># Test suite for dot dispatcher chezmoi safety features</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="c1"># Tests: git detection, preview, ignore management, size analysis, doctor integration</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="c1"># Load test framework (if exists)</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">0</span><span class="p">:</span><span class="nv">A</span><span class="p">:</span><span class="nv">h</span><span class="si">}</span><span class="s2">/helpers/test-framework.zsh&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="w">    </span><span class="nb">source</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">0</span><span class="p">:</span><span class="nv">A</span><span class="p">:</span><span class="nv">h</span><span class="si">}</span><span class="s2">/helpers/test-framework.zsh&quot;</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="k">else</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="w">    </span><span class="c1"># Minimal test framework</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="w">    </span><span class="nv">TESTS_PASSED</span><span class="o">=</span><span class="m">0</span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="w">    </span><span class="nv">TESTS_FAILED</span><span class="o">=</span><span class="m">0</span>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="w">    </span>assert_equals<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  ‚úì </span><span class="nv">$3</span><span class="s2">&quot;</span>
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a><span class="w">            </span><span class="o">((</span>TESTS_PASSED++<span class="o">))</span>
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a><span class="w">        </span><span class="k">else</span>
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  ‚úó </span><span class="nv">$3</span><span class="s2">&quot;</span>
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;    Expected: </span><span class="nv">$2</span><span class="s2">&quot;</span>
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;    Got: </span><span class="nv">$1</span><span class="s2">&quot;</span>
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a><span class="w">            </span><span class="o">((</span>TESTS_FAILED++<span class="o">))</span>
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>
<a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a><span class="w">    </span>assert_contains<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>*<span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>*<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  ‚úì </span><span class="nv">$3</span><span class="s2">&quot;</span>
<a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a><span class="w">            </span><span class="o">((</span>TESTS_PASSED++<span class="o">))</span>
<a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a><span class="w">        </span><span class="k">else</span>
<a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  ‚úó </span><span class="nv">$3</span><span class="s2">&quot;</span>
<a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;    Expected to contain: </span><span class="nv">$2</span><span class="s2">&quot;</span>
<a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;    Got: </span><span class="nv">$1</span><span class="s2">&quot;</span>
<a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a><span class="w">            </span><span class="o">((</span>TESTS_FAILED++<span class="o">))</span>
<a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-26-36" name="__codelineno-26-36" href="#__codelineno-26-36"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-26-37" name="__codelineno-26-37" href="#__codelineno-26-37"></a>
<a id="__codelineno-26-38" name="__codelineno-26-38" href="#__codelineno-26-38"></a><span class="w">    </span>assert_file_exists<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-26-39" name="__codelineno-26-39" href="#__codelineno-26-39"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-26-40" name="__codelineno-26-40" href="#__codelineno-26-40"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  ‚úì </span><span class="nv">$2</span><span class="s2">&quot;</span>
<a id="__codelineno-26-41" name="__codelineno-26-41" href="#__codelineno-26-41"></a><span class="w">            </span><span class="o">((</span>TESTS_PASSED++<span class="o">))</span>
<a id="__codelineno-26-42" name="__codelineno-26-42" href="#__codelineno-26-42"></a><span class="w">        </span><span class="k">else</span>
<a id="__codelineno-26-43" name="__codelineno-26-43" href="#__codelineno-26-43"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  ‚úó </span><span class="nv">$2</span><span class="s2">&quot;</span>
<a id="__codelineno-26-44" name="__codelineno-26-44" href="#__codelineno-26-44"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;    File not found: </span><span class="nv">$1</span><span class="s2">&quot;</span>
<a id="__codelineno-26-45" name="__codelineno-26-45" href="#__codelineno-26-45"></a><span class="w">            </span><span class="o">((</span>TESTS_FAILED++<span class="o">))</span>
<a id="__codelineno-26-46" name="__codelineno-26-46" href="#__codelineno-26-46"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-26-47" name="__codelineno-26-47" href="#__codelineno-26-47"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-26-48" name="__codelineno-26-48" href="#__codelineno-26-48"></a><span class="k">fi</span>
<a id="__codelineno-26-49" name="__codelineno-26-49" href="#__codelineno-26-49"></a>
<a id="__codelineno-26-50" name="__codelineno-26-50" href="#__codelineno-26-50"></a><span class="c1"># Test setup</span>
<a id="__codelineno-26-51" name="__codelineno-26-51" href="#__codelineno-26-51"></a>test_setup<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-26-52" name="__codelineno-26-52" href="#__codelineno-26-52"></a><span class="w">    </span><span class="nb">export</span><span class="w"> </span><span class="nv">TEST_HOME</span><span class="o">=</span><span class="s2">&quot;/tmp/test-dot-</span><span class="nv">$$</span><span class="s2">&quot;</span>
<a id="__codelineno-26-53" name="__codelineno-26-53" href="#__codelineno-26-53"></a><span class="w">    </span><span class="nb">export</span><span class="w"> </span><span class="nv">HOME</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TEST_HOME</span><span class="s2">&quot;</span>
<a id="__codelineno-26-54" name="__codelineno-26-54" href="#__codelineno-26-54"></a><span class="w">    </span><span class="nb">export</span><span class="w"> </span><span class="nv">FLOW_PLUGIN_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">0</span><span class="p">:</span><span class="nv">A</span><span class="p">:</span><span class="nv">h</span><span class="si">}</span><span class="s2">/..&quot;</span>
<a id="__codelineno-26-55" name="__codelineno-26-55" href="#__codelineno-26-55"></a>
<a id="__codelineno-26-56" name="__codelineno-26-56" href="#__codelineno-26-56"></a><span class="w">    </span><span class="c1"># Create test environment</span>
<a id="__codelineno-26-57" name="__codelineno-26-57" href="#__codelineno-26-57"></a><span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$TEST_HOME</span><span class="s2">/.local/share/chezmoi&quot;</span>
<a id="__codelineno-26-58" name="__codelineno-26-58" href="#__codelineno-26-58"></a>
<a id="__codelineno-26-59" name="__codelineno-26-59" href="#__codelineno-26-59"></a><span class="w">    </span><span class="c1"># Initialize mock chezmoi repo</span>
<a id="__codelineno-26-60" name="__codelineno-26-60" href="#__codelineno-26-60"></a><span class="w">    </span><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$TEST_HOME</span><span class="s2">/.local/share/chezmoi&quot;</span>
<a id="__codelineno-26-61" name="__codelineno-26-61" href="#__codelineno-26-61"></a><span class="w">    </span>git<span class="w"> </span>init<span class="w"> </span>-q
<a id="__codelineno-26-62" name="__codelineno-26-62" href="#__codelineno-26-62"></a><span class="w">    </span><span class="nb">cd</span><span class="w"> </span>-<span class="w"> </span>&gt;<span class="w"> </span>/dev/null
<a id="__codelineno-26-63" name="__codelineno-26-63" href="#__codelineno-26-63"></a>
<a id="__codelineno-26-64" name="__codelineno-26-64" href="#__codelineno-26-64"></a><span class="w">    </span><span class="c1"># Source the plugin</span>
<a id="__codelineno-26-65" name="__codelineno-26-65" href="#__codelineno-26-65"></a><span class="w">    </span><span class="nb">source</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$FLOW_PLUGIN_DIR</span><span class="s2">/flow.plugin.zsh&quot;</span>
<a id="__codelineno-26-66" name="__codelineno-26-66" href="#__codelineno-26-66"></a><span class="o">}</span>
<a id="__codelineno-26-67" name="__codelineno-26-67" href="#__codelineno-26-67"></a>
<a id="__codelineno-26-68" name="__codelineno-26-68" href="#__codelineno-26-68"></a><span class="c1"># Test teardown</span>
<a id="__codelineno-26-69" name="__codelineno-26-69" href="#__codelineno-26-69"></a>test_teardown<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-26-70" name="__codelineno-26-70" href="#__codelineno-26-70"></a><span class="w">    </span>rm<span class="w"> </span>-rf<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$TEST_HOME</span><span class="s2">&quot;</span>
<a id="__codelineno-26-71" name="__codelineno-26-71" href="#__codelineno-26-71"></a><span class="o">}</span>
<a id="__codelineno-26-72" name="__codelineno-26-72" href="#__codelineno-26-72"></a>
<a id="__codelineno-26-73" name="__codelineno-26-73" href="#__codelineno-26-73"></a><span class="c1"># Mock chezmoi command</span>
<a id="__codelineno-26-74" name="__codelineno-26-74" href="#__codelineno-26-74"></a>chezmoi<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-26-75" name="__codelineno-26-75" href="#__codelineno-26-75"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<a id="__codelineno-26-76" name="__codelineno-26-76" href="#__codelineno-26-76"></a><span class="w">        </span><span class="s2">&quot;add&quot;</span><span class="o">)</span>
<a id="__codelineno-26-77" name="__codelineno-26-77" href="#__codelineno-26-77"></a><span class="w">            </span><span class="c1"># Mock: just create a placeholder file</span>
<a id="__codelineno-26-78" name="__codelineno-26-78" href="#__codelineno-26-78"></a><span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">target</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<a id="__codelineno-26-79" name="__codelineno-26-79" href="#__codelineno-26-79"></a><span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">filename</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="k">)</span>
<a id="__codelineno-26-80" name="__codelineno-26-80" href="#__codelineno-26-80"></a><span class="w">            </span>touch<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.local/share/chezmoi/dot_</span><span class="si">${</span><span class="nv">filename</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-26-81" name="__codelineno-26-81" href="#__codelineno-26-81"></a><span class="w">            </span><span class="p">;;</span>
<a id="__codelineno-26-82" name="__codelineno-26-82" href="#__codelineno-26-82"></a><span class="w">        </span><span class="s2">&quot;managed&quot;</span><span class="o">)</span>
<a id="__codelineno-26-83" name="__codelineno-26-83" href="#__codelineno-26-83"></a><span class="w">            </span><span class="c1"># Mock: list files in chezmoi dir</span>
<a id="__codelineno-26-84" name="__codelineno-26-84" href="#__codelineno-26-84"></a><span class="w">            </span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.local/share/chezmoi&quot;</span><span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-not<span class="w"> </span>-path<span class="w"> </span><span class="s2">&quot;*/.git/*&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
<a id="__codelineno-26-85" name="__codelineno-26-85" href="#__codelineno-26-85"></a><span class="w">            </span><span class="p">;;</span>
<a id="__codelineno-26-86" name="__codelineno-26-86" href="#__codelineno-26-86"></a><span class="w">        </span>*<span class="o">)</span>
<a id="__codelineno-26-87" name="__codelineno-26-87" href="#__codelineno-26-87"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mock chezmoi: </span><span class="nv">$*</span><span class="s2">&quot;</span>
<a id="__codelineno-26-88" name="__codelineno-26-88" href="#__codelineno-26-88"></a><span class="w">            </span><span class="p">;;</span>
<a id="__codelineno-26-89" name="__codelineno-26-89" href="#__codelineno-26-89"></a><span class="w">    </span><span class="k">esac</span>
<a id="__codelineno-26-90" name="__codelineno-26-90" href="#__codelineno-26-90"></a><span class="o">}</span>
<a id="__codelineno-26-91" name="__codelineno-26-91" href="#__codelineno-26-91"></a>
<a id="__codelineno-26-92" name="__codelineno-26-92" href="#__codelineno-26-92"></a><span class="c1"># ============================================================================</span>
<a id="__codelineno-26-93" name="__codelineno-26-93" href="#__codelineno-26-93"></a><span class="c1"># Unit Tests</span>
<a id="__codelineno-26-94" name="__codelineno-26-94" href="#__codelineno-26-94"></a><span class="c1"># ============================================================================</span>
<a id="__codelineno-26-95" name="__codelineno-26-95" href="#__codelineno-26-95"></a>
<a id="__codelineno-26-96" name="__codelineno-26-96" href="#__codelineno-26-96"></a>test_git_detection_single_dir<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-26-97" name="__codelineno-26-97" href="#__codelineno-26-97"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test: Git detection - single directory&quot;</span>
<a id="__codelineno-26-98" name="__codelineno-26-98" href="#__codelineno-26-98"></a>
<a id="__codelineno-26-99" name="__codelineno-26-99" href="#__codelineno-26-99"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">test_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TEST_HOME</span><span class="s2">/test-git-single&quot;</span>
<a id="__codelineno-26-100" name="__codelineno-26-100" href="#__codelineno-26-100"></a><span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">/.git&quot;</span>
<a id="__codelineno-26-101" name="__codelineno-26-101" href="#__codelineno-26-101"></a>
<a id="__codelineno-26-102" name="__codelineno-26-102" href="#__codelineno-26-102"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">result</span><span class="o">=</span><span class="k">$(</span>_dot_check_git_in_path<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">&quot;</span><span class="k">)</span>
<a id="__codelineno-26-103" name="__codelineno-26-103" href="#__codelineno-26-103"></a>
<a id="__codelineno-26-104" name="__codelineno-26-104" href="#__codelineno-26-104"></a><span class="w">    </span>assert_contains<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$result</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;.git&quot;</span><span class="w"> </span><span class="s2">&quot;Detects .git directory&quot;</span>
<a id="__codelineno-26-105" name="__codelineno-26-105" href="#__codelineno-26-105"></a><span class="o">}</span>
<a id="__codelineno-26-106" name="__codelineno-26-106" href="#__codelineno-26-106"></a>
<a id="__codelineno-26-107" name="__codelineno-26-107" href="#__codelineno-26-107"></a>test_git_detection_nested<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-26-108" name="__codelineno-26-108" href="#__codelineno-26-108"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test: Git detection - nested directories&quot;</span>
<a id="__codelineno-26-109" name="__codelineno-26-109" href="#__codelineno-26-109"></a>
<a id="__codelineno-26-110" name="__codelineno-26-110" href="#__codelineno-26-110"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">test_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TEST_HOME</span><span class="s2">/test-git-nested&quot;</span>
<a id="__codelineno-26-111" name="__codelineno-26-111" href="#__codelineno-26-111"></a><span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">/subdir/.git&quot;</span>
<a id="__codelineno-26-112" name="__codelineno-26-112" href="#__codelineno-26-112"></a><span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">/another/.git&quot;</span>
<a id="__codelineno-26-113" name="__codelineno-26-113" href="#__codelineno-26-113"></a>
<a id="__codelineno-26-114" name="__codelineno-26-114" href="#__codelineno-26-114"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">result</span><span class="o">=</span><span class="k">$(</span>_dot_check_git_in_path<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">&quot;</span><span class="k">)</span>
<a id="__codelineno-26-115" name="__codelineno-26-115" href="#__codelineno-26-115"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">git_count</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$result</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-w<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="k">)</span>
<a id="__codelineno-26-116" name="__codelineno-26-116" href="#__codelineno-26-116"></a>
<a id="__codelineno-26-117" name="__codelineno-26-117" href="#__codelineno-26-117"></a><span class="w">    </span>assert_equals<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$git_count</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;2&quot;</span><span class="w"> </span><span class="s2">&quot;Detects multiple nested .git dirs&quot;</span>
<a id="__codelineno-26-118" name="__codelineno-26-118" href="#__codelineno-26-118"></a><span class="o">}</span>
<a id="__codelineno-26-119" name="__codelineno-26-119" href="#__codelineno-26-119"></a>
<a id="__codelineno-26-120" name="__codelineno-26-120" href="#__codelineno-26-120"></a>test_ignore_add<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-26-121" name="__codelineno-26-121" href="#__codelineno-26-121"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test: Ignore pattern - add&quot;</span>
<a id="__codelineno-26-122" name="__codelineno-26-122" href="#__codelineno-26-122"></a>
<a id="__codelineno-26-123" name="__codelineno-26-123" href="#__codelineno-26-123"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">ignore_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TEST_HOME</span><span class="s2">/.local/share/chezmoi/.chezmoiignore&quot;</span>
<a id="__codelineno-26-124" name="__codelineno-26-124" href="#__codelineno-26-124"></a>
<a id="__codelineno-26-125" name="__codelineno-26-125" href="#__codelineno-26-125"></a><span class="w">    </span><span class="c1"># Add pattern</span>
<a id="__codelineno-26-126" name="__codelineno-26-126" href="#__codelineno-26-126"></a><span class="w">    </span>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;**/.git&quot;</span><span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null
<a id="__codelineno-26-127" name="__codelineno-26-127" href="#__codelineno-26-127"></a>
<a id="__codelineno-26-128" name="__codelineno-26-128" href="#__codelineno-26-128"></a><span class="w">    </span>assert_file_exists<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;Creates .chezmoiignore&quot;</span>
<a id="__codelineno-26-129" name="__codelineno-26-129" href="#__codelineno-26-129"></a>
<a id="__codelineno-26-130" name="__codelineno-26-130" href="#__codelineno-26-130"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">content</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="k">)</span>
<a id="__codelineno-26-131" name="__codelineno-26-131" href="#__codelineno-26-131"></a><span class="w">    </span>assert_contains<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$content</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;**/.git&quot;</span><span class="w"> </span><span class="s2">&quot;Adds pattern to file&quot;</span>
<a id="__codelineno-26-132" name="__codelineno-26-132" href="#__codelineno-26-132"></a><span class="o">}</span>
<a id="__codelineno-26-133" name="__codelineno-26-133" href="#__codelineno-26-133"></a>
<a id="__codelineno-26-134" name="__codelineno-26-134" href="#__codelineno-26-134"></a>test_ignore_list<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-26-135" name="__codelineno-26-135" href="#__codelineno-26-135"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test: Ignore pattern - list&quot;</span>
<a id="__codelineno-26-136" name="__codelineno-26-136" href="#__codelineno-26-136"></a>
<a id="__codelineno-26-137" name="__codelineno-26-137" href="#__codelineno-26-137"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">ignore_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TEST_HOME</span><span class="s2">/.local/share/chezmoi/.chezmoiignore&quot;</span>
<a id="__codelineno-26-138" name="__codelineno-26-138" href="#__codelineno-26-138"></a>
<a id="__codelineno-26-139" name="__codelineno-26-139" href="#__codelineno-26-139"></a><span class="w">    </span><span class="c1"># Add patterns</span>
<a id="__codelineno-26-140" name="__codelineno-26-140" href="#__codelineno-26-140"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;**/.git&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span>
<a id="__codelineno-26-141" name="__codelineno-26-141" href="#__codelineno-26-141"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;*.log&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span>
<a id="__codelineno-26-142" name="__codelineno-26-142" href="#__codelineno-26-142"></a>
<a id="__codelineno-26-143" name="__codelineno-26-143" href="#__codelineno-26-143"></a><span class="w">    </span><span class="c1"># List patterns</span>
<a id="__codelineno-26-144" name="__codelineno-26-144" href="#__codelineno-26-144"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">output</span><span class="o">=</span><span class="k">$(</span>dot<span class="w"> </span>ignore<span class="w"> </span>list<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="k">)</span>
<a id="__codelineno-26-145" name="__codelineno-26-145" href="#__codelineno-26-145"></a>
<a id="__codelineno-26-146" name="__codelineno-26-146" href="#__codelineno-26-146"></a><span class="w">    </span>assert_contains<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$output</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;**/.git&quot;</span><span class="w"> </span><span class="s2">&quot;Lists first pattern&quot;</span>
<a id="__codelineno-26-147" name="__codelineno-26-147" href="#__codelineno-26-147"></a><span class="w">    </span>assert_contains<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$output</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;*.log&quot;</span><span class="w"> </span><span class="s2">&quot;Lists second pattern&quot;</span>
<a id="__codelineno-26-148" name="__codelineno-26-148" href="#__codelineno-26-148"></a><span class="o">}</span>
<a id="__codelineno-26-149" name="__codelineno-26-149" href="#__codelineno-26-149"></a>
<a id="__codelineno-26-150" name="__codelineno-26-150" href="#__codelineno-26-150"></a>test_ignore_remove<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-26-151" name="__codelineno-26-151" href="#__codelineno-26-151"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test: Ignore pattern - remove&quot;</span>
<a id="__codelineno-26-152" name="__codelineno-26-152" href="#__codelineno-26-152"></a>
<a id="__codelineno-26-153" name="__codelineno-26-153" href="#__codelineno-26-153"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">ignore_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TEST_HOME</span><span class="s2">/.local/share/chezmoi/.chezmoiignore&quot;</span>
<a id="__codelineno-26-154" name="__codelineno-26-154" href="#__codelineno-26-154"></a>
<a id="__codelineno-26-155" name="__codelineno-26-155" href="#__codelineno-26-155"></a><span class="w">    </span><span class="c1"># Add patterns</span>
<a id="__codelineno-26-156" name="__codelineno-26-156" href="#__codelineno-26-156"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;**/.git&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span>
<a id="__codelineno-26-157" name="__codelineno-26-157" href="#__codelineno-26-157"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;*.log&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span>
<a id="__codelineno-26-158" name="__codelineno-26-158" href="#__codelineno-26-158"></a>
<a id="__codelineno-26-159" name="__codelineno-26-159" href="#__codelineno-26-159"></a><span class="w">    </span><span class="c1"># Remove pattern</span>
<a id="__codelineno-26-160" name="__codelineno-26-160" href="#__codelineno-26-160"></a><span class="w">    </span>dot<span class="w"> </span>ignore<span class="w"> </span>remove<span class="w"> </span><span class="s2">&quot;*.log&quot;</span><span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null
<a id="__codelineno-26-161" name="__codelineno-26-161" href="#__codelineno-26-161"></a>
<a id="__codelineno-26-162" name="__codelineno-26-162" href="#__codelineno-26-162"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">content</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="k">)</span>
<a id="__codelineno-26-163" name="__codelineno-26-163" href="#__codelineno-26-163"></a><span class="w">    </span>assert_contains<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$content</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;**/.git&quot;</span><span class="w"> </span><span class="s2">&quot;Keeps other patterns&quot;</span>
<a id="__codelineno-26-164" name="__codelineno-26-164" href="#__codelineno-26-164"></a>
<a id="__codelineno-26-165" name="__codelineno-26-165" href="#__codelineno-26-165"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$content</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>*<span class="s2">&quot;*.log&quot;</span>*<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-26-166" name="__codelineno-26-166" href="#__codelineno-26-166"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  ‚úó Pattern not removed&quot;</span>
<a id="__codelineno-26-167" name="__codelineno-26-167" href="#__codelineno-26-167"></a><span class="w">        </span><span class="o">((</span>TESTS_FAILED++<span class="o">))</span>
<a id="__codelineno-26-168" name="__codelineno-26-168" href="#__codelineno-26-168"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-26-169" name="__codelineno-26-169" href="#__codelineno-26-169"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  ‚úì Removes specified pattern&quot;</span>
<a id="__codelineno-26-170" name="__codelineno-26-170" href="#__codelineno-26-170"></a><span class="w">        </span><span class="o">((</span>TESTS_PASSED++<span class="o">))</span>
<a id="__codelineno-26-171" name="__codelineno-26-171" href="#__codelineno-26-171"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-26-172" name="__codelineno-26-172" href="#__codelineno-26-172"></a><span class="o">}</span>
<a id="__codelineno-26-173" name="__codelineno-26-173" href="#__codelineno-26-173"></a>
<a id="__codelineno-26-174" name="__codelineno-26-174" href="#__codelineno-26-174"></a>test_preview_file_count<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-26-175" name="__codelineno-26-175" href="#__codelineno-26-175"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test: Preview - file count calculation&quot;</span>
<a id="__codelineno-26-176" name="__codelineno-26-176" href="#__codelineno-26-176"></a>
<a id="__codelineno-26-177" name="__codelineno-26-177" href="#__codelineno-26-177"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">test_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TEST_HOME</span><span class="s2">/test-preview&quot;</span>
<a id="__codelineno-26-178" name="__codelineno-26-178" href="#__codelineno-26-178"></a><span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">&quot;</span>
<a id="__codelineno-26-179" name="__codelineno-26-179" href="#__codelineno-26-179"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;test1&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">/file1.txt&quot;</span>
<a id="__codelineno-26-180" name="__codelineno-26-180" href="#__codelineno-26-180"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;test2&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">/file2.txt&quot;</span>
<a id="__codelineno-26-181" name="__codelineno-26-181" href="#__codelineno-26-181"></a>
<a id="__codelineno-26-182" name="__codelineno-26-182" href="#__codelineno-26-182"></a><span class="w">    </span><span class="c1"># Mock preview (capture output)</span>
<a id="__codelineno-26-183" name="__codelineno-26-183" href="#__codelineno-26-183"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">output</span><span class="o">=</span><span class="k">$(</span>_dot_preview_add<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;n&quot;</span><span class="k">)</span>
<a id="__codelineno-26-184" name="__codelineno-26-184" href="#__codelineno-26-184"></a>
<a id="__codelineno-26-185" name="__codelineno-26-185" href="#__codelineno-26-185"></a><span class="w">    </span>assert_contains<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$output</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;Files to add: 2&quot;</span><span class="w"> </span><span class="s2">&quot;Counts files correctly&quot;</span>
<a id="__codelineno-26-186" name="__codelineno-26-186" href="#__codelineno-26-186"></a><span class="o">}</span>
<a id="__codelineno-26-187" name="__codelineno-26-187" href="#__codelineno-26-187"></a>
<a id="__codelineno-26-188" name="__codelineno-26-188" href="#__codelineno-26-188"></a>test_preview_large_file_warning<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-26-189" name="__codelineno-26-189" href="#__codelineno-26-189"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test: Preview - large file warning&quot;</span>
<a id="__codelineno-26-190" name="__codelineno-26-190" href="#__codelineno-26-190"></a>
<a id="__codelineno-26-191" name="__codelineno-26-191" href="#__codelineno-26-191"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">test_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TEST_HOME</span><span class="s2">/test-large&quot;</span>
<a id="__codelineno-26-192" name="__codelineno-26-192" href="#__codelineno-26-192"></a><span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">&quot;</span>
<a id="__codelineno-26-193" name="__codelineno-26-193" href="#__codelineno-26-193"></a>
<a id="__codelineno-26-194" name="__codelineno-26-194" href="#__codelineno-26-194"></a><span class="w">    </span><span class="c1"># Create large file (100KB)</span>
<a id="__codelineno-26-195" name="__codelineno-26-195" href="#__codelineno-26-195"></a><span class="w">    </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/zero<span class="w"> </span><span class="nv">of</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">/large.bin&quot;</span><span class="w"> </span><span class="nv">bs</span><span class="o">=</span><span class="m">1024</span><span class="w"> </span><span class="nv">count</span><span class="o">=</span><span class="m">100</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null
<a id="__codelineno-26-196" name="__codelineno-26-196" href="#__codelineno-26-196"></a>
<a id="__codelineno-26-197" name="__codelineno-26-197" href="#__codelineno-26-197"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">output</span><span class="o">=</span><span class="k">$(</span>_dot_preview_add<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;n&quot;</span><span class="k">)</span>
<a id="__codelineno-26-198" name="__codelineno-26-198" href="#__codelineno-26-198"></a>
<a id="__codelineno-26-199" name="__codelineno-26-199" href="#__codelineno-26-199"></a><span class="w">    </span>assert_contains<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$output</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;Large files detected&quot;</span><span class="w"> </span><span class="s2">&quot;Warns about large files&quot;</span>
<a id="__codelineno-26-200" name="__codelineno-26-200" href="#__codelineno-26-200"></a><span class="o">}</span>
<a id="__codelineno-26-201" name="__codelineno-26-201" href="#__codelineno-26-201"></a>
<a id="__codelineno-26-202" name="__codelineno-26-202" href="#__codelineno-26-202"></a>test_cross_platform_file_size<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-26-203" name="__codelineno-26-203" href="#__codelineno-26-203"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test: Cross-platform - file size helper&quot;</span>
<a id="__codelineno-26-204" name="__codelineno-26-204" href="#__codelineno-26-204"></a>
<a id="__codelineno-26-205" name="__codelineno-26-205" href="#__codelineno-26-205"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">test_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TEST_HOME</span><span class="s2">/test-size.txt&quot;</span>
<a id="__codelineno-26-206" name="__codelineno-26-206" href="#__codelineno-26-206"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;test content&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_file</span><span class="s2">&quot;</span>
<a id="__codelineno-26-207" name="__codelineno-26-207" href="#__codelineno-26-207"></a>
<a id="__codelineno-26-208" name="__codelineno-26-208" href="#__codelineno-26-208"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="k">$(</span>_flow_get_file_size<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_file</span><span class="s2">&quot;</span><span class="k">)</span>
<a id="__codelineno-26-209" name="__codelineno-26-209" href="#__codelineno-26-209"></a>
<a id="__codelineno-26-210" name="__codelineno-26-210" href="#__codelineno-26-210"></a><span class="w">    </span><span class="c1"># Should return a number</span>
<a id="__codelineno-26-211" name="__codelineno-26-211" href="#__codelineno-26-211"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$size</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>^<span class="o">[</span><span class="m">0</span>-9<span class="o">]</span>+$<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-26-212" name="__codelineno-26-212" href="#__codelineno-26-212"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  ‚úì Returns numeric size&quot;</span>
<a id="__codelineno-26-213" name="__codelineno-26-213" href="#__codelineno-26-213"></a><span class="w">        </span><span class="o">((</span>TESTS_PASSED++<span class="o">))</span>
<a id="__codelineno-26-214" name="__codelineno-26-214" href="#__codelineno-26-214"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-26-215" name="__codelineno-26-215" href="#__codelineno-26-215"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  ‚úó Invalid size: </span><span class="nv">$size</span><span class="s2">&quot;</span>
<a id="__codelineno-26-216" name="__codelineno-26-216" href="#__codelineno-26-216"></a><span class="w">        </span><span class="o">((</span>TESTS_FAILED++<span class="o">))</span>
<a id="__codelineno-26-217" name="__codelineno-26-217" href="#__codelineno-26-217"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-26-218" name="__codelineno-26-218" href="#__codelineno-26-218"></a><span class="o">}</span>
<a id="__codelineno-26-219" name="__codelineno-26-219" href="#__codelineno-26-219"></a>
<a id="__codelineno-26-220" name="__codelineno-26-220" href="#__codelineno-26-220"></a>test_cross_platform_human_size<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-26-221" name="__codelineno-26-221" href="#__codelineno-26-221"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test: Cross-platform - human-readable size&quot;</span>
<a id="__codelineno-26-222" name="__codelineno-26-222" href="#__codelineno-26-222"></a>
<a id="__codelineno-26-223" name="__codelineno-26-223" href="#__codelineno-26-223"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="k">$(</span>_flow_human_size<span class="w"> </span><span class="m">1048576</span><span class="k">)</span><span class="w">  </span><span class="c1"># 1MB</span>
<a id="__codelineno-26-224" name="__codelineno-26-224" href="#__codelineno-26-224"></a>
<a id="__codelineno-26-225" name="__codelineno-26-225" href="#__codelineno-26-225"></a><span class="w">    </span>assert_contains<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$size</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;MB&quot;</span><span class="w"> </span><span class="s2">&quot;Converts bytes to MB&quot;</span>
<a id="__codelineno-26-226" name="__codelineno-26-226" href="#__codelineno-26-226"></a><span class="o">}</span>
<a id="__codelineno-26-227" name="__codelineno-26-227" href="#__codelineno-26-227"></a>
<a id="__codelineno-26-228" name="__codelineno-26-228" href="#__codelineno-26-228"></a><span class="c1"># ============================================================================</span>
<a id="__codelineno-26-229" name="__codelineno-26-229" href="#__codelineno-26-229"></a><span class="c1"># Negative Tests</span>
<a id="__codelineno-26-230" name="__codelineno-26-230" href="#__codelineno-26-230"></a><span class="c1"># ============================================================================</span>
<a id="__codelineno-26-231" name="__codelineno-26-231" href="#__codelineno-26-231"></a>
<a id="__codelineno-26-232" name="__codelineno-26-232" href="#__codelineno-26-232"></a>test_no_chezmoi_installed<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-26-233" name="__codelineno-26-233" href="#__codelineno-26-233"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test: Negative - chezmoi not installed&quot;</span>
<a id="__codelineno-26-234" name="__codelineno-26-234" href="#__codelineno-26-234"></a>
<a id="__codelineno-26-235" name="__codelineno-26-235" href="#__codelineno-26-235"></a><span class="w">    </span><span class="c1"># Temporarily hide chezmoi</span>
<a id="__codelineno-26-236" name="__codelineno-26-236" href="#__codelineno-26-236"></a><span class="w">    </span>chezmoi<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">127</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-26-237" name="__codelineno-26-237" href="#__codelineno-26-237"></a>
<a id="__codelineno-26-238" name="__codelineno-26-238" href="#__codelineno-26-238"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">output</span><span class="o">=</span><span class="k">$(</span>dot<span class="w"> </span>size<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="k">)</span>
<a id="__codelineno-26-239" name="__codelineno-26-239" href="#__codelineno-26-239"></a>
<a id="__codelineno-26-240" name="__codelineno-26-240" href="#__codelineno-26-240"></a><span class="w">    </span>assert_contains<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$output</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;not found&quot;</span><span class="w"> </span><span class="s2">&quot;Handles missing chezmoi&quot;</span>
<a id="__codelineno-26-241" name="__codelineno-26-241" href="#__codelineno-26-241"></a>
<a id="__codelineno-26-242" name="__codelineno-26-242" href="#__codelineno-26-242"></a><span class="w">    </span><span class="nb">unset</span><span class="w"> </span>-f<span class="w"> </span>chezmoi
<a id="__codelineno-26-243" name="__codelineno-26-243" href="#__codelineno-26-243"></a><span class="o">}</span>
<a id="__codelineno-26-244" name="__codelineno-26-244" href="#__codelineno-26-244"></a>
<a id="__codelineno-26-245" name="__codelineno-26-245" href="#__codelineno-26-245"></a>test_readonly_chezmoi_dir<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-26-246" name="__codelineno-26-246" href="#__codelineno-26-246"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test: Negative - read-only chezmoi directory&quot;</span>
<a id="__codelineno-26-247" name="__codelineno-26-247" href="#__codelineno-26-247"></a>
<a id="__codelineno-26-248" name="__codelineno-26-248" href="#__codelineno-26-248"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">chezmoi_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TEST_HOME</span><span class="s2">/.local/share/chezmoi&quot;</span>
<a id="__codelineno-26-249" name="__codelineno-26-249" href="#__codelineno-26-249"></a><span class="w">    </span>chmod<span class="w"> </span><span class="m">000</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$chezmoi_dir</span><span class="s2">&quot;</span>
<a id="__codelineno-26-250" name="__codelineno-26-250" href="#__codelineno-26-250"></a>
<a id="__codelineno-26-251" name="__codelineno-26-251" href="#__codelineno-26-251"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">output</span><span class="o">=</span><span class="k">$(</span>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;*.log&quot;</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="k">)</span>
<a id="__codelineno-26-252" name="__codelineno-26-252" href="#__codelineno-26-252"></a>
<a id="__codelineno-26-253" name="__codelineno-26-253" href="#__codelineno-26-253"></a><span class="w">    </span><span class="c1"># Should fail gracefully</span>
<a id="__codelineno-26-254" name="__codelineno-26-254" href="#__codelineno-26-254"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-26-255" name="__codelineno-26-255" href="#__codelineno-26-255"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  ‚úì Fails gracefully on permission error&quot;</span>
<a id="__codelineno-26-256" name="__codelineno-26-256" href="#__codelineno-26-256"></a><span class="w">        </span><span class="o">((</span>TESTS_PASSED++<span class="o">))</span>
<a id="__codelineno-26-257" name="__codelineno-26-257" href="#__codelineno-26-257"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-26-258" name="__codelineno-26-258" href="#__codelineno-26-258"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  ‚úó Should fail on read-only directory&quot;</span>
<a id="__codelineno-26-259" name="__codelineno-26-259" href="#__codelineno-26-259"></a><span class="w">        </span><span class="o">((</span>TESTS_FAILED++<span class="o">))</span>
<a id="__codelineno-26-260" name="__codelineno-26-260" href="#__codelineno-26-260"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-26-261" name="__codelineno-26-261" href="#__codelineno-26-261"></a>
<a id="__codelineno-26-262" name="__codelineno-26-262" href="#__codelineno-26-262"></a><span class="w">    </span>chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$chezmoi_dir</span><span class="s2">&quot;</span>
<a id="__codelineno-26-263" name="__codelineno-26-263" href="#__codelineno-26-263"></a><span class="o">}</span>
<a id="__codelineno-26-264" name="__codelineno-26-264" href="#__codelineno-26-264"></a>
<a id="__codelineno-26-265" name="__codelineno-26-265" href="#__codelineno-26-265"></a>test_invalid_path<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-26-266" name="__codelineno-26-266" href="#__codelineno-26-266"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test: Negative - invalid path&quot;</span>
<a id="__codelineno-26-267" name="__codelineno-26-267" href="#__codelineno-26-267"></a>
<a id="__codelineno-26-268" name="__codelineno-26-268" href="#__codelineno-26-268"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">output</span><span class="o">=</span><span class="k">$(</span>dot<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;/nonexistent/path&quot;</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;n&quot;</span><span class="k">)</span>
<a id="__codelineno-26-269" name="__codelineno-26-269" href="#__codelineno-26-269"></a>
<a id="__codelineno-26-270" name="__codelineno-26-270" href="#__codelineno-26-270"></a><span class="w">    </span>assert_contains<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$output</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;does not exist&quot;</span><span class="w"> </span><span class="s2">&quot;Handles non-existent path&quot;</span>
<a id="__codelineno-26-271" name="__codelineno-26-271" href="#__codelineno-26-271"></a><span class="o">}</span>
<a id="__codelineno-26-272" name="__codelineno-26-272" href="#__codelineno-26-272"></a>
<a id="__codelineno-26-273" name="__codelineno-26-273" href="#__codelineno-26-273"></a><span class="c1"># ============================================================================</span>
<a id="__codelineno-26-274" name="__codelineno-26-274" href="#__codelineno-26-274"></a><span class="c1"># Performance Tests</span>
<a id="__codelineno-26-275" name="__codelineno-26-275" href="#__codelineno-26-275"></a><span class="c1"># ============================================================================</span>
<a id="__codelineno-26-276" name="__codelineno-26-276" href="#__codelineno-26-276"></a>
<a id="__codelineno-26-277" name="__codelineno-26-277" href="#__codelineno-26-277"></a>test_large_directory_performance<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-26-278" name="__codelineno-26-278" href="#__codelineno-26-278"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test: Performance - large directory&quot;</span>
<a id="__codelineno-26-279" name="__codelineno-26-279" href="#__codelineno-26-279"></a>
<a id="__codelineno-26-280" name="__codelineno-26-280" href="#__codelineno-26-280"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">test_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TEST_HOME</span><span class="s2">/test-perf&quot;</span>
<a id="__codelineno-26-281" name="__codelineno-26-281" href="#__codelineno-26-281"></a><span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">&quot;</span>
<a id="__codelineno-26-282" name="__codelineno-26-282" href="#__codelineno-26-282"></a>
<a id="__codelineno-26-283" name="__codelineno-26-283" href="#__codelineno-26-283"></a><span class="w">    </span><span class="c1"># Create 100 files (reduced from 1000 for faster tests)</span>
<a id="__codelineno-26-284" name="__codelineno-26-284" href="#__codelineno-26-284"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">1</span>..100<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-26-285" name="__codelineno-26-285" href="#__codelineno-26-285"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;test</span><span class="nv">$i</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">/file-</span><span class="nv">$i</span><span class="s2">.txt&quot;</span>
<a id="__codelineno-26-286" name="__codelineno-26-286" href="#__codelineno-26-286"></a><span class="w">    </span><span class="k">done</span>
<a id="__codelineno-26-287" name="__codelineno-26-287" href="#__codelineno-26-287"></a>
<a id="__codelineno-26-288" name="__codelineno-26-288" href="#__codelineno-26-288"></a><span class="w">    </span><span class="c1"># Time the git detection</span>
<a id="__codelineno-26-289" name="__codelineno-26-289" href="#__codelineno-26-289"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">start</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%s%3N<span class="k">)</span>
<a id="__codelineno-26-290" name="__codelineno-26-290" href="#__codelineno-26-290"></a><span class="w">    </span>_dot_check_git_in_path<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null
<a id="__codelineno-26-291" name="__codelineno-26-291" href="#__codelineno-26-291"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">end</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%s%3N<span class="k">)</span>
<a id="__codelineno-26-292" name="__codelineno-26-292" href="#__codelineno-26-292"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="k">$((</span><span class="nv">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">start</span><span class="k">))</span>
<a id="__codelineno-26-293" name="__codelineno-26-293" href="#__codelineno-26-293"></a>
<a id="__codelineno-26-294" name="__codelineno-26-294" href="#__codelineno-26-294"></a><span class="w">    </span><span class="c1"># Should complete in &lt; 2000ms</span>
<a id="__codelineno-26-295" name="__codelineno-26-295" href="#__codelineno-26-295"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>duration<span class="w"> </span>&lt;<span class="w"> </span><span class="m">2000</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-26-296" name="__codelineno-26-296" href="#__codelineno-26-296"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  ‚úì Git detection completed in </span><span class="si">${</span><span class="nv">duration</span><span class="si">}</span><span class="s2">ms (&lt; 2000ms)&quot;</span>
<a id="__codelineno-26-297" name="__codelineno-26-297" href="#__codelineno-26-297"></a><span class="w">        </span><span class="o">((</span>TESTS_PASSED++<span class="o">))</span>
<a id="__codelineno-26-298" name="__codelineno-26-298" href="#__codelineno-26-298"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-26-299" name="__codelineno-26-299" href="#__codelineno-26-299"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  ‚úó Git detection too slow: </span><span class="si">${</span><span class="nv">duration</span><span class="si">}</span><span class="s2">ms&quot;</span>
<a id="__codelineno-26-300" name="__codelineno-26-300" href="#__codelineno-26-300"></a><span class="w">        </span><span class="o">((</span>TESTS_FAILED++<span class="o">))</span>
<a id="__codelineno-26-301" name="__codelineno-26-301" href="#__codelineno-26-301"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-26-302" name="__codelineno-26-302" href="#__codelineno-26-302"></a><span class="o">}</span>
<a id="__codelineno-26-303" name="__codelineno-26-303" href="#__codelineno-26-303"></a>
<a id="__codelineno-26-304" name="__codelineno-26-304" href="#__codelineno-26-304"></a><span class="c1"># ============================================================================</span>
<a id="__codelineno-26-305" name="__codelineno-26-305" href="#__codelineno-26-305"></a><span class="c1"># Integration Tests</span>
<a id="__codelineno-26-306" name="__codelineno-26-306" href="#__codelineno-26-306"></a><span class="c1"># ============================================================================</span>
<a id="__codelineno-26-307" name="__codelineno-26-307" href="#__codelineno-26-307"></a>
<a id="__codelineno-26-308" name="__codelineno-26-308" href="#__codelineno-26-308"></a>test_full_workflow_git_detection<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-26-309" name="__codelineno-26-309" href="#__codelineno-26-309"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test: Integration - full workflow with git detection&quot;</span>
<a id="__codelineno-26-310" name="__codelineno-26-310" href="#__codelineno-26-310"></a>
<a id="__codelineno-26-311" name="__codelineno-26-311" href="#__codelineno-26-311"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">test_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TEST_HOME</span><span class="s2">/test-workflow&quot;</span>
<a id="__codelineno-26-312" name="__codelineno-26-312" href="#__codelineno-26-312"></a><span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">/.git&quot;</span>
<a id="__codelineno-26-313" name="__codelineno-26-313" href="#__codelineno-26-313"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;config&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">/config.txt&quot;</span>
<a id="__codelineno-26-314" name="__codelineno-26-314" href="#__codelineno-26-314"></a>
<a id="__codelineno-26-315" name="__codelineno-26-315" href="#__codelineno-26-315"></a><span class="w">    </span><span class="c1"># Simulate: dot add with git detection and auto-ignore</span>
<a id="__codelineno-26-316" name="__codelineno-26-316" href="#__codelineno-26-316"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">output</span><span class="o">=</span><span class="k">$(</span>dot<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="s2">&quot;y</span>
<a id="__codelineno-26-317" name="__codelineno-26-317" href="#__codelineno-26-317"></a><span class="s2">y&quot;</span><span class="k">)</span>
<a id="__codelineno-26-318" name="__codelineno-26-318" href="#__codelineno-26-318"></a>
<a id="__codelineno-26-319" name="__codelineno-26-319" href="#__codelineno-26-319"></a><span class="w">    </span>assert_contains<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$output</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;Git directory detected&quot;</span><span class="w"> </span><span class="s2">&quot;Warns about git&quot;</span>
<a id="__codelineno-26-320" name="__codelineno-26-320" href="#__codelineno-26-320"></a><span class="w">    </span>assert_contains<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$output</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;Added&quot;</span><span class="w"> </span><span class="s2">&quot;Completes add operation&quot;</span>
<a id="__codelineno-26-321" name="__codelineno-26-321" href="#__codelineno-26-321"></a>
<a id="__codelineno-26-322" name="__codelineno-26-322" href="#__codelineno-26-322"></a><span class="w">    </span><span class="c1"># Verify .chezmoiignore was updated</span>
<a id="__codelineno-26-323" name="__codelineno-26-323" href="#__codelineno-26-323"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">ignore_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TEST_HOME</span><span class="s2">/.local/share/chezmoi/.chezmoiignore&quot;</span>
<a id="__codelineno-26-324" name="__codelineno-26-324" href="#__codelineno-26-324"></a><span class="w">    </span>assert_file_exists<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;Creates .chezmoiignore&quot;</span>
<a id="__codelineno-26-325" name="__codelineno-26-325" href="#__codelineno-26-325"></a><span class="o">}</span>
<a id="__codelineno-26-326" name="__codelineno-26-326" href="#__codelineno-26-326"></a>
<a id="__codelineno-26-327" name="__codelineno-26-327" href="#__codelineno-26-327"></a><span class="c1"># ============================================================================</span>
<a id="__codelineno-26-328" name="__codelineno-26-328" href="#__codelineno-26-328"></a><span class="c1"># Run Tests</span>
<a id="__codelineno-26-329" name="__codelineno-26-329" href="#__codelineno-26-329"></a><span class="c1"># ============================================================================</span>
<a id="__codelineno-26-330" name="__codelineno-26-330" href="#__codelineno-26-330"></a>
<a id="__codelineno-26-331" name="__codelineno-26-331" href="#__codelineno-26-331"></a>main<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-26-332" name="__codelineno-26-332" href="#__codelineno-26-332"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;================================&quot;</span>
<a id="__codelineno-26-333" name="__codelineno-26-333" href="#__codelineno-26-333"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Dot Dispatcher Safety Tests&quot;</span>
<a id="__codelineno-26-334" name="__codelineno-26-334" href="#__codelineno-26-334"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;================================&quot;</span>
<a id="__codelineno-26-335" name="__codelineno-26-335" href="#__codelineno-26-335"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-26-336" name="__codelineno-26-336" href="#__codelineno-26-336"></a>
<a id="__codelineno-26-337" name="__codelineno-26-337" href="#__codelineno-26-337"></a><span class="w">    </span>test_setup
<a id="__codelineno-26-338" name="__codelineno-26-338" href="#__codelineno-26-338"></a>
<a id="__codelineno-26-339" name="__codelineno-26-339" href="#__codelineno-26-339"></a><span class="w">    </span><span class="c1"># Unit tests</span>
<a id="__codelineno-26-340" name="__codelineno-26-340" href="#__codelineno-26-340"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;--- Unit Tests ---&quot;</span>
<a id="__codelineno-26-341" name="__codelineno-26-341" href="#__codelineno-26-341"></a><span class="w">    </span>test_git_detection_single_dir
<a id="__codelineno-26-342" name="__codelineno-26-342" href="#__codelineno-26-342"></a><span class="w">    </span>test_git_detection_nested
<a id="__codelineno-26-343" name="__codelineno-26-343" href="#__codelineno-26-343"></a><span class="w">    </span>test_ignore_add
<a id="__codelineno-26-344" name="__codelineno-26-344" href="#__codelineno-26-344"></a><span class="w">    </span>test_ignore_list
<a id="__codelineno-26-345" name="__codelineno-26-345" href="#__codelineno-26-345"></a><span class="w">    </span>test_ignore_remove
<a id="__codelineno-26-346" name="__codelineno-26-346" href="#__codelineno-26-346"></a><span class="w">    </span>test_preview_file_count
<a id="__codelineno-26-347" name="__codelineno-26-347" href="#__codelineno-26-347"></a><span class="w">    </span>test_preview_large_file_warning
<a id="__codelineno-26-348" name="__codelineno-26-348" href="#__codelineno-26-348"></a><span class="w">    </span>test_cross_platform_file_size
<a id="__codelineno-26-349" name="__codelineno-26-349" href="#__codelineno-26-349"></a><span class="w">    </span>test_cross_platform_human_size
<a id="__codelineno-26-350" name="__codelineno-26-350" href="#__codelineno-26-350"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-26-351" name="__codelineno-26-351" href="#__codelineno-26-351"></a>
<a id="__codelineno-26-352" name="__codelineno-26-352" href="#__codelineno-26-352"></a><span class="w">    </span><span class="c1"># Negative tests</span>
<a id="__codelineno-26-353" name="__codelineno-26-353" href="#__codelineno-26-353"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;--- Negative Tests ---&quot;</span>
<a id="__codelineno-26-354" name="__codelineno-26-354" href="#__codelineno-26-354"></a><span class="w">    </span>test_no_chezmoi_installed
<a id="__codelineno-26-355" name="__codelineno-26-355" href="#__codelineno-26-355"></a><span class="w">    </span>test_readonly_chezmoi_dir
<a id="__codelineno-26-356" name="__codelineno-26-356" href="#__codelineno-26-356"></a><span class="w">    </span>test_invalid_path
<a id="__codelineno-26-357" name="__codelineno-26-357" href="#__codelineno-26-357"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-26-358" name="__codelineno-26-358" href="#__codelineno-26-358"></a>
<a id="__codelineno-26-359" name="__codelineno-26-359" href="#__codelineno-26-359"></a><span class="w">    </span><span class="c1"># Performance tests</span>
<a id="__codelineno-26-360" name="__codelineno-26-360" href="#__codelineno-26-360"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;--- Performance Tests ---&quot;</span>
<a id="__codelineno-26-361" name="__codelineno-26-361" href="#__codelineno-26-361"></a><span class="w">    </span>test_large_directory_performance
<a id="__codelineno-26-362" name="__codelineno-26-362" href="#__codelineno-26-362"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-26-363" name="__codelineno-26-363" href="#__codelineno-26-363"></a>
<a id="__codelineno-26-364" name="__codelineno-26-364" href="#__codelineno-26-364"></a><span class="w">    </span><span class="c1"># Integration tests</span>
<a id="__codelineno-26-365" name="__codelineno-26-365" href="#__codelineno-26-365"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;--- Integration Tests ---&quot;</span>
<a id="__codelineno-26-366" name="__codelineno-26-366" href="#__codelineno-26-366"></a><span class="w">    </span>test_full_workflow_git_detection
<a id="__codelineno-26-367" name="__codelineno-26-367" href="#__codelineno-26-367"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-26-368" name="__codelineno-26-368" href="#__codelineno-26-368"></a>
<a id="__codelineno-26-369" name="__codelineno-26-369" href="#__codelineno-26-369"></a><span class="w">    </span>test_teardown
<a id="__codelineno-26-370" name="__codelineno-26-370" href="#__codelineno-26-370"></a>
<a id="__codelineno-26-371" name="__codelineno-26-371" href="#__codelineno-26-371"></a><span class="w">    </span><span class="c1"># Summary</span>
<a id="__codelineno-26-372" name="__codelineno-26-372" href="#__codelineno-26-372"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;================================&quot;</span>
<a id="__codelineno-26-373" name="__codelineno-26-373" href="#__codelineno-26-373"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test Results&quot;</span>
<a id="__codelineno-26-374" name="__codelineno-26-374" href="#__codelineno-26-374"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;================================&quot;</span>
<a id="__codelineno-26-375" name="__codelineno-26-375" href="#__codelineno-26-375"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Passed: </span><span class="nv">$TESTS_PASSED</span><span class="s2">&quot;</span>
<a id="__codelineno-26-376" name="__codelineno-26-376" href="#__codelineno-26-376"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Failed: </span><span class="nv">$TESTS_FAILED</span><span class="s2">&quot;</span>
<a id="__codelineno-26-377" name="__codelineno-26-377" href="#__codelineno-26-377"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-26-378" name="__codelineno-26-378" href="#__codelineno-26-378"></a>
<a id="__codelineno-26-379" name="__codelineno-26-379" href="#__codelineno-26-379"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>TESTS_FAILED<span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-26-380" name="__codelineno-26-380" href="#__codelineno-26-380"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;‚ùå Some tests failed&quot;</span>
<a id="__codelineno-26-381" name="__codelineno-26-381" href="#__codelineno-26-381"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-26-382" name="__codelineno-26-382" href="#__codelineno-26-382"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-26-383" name="__codelineno-26-383" href="#__codelineno-26-383"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;‚úÖ All tests passed&quot;</span>
<a id="__codelineno-26-384" name="__codelineno-26-384" href="#__codelineno-26-384"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-26-385" name="__codelineno-26-385" href="#__codelineno-26-385"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-26-386" name="__codelineno-26-386" href="#__codelineno-26-386"></a><span class="o">}</span>
<a id="__codelineno-26-387" name="__codelineno-26-387" href="#__codelineno-26-387"></a>
<a id="__codelineno-26-388" name="__codelineno-26-388" href="#__codelineno-26-388"></a><span class="c1"># Run tests if executed directly</span>
<a id="__codelineno-26-389" name="__codelineno-26-389" href="#__codelineno-26-389"></a><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">ZSH_EVAL_CONTEXT</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;toplevel&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-26-390" name="__codelineno-26-390" href="#__codelineno-26-390"></a><span class="w">    </span>main<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
<a id="__codelineno-26-391" name="__codelineno-26-391" href="#__codelineno-26-391"></a><span class="k">fi</span>
</code></pre></div>
<h3 id="integration-with-testsrun-allsh">Integration with <code>./tests/run-all.sh</code><a class="headerlink" href="#integration-with-testsrun-allsh" title="Permanent link">&para;</a></h3>
<p>Add to <code>tests/run-all.sh</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1"># Add after existing test suites</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running dot chezmoi safety tests...&quot;</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>./tests/test-dot-chezmoi-safety.zsh<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nv">FAILED</span><span class="o">=</span><span class="k">$((</span><span class="nv">FAILED</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="k">))</span>
</code></pre></div>
<hr />
<h2 id="migration-guide-for-existing-users">Migration Guide for Existing Users<a class="headerlink" href="#migration-guide-for-existing-users" title="Permanent link">&para;</a></h2>
<h3 id="for-users-who-already-have-git-directories-tracked">For Users Who Already Have <code>.git</code> Directories Tracked<a class="headerlink" href="#for-users-who-already-have-git-directories-tracked" title="Permanent link">&para;</a></h3>
<p>If you're already using chezmoi and may have accidentally tracked <code>.git</code> directories, follow this migration process:</p>
<h4 id="step-1-audit-your-repository">Step 1: Audit Your Repository<a class="headerlink" href="#step-1-audit-your-repository" title="Permanent link">&para;</a></h4>
<p>Check what's currently tracked:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># View repository size</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>dot<span class="w"> </span>size
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="c1"># Expected output:</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>Chezmoi<span class="w"> </span>Repository<span class="w"> </span>Size
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>Total:<span class="w"> </span><span class="m">1</span>.4<span class="w"> </span>MB
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>Top<span class="w"> </span><span class="m">10</span><span class="w"> </span>largest<span class="w"> </span>files:
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="w">  </span>‚ö†Ô∏è<span class="w">  </span><span class="m">196</span><span class="w"> </span>KB<span class="w">  </span>dot_config/nvim/dot_git/objects/pack/pack-*.pack
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="w">              </span><span class="o">(</span>Git<span class="w"> </span>metadata<span class="w"> </span>-<span class="w"> </span>should<span class="w"> </span>be<span class="w"> </span>ignored<span class="o">)</span>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="w">  </span>...
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>‚ö†<span class="w"> </span>Found<span class="w"> </span><span class="m">1</span><span class="w"> </span>nested<span class="w"> </span>.git<span class="w"> </span>directory<span class="w"> </span><span class="o">(</span>should<span class="w"> </span>be<span class="w"> </span>ignored<span class="o">)</span>
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="w">  </span>Run<span class="w"> </span><span class="s1">&#39;dot ignore add &quot;**/.git&quot;&#39;</span><span class="w"> </span>to<span class="w"> </span>fix
</code></pre></div>
<p>Alternatively, check manually:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1"># Find all tracked git directories</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="nb">cd</span><span class="w"> </span>~/.local/share/chezmoi
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>find<span class="w"> </span>.<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;dot_git&quot;</span><span class="w"> </span>-type<span class="w"> </span>d
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>find<span class="w"> </span>.<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;.git&quot;</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-not<span class="w"> </span>-path<span class="w"> </span><span class="s2">&quot;./.git&quot;</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="c1"># Check specific config directories</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>ls<span class="w"> </span>-la<span class="w"> </span>~/.local/share/chezmoi/dot_config/*/dot_git
</code></pre></div>
<h4 id="step-2-add-ignore-patterns">Step 2: Add Ignore Patterns<a class="headerlink" href="#step-2-add-ignore-patterns" title="Permanent link">&para;</a></h4>
<p>Prevent future tracking of <code>.git</code> directories:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1"># Add comprehensive git ignore patterns</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;**/.git&quot;</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;**/.git/**&quot;</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;**/dot_git&quot;</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;**/dot_git/**&quot;</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="c1"># Verify patterns were added</span>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>dot<span class="w"> </span>ignore<span class="w"> </span>list
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="c1"># Expected output:</span>
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>.chezmoiignore<span class="w"> </span>patterns:
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a><span class="w">   </span><span class="m">1</span><span class="w">  </span>**/.git
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="w">   </span><span class="m">2</span><span class="w">  </span>**/.git/**
<a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a><span class="w">   </span><span class="m">3</span><span class="w">  </span>**/dot_git
<a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a><span class="w">   </span><span class="m">4</span><span class="w">  </span>**/dot_git/**
</code></pre></div>
<h4 id="step-3-remove-tracked-git-files">Step 3: Remove Tracked <code>.git</code> Files<a class="headerlink" href="#step-3-remove-tracked-git-files" title="Permanent link">&para;</a></h4>
<p>Tell chezmoi to stop tracking these files:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1"># Option 1: Remove specific directories</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>chezmoi<span class="w"> </span>forget<span class="w"> </span><span class="s1">&#39;.config/nvim/.git&#39;</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>chezmoi<span class="w"> </span>forget<span class="w"> </span><span class="s1">&#39;.config/ghostty/.git&#39;</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="c1"># Option 2: Remove all dot_git directories</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="nb">cd</span><span class="w"> </span>~/.local/share/chezmoi
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>find<span class="w"> </span>.<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;dot_git&quot;</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chezmoi<span class="w"> </span>forget<span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="c1"># Option 3: Interactive removal (recommended for safety)</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="nb">cd</span><span class="w"> </span>~/.local/share/chezmoi
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>find<span class="w"> </span>.<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;dot_git&quot;</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>gitdir<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="k">$(</span>du<span class="w"> </span>-sh<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$gitdir</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f1<span class="k">)</span>
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Remove </span><span class="nv">$gitdir</span><span class="s2"> (</span><span class="nv">$size</span><span class="s2">)? (y/N)&quot;</span>
<a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="w">    </span><span class="nb">read</span><span class="w"> </span>-q<span class="w"> </span>REPLY
<a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$REPLY</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>^<span class="o">[</span>Yy<span class="o">]</span>$<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a><span class="w">        </span>rm<span class="w"> </span>-rf<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$gitdir</span><span class="s2">&quot;</span>
<a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a><span class="k">done</span>
</code></pre></div>
<h4 id="step-4-commit-changes">Step 4: Commit Changes<a class="headerlink" href="#step-4-commit-changes" title="Permanent link">&para;</a></h4>
<p>Clean up your chezmoi repository:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1"># Review what will be removed</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="nb">cd</span><span class="w"> </span>~/.local/share/chezmoi
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>git<span class="w"> </span>status
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="c1"># Commit the cleanup</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>git<span class="w"> </span>add<span class="w"> </span>-A
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;chore: remove tracked .git directories</span>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="s2">- Added .chezmoiignore patterns for **/.git</span>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="s2">- Removed accidentally tracked git metadata</span>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a><span class="s2">- Reduced repository size by removing redundant files&quot;</span>
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>
<a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a><span class="c1"># Push to remote</span>
<a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a>git<span class="w"> </span>push
</code></pre></div>
<h4 id="step-5-verify-cleanup">Step 5: Verify Cleanup<a class="headerlink" href="#step-5-verify-cleanup" title="Permanent link">&para;</a></h4>
<p>Confirm everything is clean:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1"># Check repository size again</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>dot<span class="w"> </span>size
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="c1"># Expected output:</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>Chezmoi<span class="w"> </span>Repository<span class="w"> </span>Size
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>Total:<span class="w"> </span><span class="m">1</span>.2<span class="w"> </span>MB<span class="w">  </span><span class="o">(</span>was<span class="w"> </span><span class="m">1</span>.4<span class="w"> </span>MB<span class="o">)</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>‚úì<span class="w"> </span>No<span class="w"> </span>nested<span class="w"> </span>git<span class="w"> </span>directories<span class="w"> </span>tracked
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="c1"># Run health check</span>
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>flow<span class="w"> </span>doctor
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a>
<a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="c1"># Expected: All chezmoi checks should pass</span>
</code></pre></div>
<h4 id="step-6-re-add-directories-clean">Step 6: Re-add Directories (Clean)<a class="headerlink" href="#step-6-re-add-directories-clean" title="Permanent link">&para;</a></h4>
<p>Now you can safely re-add directories without <code>.git</code> files:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># The new safety features will prevent .git from being tracked</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>dot<span class="w"> </span>add<span class="w"> </span>~/.config/nvim
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="c1"># Expected output:</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>‚ö†Ô∏è<span class="w">  </span>Git<span class="w"> </span>directory<span class="w"> </span>detected<span class="w"> </span><span class="k">in</span><span class="w"> </span>/Users/dt/.config/nvim
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="w">    </span>Git<span class="w"> </span>metadata<span class="w"> </span>should<span class="w"> </span>not<span class="w"> </span>be<span class="w"> </span>tracked<span class="w"> </span>by<span class="w"> </span>chezmoi.
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>Auto-create<span class="w"> </span>ignore<span class="w"> </span>rule?<span class="w"> </span><span class="o">(</span>Y/n<span class="o">)</span>:<span class="w"> </span>y
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>‚úì<span class="w"> </span>Added<span class="w"> </span>.config/nvim/.git<span class="w"> </span>to<span class="w"> </span>.chezmoiignore
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>‚úì<span class="w"> </span>Added<span class="w"> </span>.config/nvim/.git/**<span class="w"> </span>to<span class="w"> </span>.chezmoiignore
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>Preview:<span class="w"> </span>dot<span class="w"> </span>add<span class="w"> </span>/Users/dt/.config/nvim
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
<a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a>Files<span class="w"> </span>to<span class="w"> </span>add:<span class="w"> </span><span class="m">12</span>
<a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a>Total<span class="w"> </span>size:<span class="w"> </span><span class="m">24</span><span class="w"> </span>KB
<a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>
<a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a>Proceed<span class="w"> </span>with<span class="w"> </span>add?<span class="w"> </span><span class="o">(</span>Y/n<span class="o">)</span>:<span class="w"> </span>y
<a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a>‚úì<span class="w"> </span>Added<span class="w"> </span>/Users/dt/.config/nvim<span class="w"> </span>to<span class="w"> </span>chezmoi
</code></pre></div>
<h3 id="common-patterns-to-add-to-chezmoiignore">Common Patterns to Add to <code>.chezmoiignore</code><a class="headerlink" href="#common-patterns-to-add-to-chezmoiignore" title="Permanent link">&para;</a></h3>
<p>After migration, consider adding these common patterns:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1"># Generated files</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;*.log&quot;</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;*.sqlite&quot;</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;*.sqlite-*&quot;</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;*.db&quot;</span>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;*.cache&quot;</span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="c1"># macOS</span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;.DS_Store&quot;</span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="c1"># Temporary files</span>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;*.tmp&quot;</span>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;*.swp&quot;</span>
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;*~&quot;</span>
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a>
<a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a><span class="c1"># Build artifacts</span>
<a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;node_modules/&quot;</span>
<a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;__pycache__/&quot;</span>
<a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;*.pyc&quot;</span>
<a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a>
<a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a><span class="c1"># Editor artifacts</span>
<a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;.vscode/&quot;</span>
<a id="__codelineno-35-23" name="__codelineno-35-23" href="#__codelineno-35-23"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;.idea/&quot;</span>
<a id="__codelineno-35-24" name="__codelineno-35-24" href="#__codelineno-35-24"></a>
<a id="__codelineno-35-25" name="__codelineno-35-25" href="#__codelineno-35-25"></a><span class="c1"># Lazy.nvim state (changes frequently)</span>
<a id="__codelineno-35-26" name="__codelineno-35-26" href="#__codelineno-35-26"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;nvim/lazy-lock.json&quot;</span>
</code></pre></div>
<h3 id="troubleshooting-migration">Troubleshooting Migration<a class="headerlink" href="#troubleshooting-migration" title="Permanent link">&para;</a></h3>
<p><strong>Issue:</strong> <code>chezmoi forget</code> doesn't remove files</p>
<p><strong>Solution:</strong> Manually remove from git:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="nb">cd</span><span class="w"> </span>~/.local/share/chezmoi
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>git<span class="w"> </span>rm<span class="w"> </span>-r<span class="w"> </span>dot_config/nvim/dot_git
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;remove: nvim git metadata&quot;</span>
</code></pre></div>
<p><strong>Issue:</strong> Files keep reappearing</p>
<p><strong>Solution:</strong> Verify ignore patterns are active:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c1"># Check if patterns are in .chezmoiignore</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>dot<span class="w"> </span>ignore<span class="w"> </span>list
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="c1"># Test if pattern matches</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="nb">cd</span><span class="w"> </span>~/.local/share/chezmoi
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>chezmoi<span class="w"> </span>ignored<span class="w"> </span>~/.config/nvim/.git
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="c1"># Should output: true</span>
</code></pre></div>
<p><strong>Issue:</strong> Repository still large after cleanup</p>
<p><strong>Solution:</strong> Git still has old objects in history. Clean history:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="nb">cd</span><span class="w"> </span>~/.local/share/chezmoi
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="c1"># Rewrite history to remove large files</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>git<span class="w"> </span>filter-branch<span class="w"> </span>--force<span class="w"> </span>--index-filter<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="w">  </span><span class="s1">&#39;git rm --cached --ignore-unmatch -r dot_config/nvim/dot_git&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="w">  </span>--prune-empty<span class="w"> </span>--tag-name-filter<span class="w"> </span>cat<span class="w"> </span>--<span class="w"> </span>--all
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="c1"># Force push (WARNING: rewrites history)</span>
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>--force<span class="w"> </span>--all
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>
<a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="c1"># Clean up local refs</span>
<a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a>rm<span class="w"> </span>-rf<span class="w"> </span>.git/refs/original/
<a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a>git<span class="w"> </span>reflog<span class="w"> </span>expire<span class="w"> </span>--expire<span class="o">=</span>now<span class="w"> </span>--all
<a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a>git<span class="w"> </span>gc<span class="w"> </span>--prune<span class="o">=</span>now<span class="w"> </span>--aggressive
</code></pre></div>
<hr />
<h2 id="implementation-plan">Implementation Plan<a class="headerlink" href="#implementation-plan" title="Permanent link">&para;</a></h2>
<h3 id="phase-0-foundation-cross-platform-days-1-2">Phase 0: Foundation &amp; Cross-Platform (Days 1-2)<a class="headerlink" href="#phase-0-foundation-cross-platform-days-1-2" title="Permanent link">&para;</a></h3>
<p><strong>Effort:</strong> 4-5 hours
<strong>Priority:</strong> Critical</p>
<h4 id="01-cross-platform-helpers">0.1 Cross-Platform Helpers<a class="headerlink" href="#01-cross-platform-helpers" title="Permanent link">&para;</a></h4>
<p><strong>File:</strong> <code>lib/core.zsh</code></p>
<p>Add platform-agnostic helper functions:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1"># File size detection (BSD vs GNU stat)</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>_flow_get_file_size<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>stat<span class="w"> </span>--version<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span>GNU<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">        </span>stat<span class="w"> </span>-c%s<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="w">        </span>stat<span class="w"> </span>-f%z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="o">}</span>
<a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a>
<a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="c1"># Human-readable sizes (with numfmt fallback)</span>
<a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a>_flow_human_size<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">bytes</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>numfmt<span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a><span class="w">        </span>numfmt<span class="w"> </span>--to<span class="o">=</span>iec<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$bytes</span><span class="s2">&quot;</span>
<a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>bytes<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span><span class="m">1073741824</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$((</span><span class="nv">bytes</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">1073741824</span><span class="k">))</span><span class="s2"> GB&quot;</span>
<a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a><span class="w">        </span><span class="k">elif</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>bytes<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span><span class="m">1048576</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-39-20" name="__codelineno-39-20" href="#__codelineno-39-20"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$((</span><span class="nv">bytes</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">1048576</span><span class="k">))</span><span class="s2"> MB&quot;</span>
<a id="__codelineno-39-21" name="__codelineno-39-21" href="#__codelineno-39-21"></a><span class="w">        </span><span class="k">elif</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>bytes<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span><span class="m">1024</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-39-22" name="__codelineno-39-22" href="#__codelineno-39-22"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$((</span><span class="nv">bytes</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">1024</span><span class="k">))</span><span class="s2"> KB&quot;</span>
<a id="__codelineno-39-23" name="__codelineno-39-23" href="#__codelineno-39-23"></a><span class="w">        </span><span class="k">else</span>
<a id="__codelineno-39-24" name="__codelineno-39-24" href="#__codelineno-39-24"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">bytes</span><span class="si">}</span><span class="s2"> bytes&quot;</span>
<a id="__codelineno-39-25" name="__codelineno-39-25" href="#__codelineno-39-25"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-39-26" name="__codelineno-39-26" href="#__codelineno-39-26"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-39-27" name="__codelineno-39-27" href="#__codelineno-39-27"></a><span class="o">}</span>
<a id="__codelineno-39-28" name="__codelineno-39-28" href="#__codelineno-39-28"></a>
<a id="__codelineno-39-29" name="__codelineno-39-29" href="#__codelineno-39-29"></a><span class="c1"># Timeout wrapper (GNU vs BSD)</span>
<a id="__codelineno-39-30" name="__codelineno-39-30" href="#__codelineno-39-30"></a>_flow_timeout<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-39-31" name="__codelineno-39-31" href="#__codelineno-39-31"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">seconds</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<a id="__codelineno-39-32" name="__codelineno-39-32" href="#__codelineno-39-32"></a><span class="w">    </span><span class="nb">shift</span>
<a id="__codelineno-39-33" name="__codelineno-39-33" href="#__codelineno-39-33"></a>
<a id="__codelineno-39-34" name="__codelineno-39-34" href="#__codelineno-39-34"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>timeout<span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-39-35" name="__codelineno-39-35" href="#__codelineno-39-35"></a><span class="w">        </span>timeout<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">seconds</span><span class="si">}</span><span class="s2">s&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
<a id="__codelineno-39-36" name="__codelineno-39-36" href="#__codelineno-39-36"></a><span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>gtimeout<span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-39-37" name="__codelineno-39-37" href="#__codelineno-39-37"></a><span class="w">        </span>gtimeout<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">seconds</span><span class="si">}</span><span class="s2">s&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
<a id="__codelineno-39-38" name="__codelineno-39-38" href="#__codelineno-39-38"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-39-39" name="__codelineno-39-39" href="#__codelineno-39-39"></a><span class="w">        </span><span class="c1"># No timeout available - just run command</span>
<a id="__codelineno-39-40" name="__codelineno-39-40" href="#__codelineno-39-40"></a><span class="w">        </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
<a id="__codelineno-39-41" name="__codelineno-39-41" href="#__codelineno-39-41"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-39-42" name="__codelineno-39-42" href="#__codelineno-39-42"></a><span class="o">}</span>
</code></pre></div>
<p><strong>Testing:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1"># Test on macOS (BSD)</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>_flow_get_file_size<span class="w"> </span>~/.zshrc
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="c1"># Test on Linux (GNU)</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>_flow_get_file_size<span class="w"> </span>~/.zshrc
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="c1"># Test human sizes</span>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>_flow_human_size<span class="w"> </span><span class="m">1048576</span><span class="w">  </span><span class="c1"># Should show 1 MB</span>
</code></pre></div></p>
<h4 id="02-cache-infrastructure">0.2 Cache Infrastructure<a class="headerlink" href="#02-cache-infrastructure" title="Permanent link">&para;</a></h4>
<p><strong>File:</strong> <code>lib/dotfile-helpers.zsh</code></p>
<p>Add cache variables and helpers:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="c1"># Cache variables</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="nb">typeset</span><span class="w"> </span>-g<span class="w"> </span>_DOT_SIZE_CACHE
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="nb">typeset</span><span class="w"> </span>-g<span class="w"> </span>_DOT_SIZE_CACHE_TIME
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="nb">typeset</span><span class="w"> </span>-g<span class="w"> </span>_DOT_IGNORE_CACHE
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="nb">typeset</span><span class="w"> </span>-g<span class="w"> </span>_DOT_IGNORE_CACHE_TIME
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="nb">typeset</span><span class="w"> </span>-g<span class="w"> </span><span class="nv">_DOT_CACHE_TTL</span><span class="o">=</span><span class="m">300</span><span class="w">  </span><span class="c1"># 5 minutes</span>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a>
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="c1"># Cache helpers</span>
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>_dot_is_cache_valid<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">cache_time</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">$_DOT_CACHE_TTL</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a><span class="w">    </span><span class="o">[[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$cache_time</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">now</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span>
<a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="w">    </span><span class="o">((</span><span class="w"> </span>now<span class="w"> </span>-<span class="w"> </span>cache_time<span class="w"> </span>&lt;<span class="w"> </span>ttl<span class="w"> </span><span class="o">))</span>
<a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="o">}</span>
<a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a>
<a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a>_dot_get_cached_size<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a><span class="w">    </span>_dot_is_cache_valid<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$_DOT_SIZE_CACHE_TIME</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$_DOT_SIZE_CACHE</span><span class="s2">&quot;</span>
<a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a><span class="o">}</span>
<a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a>
<a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a>_dot_cache_size<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a><span class="w">    </span><span class="nv">_DOT_SIZE_CACHE</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<a id="__codelineno-41-23" name="__codelineno-41-23" href="#__codelineno-41-23"></a><span class="w">    </span><span class="nv">_DOT_SIZE_CACHE_TIME</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span>
<a id="__codelineno-41-24" name="__codelineno-41-24" href="#__codelineno-41-24"></a><span class="o">}</span>
</code></pre></div>
<h3 id="phase-1-safety-features-week-1-days-3-5">Phase 1: Safety Features (Week 1, Days 3-5)<a class="headerlink" href="#phase-1-safety-features-week-1-days-3-5" title="Permanent link">&para;</a></h3>
<p><strong>Effort:</strong> 8-10 hours
<strong>Dependencies:</strong> Phase 0 complete</p>
<h4 id="11-git-directory-detection-with-performance-optimization">1.1 Git Directory Detection (with Performance Optimization)<a class="headerlink" href="#11-git-directory-detection-with-performance-optimization" title="Permanent link">&para;</a></h4>
<p><strong>File:</strong> <code>lib/dotfile-helpers.zsh</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>_dot_check_git_in_path<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">target</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">git_dirs</span><span class="o">=()</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="w">    </span><span class="c1"># Handle symlinks</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-L<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="w">        </span>_dot_warn<span class="w"> </span><span class="s2">&quot;Target is a symlink: </span><span class="nv">$target</span><span class="s2">&quot;</span>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="w">        </span><span class="nb">read</span><span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;REPLY?Follow symlink and scan target? (Y/n) &quot;</span>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a><span class="w">        </span><span class="nb">echo</span>
<a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$REPLY</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>^<span class="o">[</span>Yy<span class="o">]</span>$<span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="nv">$REPLY</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a><span class="w">            </span><span class="nv">target</span><span class="o">=</span><span class="k">$(</span>readlink<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="o">||</span><span class="w"> </span>realpath<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="k">)</span>
<a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a><span class="w">            </span>_dot_info<span class="w"> </span><span class="s2">&quot;Following to: </span><span class="nv">$target</span><span class="s2">&quot;</span>
<a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a><span class="w">        </span><span class="k">else</span>
<a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a><span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">real_target</span><span class="o">=</span><span class="k">$(</span>readlink<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="k">)</span>
<a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a><span class="w">            </span><span class="o">[[</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">real_target</span><span class="si">}</span><span class="s2">/.git&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">git_dirs</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">real_target</span><span class="si">}</span><span class="s2">/.git&quot;</span><span class="o">)</span>
<a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">git_dirs</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-42-19" name="__codelineno-42-19" href="#__codelineno-42-19"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-42-20" name="__codelineno-42-20" href="#__codelineno-42-20"></a>
<a id="__codelineno-42-21" name="__codelineno-42-21" href="#__codelineno-42-21"></a><span class="w">    </span><span class="c1"># Check if target itself has .git</span>
<a id="__codelineno-42-22" name="__codelineno-42-22" href="#__codelineno-42-22"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">/.git&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-42-23" name="__codelineno-42-23" href="#__codelineno-42-23"></a><span class="w">        </span><span class="nv">git_dirs</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">/.git&quot;</span><span class="o">)</span>
<a id="__codelineno-42-24" name="__codelineno-42-24" href="#__codelineno-42-24"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-42-25" name="__codelineno-42-25" href="#__codelineno-42-25"></a>
<a id="__codelineno-42-26" name="__codelineno-42-26" href="#__codelineno-42-26"></a><span class="w">    </span><span class="c1"># Performance optimization: use git ls-files if it&#39;s a git repo</span>
<a id="__codelineno-42-27" name="__codelineno-42-27" href="#__codelineno-42-27"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">/.git&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>git<span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-42-28" name="__codelineno-42-28" href="#__codelineno-42-28"></a><span class="w">        </span><span class="c1"># Fast path: use git to find nested repos</span>
<a id="__codelineno-42-29" name="__codelineno-42-29" href="#__codelineno-42-29"></a><span class="w">        </span><span class="nb">local</span><span class="w"> </span><span class="nv">nested</span><span class="o">=</span><span class="k">$(</span>git<span class="w"> </span>-C<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span>submodule<span class="w"> </span>status<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="k">)</span>
<a id="__codelineno-42-30" name="__codelineno-42-30" href="#__codelineno-42-30"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>nested<span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-42-31" name="__codelineno-42-31" href="#__codelineno-42-31"></a><span class="w">            </span>_dot_warn<span class="w"> </span><span class="s2">&quot;Found </span><span class="nv">$nested</span><span class="s2"> git submodules (use &#39;git submodule&#39; commands)&quot;</span>
<a id="__codelineno-42-32" name="__codelineno-42-32" href="#__codelineno-42-32"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-42-33" name="__codelineno-42-33" href="#__codelineno-42-33"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-42-34" name="__codelineno-42-34" href="#__codelineno-42-34"></a><span class="w">        </span><span class="c1"># Slow path: use find with timeout</span>
<a id="__codelineno-42-35" name="__codelineno-42-35" href="#__codelineno-42-35"></a><span class="w">        </span><span class="c1"># Warn if directory is large</span>
<a id="__codelineno-42-36" name="__codelineno-42-36" href="#__codelineno-42-36"></a><span class="w">        </span><span class="nb">local</span><span class="w"> </span><span class="nv">file_count</span><span class="o">=</span><span class="k">$(</span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1000<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="k">)</span>
<a id="__codelineno-42-37" name="__codelineno-42-37" href="#__codelineno-42-37"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>file_count<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-42-38" name="__codelineno-42-38" href="#__codelineno-42-38"></a><span class="w">            </span>_dot_warn<span class="w"> </span><span class="s2">&quot;Large directory detected. Git scan may take a few seconds...&quot;</span>
<a id="__codelineno-42-39" name="__codelineno-42-39" href="#__codelineno-42-39"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-42-40" name="__codelineno-42-40" href="#__codelineno-42-40"></a>
<a id="__codelineno-42-41" name="__codelineno-42-41" href="#__codelineno-42-41"></a><span class="w">        </span><span class="c1"># Use timeout wrapper</span>
<a id="__codelineno-42-42" name="__codelineno-42-42" href="#__codelineno-42-42"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>gitdir<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-42-43" name="__codelineno-42-43" href="#__codelineno-42-43"></a><span class="w">            </span><span class="nv">git_dirs</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$gitdir</span><span class="s2">&quot;</span><span class="o">)</span>
<a id="__codelineno-42-44" name="__codelineno-42-44" href="#__codelineno-42-44"></a><span class="w">        </span><span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>_flow_timeout<span class="w"> </span><span class="m">2</span><span class="w"> </span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;.git&quot;</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="o">)</span>
<a id="__codelineno-42-45" name="__codelineno-42-45" href="#__codelineno-42-45"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-42-46" name="__codelineno-42-46" href="#__codelineno-42-46"></a>
<a id="__codelineno-42-47" name="__codelineno-42-47" href="#__codelineno-42-47"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span><span class="si">${#</span><span class="nv">git_dirs</span><span class="p">[@]</span><span class="si">}</span><span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-42-48" name="__codelineno-42-48" href="#__codelineno-42-48"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">git_dirs</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-42-49" name="__codelineno-42-49" href="#__codelineno-42-49"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-42-50" name="__codelineno-42-50" href="#__codelineno-42-50"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-42-51" name="__codelineno-42-51" href="#__codelineno-42-51"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-42-52" name="__codelineno-42-52" href="#__codelineno-42-52"></a><span class="o">}</span>
</code></pre></div>
<p><strong>Modify:</strong> <code>dot add</code> command in <code>dot-dispatcher.zsh</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="s2">&quot;add&quot;</span><span class="o">)</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">        </span>_dot_error<span class="w"> </span><span class="s2">&quot;Usage: dot add &lt;file&gt;&quot;</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">target</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">no_preview</span><span class="o">=</span><span class="nb">false</span>
<a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a>
<a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a><span class="w">    </span><span class="c1"># Check for --no-preview flag</span>
<a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;--no-preview&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a><span class="w">        </span><span class="nv">no_preview</span><span class="o">=</span><span class="nb">true</span>
<a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a>
<a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a><span class="w">    </span><span class="c1"># Check for git directories</span>
<a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">git_dirs</span><span class="o">=</span><span class="k">$(</span>_dot_check_git_in_path<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="k">)</span>
<a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$git_dirs</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-43-18" name="__codelineno-43-18" href="#__codelineno-43-18"></a><span class="w">        </span>_dot_warn<span class="w"> </span><span class="s2">&quot;‚ö†Ô∏è  Git directory detected in </span><span class="nv">$target</span><span class="s2">&quot;</span>
<a id="__codelineno-43-19" name="__codelineno-43-19" href="#__codelineno-43-19"></a><span class="w">        </span>_dot_info<span class="w"> </span><span class="s2">&quot;Git metadata should not be tracked by chezmoi.&quot;</span>
<a id="__codelineno-43-20" name="__codelineno-43-20" href="#__codelineno-43-20"></a><span class="w">        </span><span class="nb">echo</span>
<a id="__codelineno-43-21" name="__codelineno-43-21" href="#__codelineno-43-21"></a><span class="w">        </span><span class="nb">read</span><span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;REPLY?Auto-create ignore rule? (Y/n) &quot;</span>
<a id="__codelineno-43-22" name="__codelineno-43-22" href="#__codelineno-43-22"></a><span class="w">        </span><span class="nb">echo</span>
<a id="__codelineno-43-23" name="__codelineno-43-23" href="#__codelineno-43-23"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$REPLY</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>^<span class="o">[</span>Yy<span class="o">]</span>$<span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="nv">$REPLY</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-43-24" name="__codelineno-43-24" href="#__codelineno-43-24"></a><span class="w">            </span><span class="c1"># Extract relative path from target</span>
<a id="__codelineno-43-25" name="__codelineno-43-25" href="#__codelineno-43-25"></a><span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">rel_path</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">target</span><span class="p">#</span><span class="nv">$HOME</span><span class="p">/</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-43-26" name="__codelineno-43-26" href="#__codelineno-43-26"></a><span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">ignore_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.local/share/chezmoi/.chezmoiignore&quot;</span>
<a id="__codelineno-43-27" name="__codelineno-43-27" href="#__codelineno-43-27"></a>
<a id="__codelineno-43-28" name="__codelineno-43-28" href="#__codelineno-43-28"></a><span class="w">            </span><span class="c1"># Create .chezmoiignore if missing</span>
<a id="__codelineno-43-29" name="__codelineno-43-29" href="#__codelineno-43-29"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-43-30" name="__codelineno-43-30" href="#__codelineno-43-30"></a><span class="w">                </span>touch<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span>
<a id="__codelineno-43-31" name="__codelineno-43-31" href="#__codelineno-43-31"></a><span class="w">                </span>_dot_info<span class="w"> </span><span class="s2">&quot;Created .chezmoiignore&quot;</span>
<a id="__codelineno-43-32" name="__codelineno-43-32" href="#__codelineno-43-32"></a><span class="w">            </span><span class="k">fi</span>
<a id="__codelineno-43-33" name="__codelineno-43-33" href="#__codelineno-43-33"></a>
<a id="__codelineno-43-34" name="__codelineno-43-34" href="#__codelineno-43-34"></a><span class="w">            </span><span class="c1"># Add patterns</span>
<a id="__codelineno-43-35" name="__codelineno-43-35" href="#__codelineno-43-35"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">rel_path</span><span class="si">}</span><span class="s2">/.git&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span>
<a id="__codelineno-43-36" name="__codelineno-43-36" href="#__codelineno-43-36"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">rel_path</span><span class="si">}</span><span class="s2">/.git/**&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span>
<a id="__codelineno-43-37" name="__codelineno-43-37" href="#__codelineno-43-37"></a><span class="w">            </span>_dot_success<span class="w"> </span><span class="s2">&quot;Added </span><span class="si">${</span><span class="nv">rel_path</span><span class="si">}</span><span class="s2">/.git to .chezmoiignore&quot;</span>
<a id="__codelineno-43-38" name="__codelineno-43-38" href="#__codelineno-43-38"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-43-39" name="__codelineno-43-39" href="#__codelineno-43-39"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-43-40" name="__codelineno-43-40" href="#__codelineno-43-40"></a>
<a id="__codelineno-43-41" name="__codelineno-43-41" href="#__codelineno-43-41"></a><span class="w">    </span><span class="c1"># Show preview unless --no-preview</span>
<a id="__codelineno-43-42" name="__codelineno-43-42" href="#__codelineno-43-42"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$no_preview</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-43-43" name="__codelineno-43-43" href="#__codelineno-43-43"></a><span class="w">        </span>_dot_preview_add<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-43-44" name="__codelineno-43-44" href="#__codelineno-43-44"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-43-45" name="__codelineno-43-45" href="#__codelineno-43-45"></a>
<a id="__codelineno-43-46" name="__codelineno-43-46" href="#__codelineno-43-46"></a><span class="w">    </span><span class="c1"># Execute add</span>
<a id="__codelineno-43-47" name="__codelineno-43-47" href="#__codelineno-43-47"></a><span class="w">    </span>chezmoi<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span>
<a id="__codelineno-43-48" name="__codelineno-43-48" href="#__codelineno-43-48"></a><span class="w">    </span>_dot_success<span class="w"> </span><span class="s2">&quot;Added </span><span class="nv">$target</span><span class="s2"> to chezmoi&quot;</span>
<a id="__codelineno-43-49" name="__codelineno-43-49" href="#__codelineno-43-49"></a><span class="w">    </span><span class="p">;;</span>
</code></pre></div>
<h4 id="12-preview-before-add">1.2 Preview Before Add<a class="headerlink" href="#12-preview-before-add" title="Permanent link">&para;</a></h4>
<p><strong>File:</strong> <code>lib/dotfile-helpers.zsh</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>_dot_preview_add<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">target</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>!<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="w">        </span>_dot_error<span class="w"> </span><span class="s2">&quot;Path does not exist: </span><span class="nv">$target</span><span class="s2">&quot;</span>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a>
<a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="w">    </span>_dot_header<span class="w"> </span><span class="s2">&quot;Preview: dot add </span><span class="nv">$target</span><span class="s2">&quot;</span>
<a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a>
<a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a><span class="w">    </span><span class="c1"># Count files and calculate size</span>
<a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">file_count</span><span class="o">=</span><span class="m">0</span>
<a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">total_size</span><span class="o">=</span><span class="m">0</span>
<a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">large_files</span><span class="o">=()</span>
<a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">generated_files</span><span class="o">=()</span>
<a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">git_files</span><span class="o">=</span><span class="m">0</span>
<a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a>
<a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-44-20" name="__codelineno-44-20" href="#__codelineno-44-20"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>file<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-44-21" name="__codelineno-44-21" href="#__codelineno-44-21"></a><span class="w">            </span><span class="o">((</span>file_count++<span class="o">))</span>
<a id="__codelineno-44-22" name="__codelineno-44-22" href="#__codelineno-44-22"></a>
<a id="__codelineno-44-23" name="__codelineno-44-23" href="#__codelineno-44-23"></a><span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="k">$(</span>_flow_get_file_size<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="k">)</span>
<a id="__codelineno-44-24" name="__codelineno-44-24" href="#__codelineno-44-24"></a><span class="w">            </span><span class="o">((</span><span class="nv">total_size</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>size<span class="o">))</span>
<a id="__codelineno-44-25" name="__codelineno-44-25" href="#__codelineno-44-25"></a>
<a id="__codelineno-44-26" name="__codelineno-44-26" href="#__codelineno-44-26"></a><span class="w">            </span><span class="c1"># Check for git files</span>
<a id="__codelineno-44-27" name="__codelineno-44-27" href="#__codelineno-44-27"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>*<span class="s2">&quot;/.git/&quot;</span>*<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-44-28" name="__codelineno-44-28" href="#__codelineno-44-28"></a><span class="w">                </span><span class="o">((</span>git_files++<span class="o">))</span>
<a id="__codelineno-44-29" name="__codelineno-44-29" href="#__codelineno-44-29"></a><span class="w">            </span><span class="k">fi</span>
<a id="__codelineno-44-30" name="__codelineno-44-30" href="#__codelineno-44-30"></a>
<a id="__codelineno-44-31" name="__codelineno-44-31" href="#__codelineno-44-31"></a><span class="w">            </span><span class="c1"># Check for large files (&gt;50KB)</span>
<a id="__codelineno-44-32" name="__codelineno-44-32" href="#__codelineno-44-32"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>size<span class="w"> </span>&gt;<span class="w"> </span><span class="m">51200</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-44-33" name="__codelineno-44-33" href="#__codelineno-44-33"></a><span class="w">                </span><span class="nv">large_files</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">:</span><span class="nv">$size</span><span class="s2">&quot;</span><span class="o">)</span>
<a id="__codelineno-44-34" name="__codelineno-44-34" href="#__codelineno-44-34"></a><span class="w">            </span><span class="k">fi</span>
<a id="__codelineno-44-35" name="__codelineno-44-35" href="#__codelineno-44-35"></a>
<a id="__codelineno-44-36" name="__codelineno-44-36" href="#__codelineno-44-36"></a><span class="w">            </span><span class="c1"># Check for generated files</span>
<a id="__codelineno-44-37" name="__codelineno-44-37" href="#__codelineno-44-37"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span><span class="se">\.</span><span class="o">(</span>log<span class="p">|</span>sqlite<span class="p">|</span>db<span class="p">|</span>cache<span class="o">)</span>$<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-44-38" name="__codelineno-44-38" href="#__codelineno-44-38"></a><span class="w">                </span><span class="nv">generated_files</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="o">)</span>
<a id="__codelineno-44-39" name="__codelineno-44-39" href="#__codelineno-44-39"></a><span class="w">            </span><span class="k">fi</span>
<a id="__codelineno-44-40" name="__codelineno-44-40" href="#__codelineno-44-40"></a><span class="w">        </span><span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="o">)</span>
<a id="__codelineno-44-41" name="__codelineno-44-41" href="#__codelineno-44-41"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-44-42" name="__codelineno-44-42" href="#__codelineno-44-42"></a><span class="w">        </span><span class="nv">file_count</span><span class="o">=</span><span class="m">1</span>
<a id="__codelineno-44-43" name="__codelineno-44-43" href="#__codelineno-44-43"></a><span class="w">        </span><span class="nv">total_size</span><span class="o">=</span><span class="k">$(</span>stat<span class="w"> </span>-f%z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="m">0</span><span class="k">)</span>
<a id="__codelineno-44-44" name="__codelineno-44-44" href="#__codelineno-44-44"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-44-45" name="__codelineno-44-45" href="#__codelineno-44-45"></a>
<a id="__codelineno-44-46" name="__codelineno-44-46" href="#__codelineno-44-46"></a><span class="w">    </span><span class="c1"># Display summary</span>
<a id="__codelineno-44-47" name="__codelineno-44-47" href="#__codelineno-44-47"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Files to add: </span><span class="nv">$file_count</span><span class="s2">&quot;</span>
<a id="__codelineno-44-48" name="__codelineno-44-48" href="#__codelineno-44-48"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Total size: </span><span class="k">$(</span>_flow_human_size<span class="w"> </span><span class="nv">$total_size</span><span class="k">)</span><span class="s2">&quot;</span>
<a id="__codelineno-44-49" name="__codelineno-44-49" href="#__codelineno-44-49"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-44-50" name="__codelineno-44-50" href="#__codelineno-44-50"></a>
<a id="__codelineno-44-51" name="__codelineno-44-51" href="#__codelineno-44-51"></a><span class="w">    </span><span class="c1"># Show warnings</span>
<a id="__codelineno-44-52" name="__codelineno-44-52" href="#__codelineno-44-52"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">has_warnings</span><span class="o">=</span><span class="nb">false</span>
<a id="__codelineno-44-53" name="__codelineno-44-53" href="#__codelineno-44-53"></a>
<a id="__codelineno-44-54" name="__codelineno-44-54" href="#__codelineno-44-54"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>git_files<span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-44-55" name="__codelineno-44-55" href="#__codelineno-44-55"></a><span class="w">        </span><span class="nv">has_warnings</span><span class="o">=</span><span class="nb">true</span>
<a id="__codelineno-44-56" name="__codelineno-44-56" href="#__codelineno-44-56"></a><span class="w">        </span>_dot_warn<span class="w"> </span><span class="s2">&quot;‚ö†Ô∏è  </span><span class="nv">$git_files</span><span class="s2"> git metadata files detected&quot;</span>
<a id="__codelineno-44-57" name="__codelineno-44-57" href="#__codelineno-44-57"></a><span class="w">        </span>_dot_info<span class="w"> </span><span class="s2">&quot;These will be skipped (covered by .chezmoiignore)&quot;</span>
<a id="__codelineno-44-58" name="__codelineno-44-58" href="#__codelineno-44-58"></a><span class="w">        </span><span class="nb">echo</span>
<a id="__codelineno-44-59" name="__codelineno-44-59" href="#__codelineno-44-59"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-44-60" name="__codelineno-44-60" href="#__codelineno-44-60"></a>
<a id="__codelineno-44-61" name="__codelineno-44-61" href="#__codelineno-44-61"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span><span class="si">${#</span><span class="nv">large_files</span><span class="p">[@]</span><span class="si">}</span><span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-44-62" name="__codelineno-44-62" href="#__codelineno-44-62"></a><span class="w">        </span><span class="nv">has_warnings</span><span class="o">=</span><span class="nb">true</span>
<a id="__codelineno-44-63" name="__codelineno-44-63" href="#__codelineno-44-63"></a><span class="w">        </span>_dot_warn<span class="w"> </span><span class="s2">&quot;‚ö†Ô∏è  Large files detected:&quot;</span>
<a id="__codelineno-44-64" name="__codelineno-44-64" href="#__codelineno-44-64"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span>item<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">large_files</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-44-65" name="__codelineno-44-65" href="#__codelineno-44-65"></a><span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">file</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">item</span><span class="p">%:*</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-44-66" name="__codelineno-44-66" href="#__codelineno-44-66"></a><span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">item</span><span class="p">#*:</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-44-67" name="__codelineno-44-67" href="#__codelineno-44-67"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>numfmt<span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-44-68" name="__codelineno-44-68" href="#__codelineno-44-68"></a><span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  - </span><span class="k">$(</span>numfmt<span class="w"> </span>--to<span class="o">=</span>iec<span class="w"> </span><span class="nv">$size</span><span class="k">)</span><span class="s2">  </span><span class="si">${</span><span class="nv">file</span><span class="p">#</span><span class="nv">$target</span><span class="p">/</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-44-69" name="__codelineno-44-69" href="#__codelineno-44-69"></a><span class="w">            </span><span class="k">else</span>
<a id="__codelineno-44-70" name="__codelineno-44-70" href="#__codelineno-44-70"></a><span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  - </span><span class="si">${</span><span class="nv">size</span><span class="si">}</span><span class="s2"> bytes  </span><span class="si">${</span><span class="nv">file</span><span class="p">#</span><span class="nv">$target</span><span class="p">/</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-44-71" name="__codelineno-44-71" href="#__codelineno-44-71"></a><span class="w">            </span><span class="k">fi</span>
<a id="__codelineno-44-72" name="__codelineno-44-72" href="#__codelineno-44-72"></a><span class="w">        </span><span class="k">done</span>
<a id="__codelineno-44-73" name="__codelineno-44-73" href="#__codelineno-44-73"></a><span class="w">        </span><span class="nb">echo</span>
<a id="__codelineno-44-74" name="__codelineno-44-74" href="#__codelineno-44-74"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-44-75" name="__codelineno-44-75" href="#__codelineno-44-75"></a>
<a id="__codelineno-44-76" name="__codelineno-44-76" href="#__codelineno-44-76"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span><span class="si">${#</span><span class="nv">generated_files</span><span class="p">[@]</span><span class="si">}</span><span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-44-77" name="__codelineno-44-77" href="#__codelineno-44-77"></a><span class="w">        </span><span class="nv">has_warnings</span><span class="o">=</span><span class="nb">true</span>
<a id="__codelineno-44-78" name="__codelineno-44-78" href="#__codelineno-44-78"></a><span class="w">        </span>_dot_warn<span class="w"> </span><span class="s2">&quot;‚ö†Ô∏è  Generated files detected:&quot;</span>
<a id="__codelineno-44-79" name="__codelineno-44-79" href="#__codelineno-44-79"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">generated_files</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-44-80" name="__codelineno-44-80" href="#__codelineno-44-80"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  - </span><span class="si">${</span><span class="nv">file</span><span class="p">#</span><span class="nv">$target</span><span class="p">/</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-44-81" name="__codelineno-44-81" href="#__codelineno-44-81"></a><span class="w">        </span><span class="k">done</span>
<a id="__codelineno-44-82" name="__codelineno-44-82" href="#__codelineno-44-82"></a><span class="w">        </span><span class="nb">echo</span>
<a id="__codelineno-44-83" name="__codelineno-44-83" href="#__codelineno-44-83"></a><span class="w">        </span>_dot_info<span class="w"> </span><span class="s2">&quot;üí° Consider excluding: *.log, *.sqlite, *.db, *.cache&quot;</span>
<a id="__codelineno-44-84" name="__codelineno-44-84" href="#__codelineno-44-84"></a>
<a id="__codelineno-44-85" name="__codelineno-44-85" href="#__codelineno-44-85"></a><span class="w">        </span><span class="nb">read</span><span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;REPLY?Auto-add ignore patterns? (Y/n) &quot;</span>
<a id="__codelineno-44-86" name="__codelineno-44-86" href="#__codelineno-44-86"></a><span class="w">        </span><span class="nb">echo</span>
<a id="__codelineno-44-87" name="__codelineno-44-87" href="#__codelineno-44-87"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$REPLY</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>^<span class="o">[</span>Yy<span class="o">]</span>$<span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="nv">$REPLY</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-44-88" name="__codelineno-44-88" href="#__codelineno-44-88"></a><span class="w">            </span>_dot_suggest_ignore_patterns<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">generated_files</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-44-89" name="__codelineno-44-89" href="#__codelineno-44-89"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-44-90" name="__codelineno-44-90" href="#__codelineno-44-90"></a><span class="w">        </span><span class="nb">echo</span>
<a id="__codelineno-44-91" name="__codelineno-44-91" href="#__codelineno-44-91"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-44-92" name="__codelineno-44-92" href="#__codelineno-44-92"></a>
<a id="__codelineno-44-93" name="__codelineno-44-93" href="#__codelineno-44-93"></a><span class="w">    </span><span class="c1"># Confirmation</span>
<a id="__codelineno-44-94" name="__codelineno-44-94" href="#__codelineno-44-94"></a><span class="w">    </span><span class="nb">read</span><span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;REPLY?Proceed with add? (Y/n) &quot;</span>
<a id="__codelineno-44-95" name="__codelineno-44-95" href="#__codelineno-44-95"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-44-96" name="__codelineno-44-96" href="#__codelineno-44-96"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$REPLY</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>^<span class="o">[</span>Yy<span class="o">]</span>$<span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="nv">$REPLY</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-44-97" name="__codelineno-44-97" href="#__codelineno-44-97"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-44-98" name="__codelineno-44-98" href="#__codelineno-44-98"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-44-99" name="__codelineno-44-99" href="#__codelineno-44-99"></a><span class="w">        </span>_dot_info<span class="w"> </span><span class="s2">&quot;Add cancelled&quot;</span>
<a id="__codelineno-44-100" name="__codelineno-44-100" href="#__codelineno-44-100"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-44-101" name="__codelineno-44-101" href="#__codelineno-44-101"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-44-102" name="__codelineno-44-102" href="#__codelineno-44-102"></a><span class="o">}</span>
<a id="__codelineno-44-103" name="__codelineno-44-103" href="#__codelineno-44-103"></a>
<a id="__codelineno-44-104" name="__codelineno-44-104" href="#__codelineno-44-104"></a>_dot_suggest_ignore_patterns<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-44-105" name="__codelineno-44-105" href="#__codelineno-44-105"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">files</span><span class="o">=(</span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span><span class="o">)</span>
<a id="__codelineno-44-106" name="__codelineno-44-106" href="#__codelineno-44-106"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">ignore_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.local/share/chezmoi/.chezmoiignore&quot;</span>
<a id="__codelineno-44-107" name="__codelineno-44-107" href="#__codelineno-44-107"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">patterns</span><span class="o">=()</span>
<a id="__codelineno-44-108" name="__codelineno-44-108" href="#__codelineno-44-108"></a>
<a id="__codelineno-44-109" name="__codelineno-44-109" href="#__codelineno-44-109"></a><span class="w">    </span><span class="c1"># Extract unique file extensions</span>
<a id="__codelineno-44-110" name="__codelineno-44-110" href="#__codelineno-44-110"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">files</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-44-111" name="__codelineno-44-111" href="#__codelineno-44-111"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span><span class="se">\.</span><span class="o">([</span>^.<span class="o">]</span>+<span class="o">)</span>$<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-44-112" name="__codelineno-44-112" href="#__codelineno-44-112"></a><span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">ext</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_REMATCH</span><span class="p">[1]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-44-113" name="__codelineno-44-113" href="#__codelineno-44-113"></a><span class="w">            </span><span class="nv">patterns</span><span class="o">+=(</span><span class="s2">&quot;*.</span><span class="si">${</span><span class="nv">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">)</span>
<a id="__codelineno-44-114" name="__codelineno-44-114" href="#__codelineno-44-114"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-44-115" name="__codelineno-44-115" href="#__codelineno-44-115"></a><span class="w">    </span><span class="k">done</span>
<a id="__codelineno-44-116" name="__codelineno-44-116" href="#__codelineno-44-116"></a>
<a id="__codelineno-44-117" name="__codelineno-44-117" href="#__codelineno-44-117"></a><span class="w">    </span><span class="c1"># Remove duplicates</span>
<a id="__codelineno-44-118" name="__codelineno-44-118" href="#__codelineno-44-118"></a><span class="w">    </span><span class="nv">patterns</span><span class="o">=(</span><span class="k">$(</span><span class="nb">printf</span><span class="w"> </span><span class="s1">&#39;%s\n&#39;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">patterns</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-u<span class="k">)</span><span class="o">)</span>
<a id="__codelineno-44-119" name="__codelineno-44-119" href="#__codelineno-44-119"></a>
<a id="__codelineno-44-120" name="__codelineno-44-120" href="#__codelineno-44-120"></a><span class="w">    </span><span class="c1"># Create .chezmoiignore if missing</span>
<a id="__codelineno-44-121" name="__codelineno-44-121" href="#__codelineno-44-121"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-44-122" name="__codelineno-44-122" href="#__codelineno-44-122"></a><span class="w">        </span>touch<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span>
<a id="__codelineno-44-123" name="__codelineno-44-123" href="#__codelineno-44-123"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-44-124" name="__codelineno-44-124" href="#__codelineno-44-124"></a>
<a id="__codelineno-44-125" name="__codelineno-44-125" href="#__codelineno-44-125"></a><span class="w">    </span><span class="c1"># Add patterns</span>
<a id="__codelineno-44-126" name="__codelineno-44-126" href="#__codelineno-44-126"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span>pattern<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">patterns</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-44-127" name="__codelineno-44-127" href="#__codelineno-44-127"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>grep<span class="w"> </span>-qF<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$pattern</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-44-128" name="__codelineno-44-128" href="#__codelineno-44-128"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$pattern</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span>
<a id="__codelineno-44-129" name="__codelineno-44-129" href="#__codelineno-44-129"></a><span class="w">            </span>_dot_success<span class="w"> </span><span class="s2">&quot;Added </span><span class="nv">$pattern</span><span class="s2"> to .chezmoiignore&quot;</span>
<a id="__codelineno-44-130" name="__codelineno-44-130" href="#__codelineno-44-130"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-44-131" name="__codelineno-44-131" href="#__codelineno-44-131"></a><span class="w">    </span><span class="k">done</span>
<a id="__codelineno-44-132" name="__codelineno-44-132" href="#__codelineno-44-132"></a><span class="o">}</span>
</code></pre></div>
<p><strong>Testing:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="c1"># Test 1: Directory with .git</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>/tmp/test-dotfile/.git
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>dot<span class="w"> </span>add<span class="w"> </span>/tmp/test-dotfile
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="c1"># Expected: Warning, auto-ignore prompt, preview</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="c1"># Test 2: Single file</span>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/tmp/test.txt
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a>dot<span class="w"> </span>add<span class="w"> </span>/tmp/test.txt
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="c1"># Expected: Preview with 1 file, small size</span>
<a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a>
<a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="c1"># Test 3: Directory with generated files</span>
<a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>/tmp/test-gen
<a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a>touch<span class="w"> </span>/tmp/test-gen/app.log<span class="w"> </span>/tmp/test-gen/db.sqlite
<a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a>dot<span class="w"> </span>add<span class="w"> </span>/tmp/test-gen
<a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a><span class="c1"># Expected: Preview warns about .log/.sqlite, suggests ignoring</span>
</code></pre></div></p>
<h4 id="13-ignore-management-commands">1.3 Ignore Management Commands<a class="headerlink" href="#13-ignore-management-commands" title="Permanent link">&para;</a></h4>
<p><strong>File:</strong> <code>lib/dispatchers/dot-dispatcher.zsh</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="s2">&quot;ignore&quot;</span><span class="o">)</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">ignore_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.local/share/chezmoi/.chezmoiignore&quot;</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="w">        </span><span class="s2">&quot;add&quot;</span><span class="o">)</span>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="w">                </span>_dot_error<span class="w"> </span><span class="s2">&quot;Usage: dot ignore add &lt;pattern&gt;&quot;</span>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="w">            </span><span class="k">fi</span>
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a>
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a><span class="w">            </span><span class="c1"># Create file if missing</span>
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a><span class="w">                </span>touch<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span>
<a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a><span class="w">                </span>_dot_info<span class="w"> </span><span class="s2">&quot;Created .chezmoiignore&quot;</span>
<a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a><span class="w">            </span><span class="k">fi</span>
<a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a>
<a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a><span class="w">            </span><span class="c1"># Check if pattern exists</span>
<a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span>grep<span class="w"> </span>-qF<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-46-19" name="__codelineno-46-19" href="#__codelineno-46-19"></a><span class="w">                </span>_dot_warn<span class="w"> </span><span class="s2">&quot;Pattern already in .chezmoiignore: </span><span class="nv">$3</span><span class="s2">&quot;</span>
<a id="__codelineno-46-20" name="__codelineno-46-20" href="#__codelineno-46-20"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-46-21" name="__codelineno-46-21" href="#__codelineno-46-21"></a><span class="w">            </span><span class="k">fi</span>
<a id="__codelineno-46-22" name="__codelineno-46-22" href="#__codelineno-46-22"></a>
<a id="__codelineno-46-23" name="__codelineno-46-23" href="#__codelineno-46-23"></a><span class="w">            </span><span class="c1"># Add pattern</span>
<a id="__codelineno-46-24" name="__codelineno-46-24" href="#__codelineno-46-24"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span>
<a id="__codelineno-46-25" name="__codelineno-46-25" href="#__codelineno-46-25"></a><span class="w">            </span>_dot_success<span class="w"> </span><span class="s2">&quot;Added pattern to .chezmoiignore: </span><span class="nv">$3</span><span class="s2">&quot;</span>
<a id="__codelineno-46-26" name="__codelineno-46-26" href="#__codelineno-46-26"></a><span class="w">            </span><span class="p">;;</span>
<a id="__codelineno-46-27" name="__codelineno-46-27" href="#__codelineno-46-27"></a>
<a id="__codelineno-46-28" name="__codelineno-46-28" href="#__codelineno-46-28"></a><span class="w">        </span><span class="s2">&quot;list&quot;</span><span class="p">|</span><span class="s2">&quot;ls&quot;</span><span class="p">|</span><span class="s2">&quot;&quot;</span><span class="o">)</span>
<a id="__codelineno-46-29" name="__codelineno-46-29" href="#__codelineno-46-29"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-46-30" name="__codelineno-46-30" href="#__codelineno-46-30"></a><span class="w">                </span>_dot_info<span class="w"> </span><span class="s2">&quot;No .chezmoiignore file found&quot;</span>
<a id="__codelineno-46-31" name="__codelineno-46-31" href="#__codelineno-46-31"></a><span class="w">                </span>_dot_info<span class="w"> </span><span class="s2">&quot;Create patterns with: dot ignore add &lt;pattern&gt;&quot;</span>
<a id="__codelineno-46-32" name="__codelineno-46-32" href="#__codelineno-46-32"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-46-33" name="__codelineno-46-33" href="#__codelineno-46-33"></a><span class="w">            </span><span class="k">fi</span>
<a id="__codelineno-46-34" name="__codelineno-46-34" href="#__codelineno-46-34"></a>
<a id="__codelineno-46-35" name="__codelineno-46-35" href="#__codelineno-46-35"></a><span class="w">            </span>_dot_header<span class="w"> </span><span class="s2">&quot;.chezmoiignore patterns:&quot;</span>
<a id="__codelineno-46-36" name="__codelineno-46-36" href="#__codelineno-46-36"></a><span class="w">            </span>cat<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>nl<span class="w"> </span>-w2<span class="w"> </span>-s<span class="s2">&quot;  &quot;</span>
<a id="__codelineno-46-37" name="__codelineno-46-37" href="#__codelineno-46-37"></a><span class="w">            </span><span class="p">;;</span>
<a id="__codelineno-46-38" name="__codelineno-46-38" href="#__codelineno-46-38"></a>
<a id="__codelineno-46-39" name="__codelineno-46-39" href="#__codelineno-46-39"></a><span class="w">        </span><span class="s2">&quot;remove&quot;</span><span class="p">|</span><span class="s2">&quot;rm&quot;</span><span class="o">)</span>
<a id="__codelineno-46-40" name="__codelineno-46-40" href="#__codelineno-46-40"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-46-41" name="__codelineno-46-41" href="#__codelineno-46-41"></a><span class="w">                </span>_dot_error<span class="w"> </span><span class="s2">&quot;Usage: dot ignore remove &lt;pattern&gt;&quot;</span>
<a id="__codelineno-46-42" name="__codelineno-46-42" href="#__codelineno-46-42"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-46-43" name="__codelineno-46-43" href="#__codelineno-46-43"></a><span class="w">            </span><span class="k">fi</span>
<a id="__codelineno-46-44" name="__codelineno-46-44" href="#__codelineno-46-44"></a>
<a id="__codelineno-46-45" name="__codelineno-46-45" href="#__codelineno-46-45"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-46-46" name="__codelineno-46-46" href="#__codelineno-46-46"></a><span class="w">                </span>_dot_error<span class="w"> </span><span class="s2">&quot;No .chezmoiignore file found&quot;</span>
<a id="__codelineno-46-47" name="__codelineno-46-47" href="#__codelineno-46-47"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-46-48" name="__codelineno-46-48" href="#__codelineno-46-48"></a><span class="w">            </span><span class="k">fi</span>
<a id="__codelineno-46-49" name="__codelineno-46-49" href="#__codelineno-46-49"></a>
<a id="__codelineno-46-50" name="__codelineno-46-50" href="#__codelineno-46-50"></a><span class="w">            </span><span class="c1"># Check if pattern exists</span>
<a id="__codelineno-46-51" name="__codelineno-46-51" href="#__codelineno-46-51"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>grep<span class="w"> </span>-qF<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-46-52" name="__codelineno-46-52" href="#__codelineno-46-52"></a><span class="w">                </span>_dot_error<span class="w"> </span><span class="s2">&quot;Pattern not found in .chezmoiignore: </span><span class="nv">$3</span><span class="s2">&quot;</span>
<a id="__codelineno-46-53" name="__codelineno-46-53" href="#__codelineno-46-53"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-46-54" name="__codelineno-46-54" href="#__codelineno-46-54"></a><span class="w">            </span><span class="k">fi</span>
<a id="__codelineno-46-55" name="__codelineno-46-55" href="#__codelineno-46-55"></a>
<a id="__codelineno-46-56" name="__codelineno-46-56" href="#__codelineno-46-56"></a><span class="w">            </span><span class="c1"># Remove using temp file (cross-platform)</span>
<a id="__codelineno-46-57" name="__codelineno-46-57" href="#__codelineno-46-57"></a><span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">temp_file</span><span class="o">=</span><span class="k">$(</span>mktemp<span class="k">)</span>
<a id="__codelineno-46-58" name="__codelineno-46-58" href="#__codelineno-46-58"></a><span class="w">            </span>grep<span class="w"> </span>-vF<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$temp_file</span><span class="s2">&quot;</span>
<a id="__codelineno-46-59" name="__codelineno-46-59" href="#__codelineno-46-59"></a><span class="w">            </span>mv<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$temp_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span>
<a id="__codelineno-46-60" name="__codelineno-46-60" href="#__codelineno-46-60"></a><span class="w">            </span>_dot_success<span class="w"> </span><span class="s2">&quot;Removed pattern from .chezmoiignore: </span><span class="nv">$3</span><span class="s2">&quot;</span>
<a id="__codelineno-46-61" name="__codelineno-46-61" href="#__codelineno-46-61"></a><span class="w">            </span><span class="p">;;</span>
<a id="__codelineno-46-62" name="__codelineno-46-62" href="#__codelineno-46-62"></a>
<a id="__codelineno-46-63" name="__codelineno-46-63" href="#__codelineno-46-63"></a><span class="w">        </span><span class="s2">&quot;edit&quot;</span><span class="o">)</span>
<a id="__codelineno-46-64" name="__codelineno-46-64" href="#__codelineno-46-64"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-46-65" name="__codelineno-46-65" href="#__codelineno-46-65"></a><span class="w">                </span>touch<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span>
<a id="__codelineno-46-66" name="__codelineno-46-66" href="#__codelineno-46-66"></a><span class="w">                </span>_dot_info<span class="w"> </span><span class="s2">&quot;Created .chezmoiignore&quot;</span>
<a id="__codelineno-46-67" name="__codelineno-46-67" href="#__codelineno-46-67"></a><span class="w">            </span><span class="k">fi</span>
<a id="__codelineno-46-68" name="__codelineno-46-68" href="#__codelineno-46-68"></a>
<a id="__codelineno-46-69" name="__codelineno-46-69" href="#__codelineno-46-69"></a><span class="w">            </span><span class="si">${</span><span class="nv">EDITOR</span><span class="k">:-</span><span class="nv">vim</span><span class="si">}</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span>
<a id="__codelineno-46-70" name="__codelineno-46-70" href="#__codelineno-46-70"></a><span class="w">            </span><span class="p">;;</span>
<a id="__codelineno-46-71" name="__codelineno-46-71" href="#__codelineno-46-71"></a>
<a id="__codelineno-46-72" name="__codelineno-46-72" href="#__codelineno-46-72"></a><span class="w">        </span>*<span class="o">)</span>
<a id="__codelineno-46-73" name="__codelineno-46-73" href="#__codelineno-46-73"></a><span class="w">            </span>_dot_error<span class="w"> </span><span class="s2">&quot;Unknown ignore command: </span><span class="nv">$2</span><span class="s2">&quot;</span>
<a id="__codelineno-46-74" name="__codelineno-46-74" href="#__codelineno-46-74"></a><span class="w">            </span><span class="nb">echo</span>
<a id="__codelineno-46-75" name="__codelineno-46-75" href="#__codelineno-46-75"></a><span class="w">            </span>_dot_info<span class="w"> </span><span class="s2">&quot;Usage: dot ignore [add|list|remove|edit]&quot;</span>
<a id="__codelineno-46-76" name="__codelineno-46-76" href="#__codelineno-46-76"></a><span class="w">            </span>_dot_info<span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-46-77" name="__codelineno-46-77" href="#__codelineno-46-77"></a><span class="w">            </span>_dot_info<span class="w"> </span><span class="s2">&quot;Examples:&quot;</span>
<a id="__codelineno-46-78" name="__codelineno-46-78" href="#__codelineno-46-78"></a><span class="w">            </span>_dot_info<span class="w"> </span><span class="s2">&quot;  dot ignore add &#39;**/.git&#39;     # Ignore all .git directories&quot;</span>
<a id="__codelineno-46-79" name="__codelineno-46-79" href="#__codelineno-46-79"></a><span class="w">            </span>_dot_info<span class="w"> </span><span class="s2">&quot;  dot ignore list              # Show all patterns&quot;</span>
<a id="__codelineno-46-80" name="__codelineno-46-80" href="#__codelineno-46-80"></a><span class="w">            </span>_dot_info<span class="w"> </span><span class="s2">&quot;  dot ignore remove &#39;*.log&#39;    # Remove pattern&quot;</span>
<a id="__codelineno-46-81" name="__codelineno-46-81" href="#__codelineno-46-81"></a><span class="w">            </span>_dot_info<span class="w"> </span><span class="s2">&quot;  dot ignore edit              # Edit .chezmoiignore&quot;</span>
<a id="__codelineno-46-82" name="__codelineno-46-82" href="#__codelineno-46-82"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-46-83" name="__codelineno-46-83" href="#__codelineno-46-83"></a><span class="w">            </span><span class="p">;;</span>
<a id="__codelineno-46-84" name="__codelineno-46-84" href="#__codelineno-46-84"></a><span class="w">    </span><span class="k">esac</span>
<a id="__codelineno-46-85" name="__codelineno-46-85" href="#__codelineno-46-85"></a><span class="w">    </span><span class="p">;;</span>
</code></pre></div>
<p><strong>Testing:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="c1"># Test ignore management</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;**/.git&quot;</span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;*.log&quot;</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>dot<span class="w"> </span>ignore<span class="w"> </span>list
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="c1"># Expected: Shows 2 patterns with line numbers</span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a>dot<span class="w"> </span>ignore<span class="w"> </span>remove<span class="w"> </span><span class="s2">&quot;*.log&quot;</span>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a>dot<span class="w"> </span>ignore<span class="w"> </span>list
<a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="c1"># Expected: Shows 1 pattern</span>
<a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a>
<a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a>dot<span class="w"> </span>ignore<span class="w"> </span>edit
<a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a><span class="c1"># Expected: Opens .chezmoiignore in $EDITOR</span>
</code></pre></div></p>
<h3 id="phase-2-health-visibility-week-2-days-6-8">Phase 2: Health &amp; Visibility (Week 2, Days 6-8)<a class="headerlink" href="#phase-2-health-visibility-week-2-days-6-8" title="Permanent link">&para;</a></h3>
<p><strong>Effort:</strong> 6-7 hours
<strong>Dependencies:</strong> Phase 1 complete</p>
<h4 id="21-repository-size-analysis">2.1 Repository Size Analysis<a class="headerlink" href="#21-repository-size-analysis" title="Permanent link">&para;</a></h4>
<p><strong>File:</strong> <code>lib/dispatchers/dot-dispatcher.zsh</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="s2">&quot;size&quot;</span><span class="o">)</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">chezmoi_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.local/share/chezmoi&quot;</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>!<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$chezmoi_dir</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="w">        </span>_dot_error<span class="w"> </span><span class="s2">&quot;Chezmoi directory not found: </span><span class="nv">$chezmoi_dir</span><span class="s2">&quot;</span>
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a>
<a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="w">    </span>_dot_header<span class="w"> </span><span class="s2">&quot;Chezmoi Repository Size&quot;</span>
<a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a>
<a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a><span class="w">    </span><span class="c1"># Total size</span>
<a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">total_size</span><span class="o">=</span><span class="k">$(</span>du<span class="w"> </span>-sh<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$chezmoi_dir</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f1<span class="k">)</span>
<a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Total: </span><span class="nv">$total_size</span><span class="s2">&quot;</span>
<a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a>
<a id="__codelineno-48-17" name="__codelineno-48-17" href="#__codelineno-48-17"></a><span class="w">    </span><span class="c1"># Top 10 largest files</span>
<a id="__codelineno-48-18" name="__codelineno-48-18" href="#__codelineno-48-18"></a><span class="w">    </span>_dot_info<span class="w"> </span><span class="s2">&quot;Top 10 largest files:&quot;</span>
<a id="__codelineno-48-19" name="__codelineno-48-19" href="#__codelineno-48-19"></a><span class="w">    </span><span class="o">(</span>
<a id="__codelineno-48-20" name="__codelineno-48-20" href="#__codelineno-48-20"></a><span class="w">        </span><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$chezmoi_dir</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-48-21" name="__codelineno-48-21" href="#__codelineno-48-21"></a><span class="w">        </span>find<span class="w"> </span>.<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-not<span class="w"> </span>-path<span class="w"> </span><span class="s2">&quot;./.git/*&quot;</span><span class="w"> </span>-exec<span class="w"> </span>du<span class="w"> </span>-h<span class="w"> </span><span class="o">{}</span><span class="w"> </span>+<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-48-22" name="__codelineno-48-22" href="#__codelineno-48-22"></a><span class="w">        </span>sort<span class="w"> </span>-rh<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-48-23" name="__codelineno-48-23" href="#__codelineno-48-23"></a><span class="w">        </span>head<span class="w"> </span>-10<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-48-24" name="__codelineno-48-24" href="#__codelineno-48-24"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="s1">$&#39;\t&#39;</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>size<span class="w"> </span>path<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-48-25" name="__codelineno-48-25" href="#__codelineno-48-25"></a><span class="w">            </span><span class="c1"># Strip leading ./</span>
<a id="__codelineno-48-26" name="__codelineno-48-26" href="#__codelineno-48-26"></a><span class="w">            </span><span class="nv">path</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">path</span><span class="p">#./</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-48-27" name="__codelineno-48-27" href="#__codelineno-48-27"></a>
<a id="__codelineno-48-28" name="__codelineno-48-28" href="#__codelineno-48-28"></a><span class="w">            </span><span class="c1"># Warn if .git in path</span>
<a id="__codelineno-48-29" name="__codelineno-48-29" href="#__codelineno-48-29"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$path</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>*<span class="s2">&quot;.git&quot;</span>*<span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$path</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>*<span class="s2">&quot;dot_git&quot;</span>*<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-48-30" name="__codelineno-48-30" href="#__codelineno-48-30"></a><span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  ‚ö†Ô∏è  </span><span class="nv">$size</span><span class="s2">  </span><span class="nv">$path</span><span class="s2">&quot;</span>
<a id="__codelineno-48-31" name="__codelineno-48-31" href="#__codelineno-48-31"></a><span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;      (Git metadata - should be ignored)&quot;</span>
<a id="__codelineno-48-32" name="__codelineno-48-32" href="#__codelineno-48-32"></a><span class="w">            </span><span class="k">else</span>
<a id="__codelineno-48-33" name="__codelineno-48-33" href="#__codelineno-48-33"></a><span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;      </span><span class="nv">$size</span><span class="s2">  </span><span class="nv">$path</span><span class="s2">&quot;</span>
<a id="__codelineno-48-34" name="__codelineno-48-34" href="#__codelineno-48-34"></a><span class="w">            </span><span class="k">fi</span>
<a id="__codelineno-48-35" name="__codelineno-48-35" href="#__codelineno-48-35"></a><span class="w">        </span><span class="k">done</span>
<a id="__codelineno-48-36" name="__codelineno-48-36" href="#__codelineno-48-36"></a><span class="w">    </span><span class="o">)</span>
<a id="__codelineno-48-37" name="__codelineno-48-37" href="#__codelineno-48-37"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-48-38" name="__codelineno-48-38" href="#__codelineno-48-38"></a>
<a id="__codelineno-48-39" name="__codelineno-48-39" href="#__codelineno-48-39"></a><span class="w">    </span><span class="c1"># Check for nested .git directories</span>
<a id="__codelineno-48-40" name="__codelineno-48-40" href="#__codelineno-48-40"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">git_count</span><span class="o">=</span><span class="k">$(</span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$chezmoi_dir</span><span class="s2">&quot;</span><span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;.git&quot;</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-not<span class="w"> </span>-path<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$chezmoi_dir</span><span class="s2">/.git&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="k">)</span>
<a id="__codelineno-48-41" name="__codelineno-48-41" href="#__codelineno-48-41"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">git_dot_count</span><span class="o">=</span><span class="k">$(</span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$chezmoi_dir</span><span class="s2">&quot;</span><span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;dot_git&quot;</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="k">)</span>
<a id="__codelineno-48-42" name="__codelineno-48-42" href="#__codelineno-48-42"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">total_git_dirs</span><span class="o">=</span><span class="k">$((</span><span class="nv">git_count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">git_dot_count</span><span class="k">))</span>
<a id="__codelineno-48-43" name="__codelineno-48-43" href="#__codelineno-48-43"></a>
<a id="__codelineno-48-44" name="__codelineno-48-44" href="#__codelineno-48-44"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>total_git_dirs<span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-48-45" name="__codelineno-48-45" href="#__codelineno-48-45"></a><span class="w">        </span>_dot_warn<span class="w"> </span><span class="s2">&quot;Found </span><span class="nv">$total_git_dirs</span><span class="s2"> nested git directories (should be ignored)&quot;</span>
<a id="__codelineno-48-46" name="__codelineno-48-46" href="#__codelineno-48-46"></a><span class="w">        </span>_dot_info<span class="w"> </span><span class="s2">&quot;Fix with: dot ignore add &#39;**/.git&#39; &amp;&amp; chezmoi forget &#39;.config/*/.git&#39;&quot;</span>
<a id="__codelineno-48-47" name="__codelineno-48-47" href="#__codelineno-48-47"></a><span class="w">        </span><span class="nb">echo</span>
<a id="__codelineno-48-48" name="__codelineno-48-48" href="#__codelineno-48-48"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-48-49" name="__codelineno-48-49" href="#__codelineno-48-49"></a><span class="w">        </span>_dot_success<span class="w"> </span><span class="s2">&quot;No nested git directories tracked&quot;</span>
<a id="__codelineno-48-50" name="__codelineno-48-50" href="#__codelineno-48-50"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-48-51" name="__codelineno-48-51" href="#__codelineno-48-51"></a>
<a id="__codelineno-48-52" name="__codelineno-48-52" href="#__codelineno-48-52"></a><span class="w">    </span><span class="c1"># Check for large files (&gt;100KB)</span>
<a id="__codelineno-48-53" name="__codelineno-48-53" href="#__codelineno-48-53"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">large_count</span><span class="o">=</span><span class="k">$(</span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$chezmoi_dir</span><span class="s2">&quot;</span><span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-not<span class="w"> </span>-path<span class="w"> </span><span class="s2">&quot;./.git/*&quot;</span><span class="w"> </span>-size<span class="w"> </span>+100k<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="k">)</span>
<a id="__codelineno-48-54" name="__codelineno-48-54" href="#__codelineno-48-54"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>large_count<span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-48-55" name="__codelineno-48-55" href="#__codelineno-48-55"></a><span class="w">        </span>_dot_warn<span class="w"> </span><span class="s2">&quot;Found </span><span class="nv">$large_count</span><span class="s2"> files larger than 100KB&quot;</span>
<a id="__codelineno-48-56" name="__codelineno-48-56" href="#__codelineno-48-56"></a><span class="w">        </span>_dot_info<span class="w"> </span><span class="s2">&quot;Consider reviewing with: find ~/.local/share/chezmoi -type f -size +100k&quot;</span>
<a id="__codelineno-48-57" name="__codelineno-48-57" href="#__codelineno-48-57"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-48-58" name="__codelineno-48-58" href="#__codelineno-48-58"></a><span class="w">    </span><span class="p">;;</span>
</code></pre></div>
<p><strong>Testing:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>dot<span class="w"> </span>size
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="c1"># Expected: Shows total size, top 10 files, warnings for .git dirs</span>
</code></pre></div></p>
<h4 id="22-doctor-integration">2.2 Doctor Integration<a class="headerlink" href="#22-doctor-integration" title="Permanent link">&para;</a></h4>
<p><strong>File:</strong> <code>lib/dispatchers/dot-dispatcher.zsh</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>_dot_doctor_check_chezmoi_health<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">chezmoi_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.local/share/chezmoi&quot;</span>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">ignore_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$chezmoi_dir</span><span class="s2">/.chezmoiignore&quot;</span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="w">    </span>_dot_header<span class="w"> </span><span class="s2">&quot;Dotfile Management&quot;</span>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="w">    </span><span class="c1"># Check chezmoi installed</span>
<a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>chezmoi<span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="w">        </span><span class="nb">local</span><span class="w"> </span><span class="nv">version</span><span class="o">=</span><span class="k">$(</span>chezmoi<span class="w"> </span>--version<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-oE<span class="w"> </span><span class="s1">&#39;v[0-9]+\.[0-9]+\.[0-9]+&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="k">)</span>
<a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="w">        </span>_dot_success<span class="w"> </span><span class="s2">&quot;chezmoi installed (</span><span class="nv">$version</span><span class="s2">)&quot;</span>
<a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a><span class="w">        </span>_dot_error<span class="w"> </span><span class="s2">&quot;chezmoi not installed&quot;</span>
<a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a><span class="w">        </span>_dot_info<span class="w"> </span><span class="s2">&quot;Install with: brew install chezmoi&quot;</span>
<a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a>
<a id="__codelineno-50-17" name="__codelineno-50-17" href="#__codelineno-50-17"></a><span class="w">    </span><span class="c1"># Check repository initialized</span>
<a id="__codelineno-50-18" name="__codelineno-50-18" href="#__codelineno-50-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$chezmoi_dir</span><span class="s2">/.git&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-50-19" name="__codelineno-50-19" href="#__codelineno-50-19"></a><span class="w">        </span>_dot_success<span class="w"> </span><span class="s2">&quot;Repository initialized&quot;</span>
<a id="__codelineno-50-20" name="__codelineno-50-20" href="#__codelineno-50-20"></a>
<a id="__codelineno-50-21" name="__codelineno-50-21" href="#__codelineno-50-21"></a><span class="w">        </span><span class="c1"># Check remote connection</span>
<a id="__codelineno-50-22" name="__codelineno-50-22" href="#__codelineno-50-22"></a><span class="w">        </span><span class="nb">local</span><span class="w"> </span><span class="nv">remote</span><span class="o">=</span><span class="k">$(</span><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$chezmoi_dir</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>git<span class="w"> </span>remote<span class="w"> </span>get-url<span class="w"> </span>origin<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="k">)</span>
<a id="__codelineno-50-23" name="__codelineno-50-23" href="#__codelineno-50-23"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$remote</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-50-24" name="__codelineno-50-24" href="#__codelineno-50-24"></a><span class="w">            </span>_dot_success<span class="w"> </span><span class="s2">&quot;Connected to remote (</span><span class="nv">$remote</span><span class="s2">)&quot;</span>
<a id="__codelineno-50-25" name="__codelineno-50-25" href="#__codelineno-50-25"></a><span class="w">        </span><span class="k">else</span>
<a id="__codelineno-50-26" name="__codelineno-50-26" href="#__codelineno-50-26"></a><span class="w">            </span>_dot_warn<span class="w"> </span><span class="s2">&quot;No remote repository configured&quot;</span>
<a id="__codelineno-50-27" name="__codelineno-50-27" href="#__codelineno-50-27"></a><span class="w">            </span>_dot_info<span class="w"> </span><span class="s2">&quot;Add with: chezmoi git remote add origin &lt;url&gt;&quot;</span>
<a id="__codelineno-50-28" name="__codelineno-50-28" href="#__codelineno-50-28"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-50-29" name="__codelineno-50-29" href="#__codelineno-50-29"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-50-30" name="__codelineno-50-30" href="#__codelineno-50-30"></a><span class="w">        </span>_dot_error<span class="w"> </span><span class="s2">&quot;Repository not initialized&quot;</span>
<a id="__codelineno-50-31" name="__codelineno-50-31" href="#__codelineno-50-31"></a><span class="w">        </span>_dot_info<span class="w"> </span><span class="s2">&quot;Initialize with: chezmoi init&quot;</span>
<a id="__codelineno-50-32" name="__codelineno-50-32" href="#__codelineno-50-32"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-50-33" name="__codelineno-50-33" href="#__codelineno-50-33"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-50-34" name="__codelineno-50-34" href="#__codelineno-50-34"></a>
<a id="__codelineno-50-35" name="__codelineno-50-35" href="#__codelineno-50-35"></a><span class="w">    </span><span class="c1"># Check .chezmoiignore</span>
<a id="__codelineno-50-36" name="__codelineno-50-36" href="#__codelineno-50-36"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-50-37" name="__codelineno-50-37" href="#__codelineno-50-37"></a><span class="w">        </span><span class="nb">local</span><span class="w"> </span><span class="nv">pattern_count</span><span class="o">=</span><span class="k">$(</span>grep<span class="w"> </span>-c<span class="w"> </span>-v<span class="w"> </span><span class="s1">&#39;^$&#39;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="m">0</span><span class="k">)</span>
<a id="__codelineno-50-38" name="__codelineno-50-38" href="#__codelineno-50-38"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>pattern_count<span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-50-39" name="__codelineno-50-39" href="#__codelineno-50-39"></a><span class="w">            </span>_dot_success<span class="w"> </span><span class="s2">&quot;.chezmoiignore configured (</span><span class="nv">$pattern_count</span><span class="s2"> patterns)&quot;</span>
<a id="__codelineno-50-40" name="__codelineno-50-40" href="#__codelineno-50-40"></a><span class="w">        </span><span class="k">else</span>
<a id="__codelineno-50-41" name="__codelineno-50-41" href="#__codelineno-50-41"></a><span class="w">            </span>_dot_warn<span class="w"> </span><span class="s2">&quot;.chezmoiignore is empty&quot;</span>
<a id="__codelineno-50-42" name="__codelineno-50-42" href="#__codelineno-50-42"></a><span class="w">            </span>_dot_info<span class="w"> </span><span class="s2">&quot;Add patterns with: dot ignore add &lt;pattern&gt;&quot;</span>
<a id="__codelineno-50-43" name="__codelineno-50-43" href="#__codelineno-50-43"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-50-44" name="__codelineno-50-44" href="#__codelineno-50-44"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-50-45" name="__codelineno-50-45" href="#__codelineno-50-45"></a><span class="w">        </span>_dot_warn<span class="w"> </span><span class="s2">&quot;No .chezmoiignore file found&quot;</span>
<a id="__codelineno-50-46" name="__codelineno-50-46" href="#__codelineno-50-46"></a><span class="w">        </span>_dot_info<span class="w"> </span><span class="s2">&quot;Create with: dot ignore add &#39;**/.git&#39;&quot;</span>
<a id="__codelineno-50-47" name="__codelineno-50-47" href="#__codelineno-50-47"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-50-48" name="__codelineno-50-48" href="#__codelineno-50-48"></a>
<a id="__codelineno-50-49" name="__codelineno-50-49" href="#__codelineno-50-49"></a><span class="w">    </span><span class="c1"># Check managed file count</span>
<a id="__codelineno-50-50" name="__codelineno-50-50" href="#__codelineno-50-50"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">managed_count</span><span class="o">=</span><span class="k">$(</span>chezmoi<span class="w"> </span>managed<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="k">)</span>
<a id="__codelineno-50-51" name="__codelineno-50-51" href="#__codelineno-50-51"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>managed_count<span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-50-52" name="__codelineno-50-52" href="#__codelineno-50-52"></a><span class="w">        </span>_dot_success<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$managed_count</span><span class="s2"> files managed&quot;</span>
<a id="__codelineno-50-53" name="__codelineno-50-53" href="#__codelineno-50-53"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-50-54" name="__codelineno-50-54" href="#__codelineno-50-54"></a><span class="w">        </span>_dot_warn<span class="w"> </span><span class="s2">&quot;No files managed by chezmoi&quot;</span>
<a id="__codelineno-50-55" name="__codelineno-50-55" href="#__codelineno-50-55"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-50-56" name="__codelineno-50-56" href="#__codelineno-50-56"></a>
<a id="__codelineno-50-57" name="__codelineno-50-57" href="#__codelineno-50-57"></a><span class="w">    </span><span class="c1"># Check repository size</span>
<a id="__codelineno-50-58" name="__codelineno-50-58" href="#__codelineno-50-58"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$chezmoi_dir</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-50-59" name="__codelineno-50-59" href="#__codelineno-50-59"></a><span class="w">        </span><span class="nb">local</span><span class="w"> </span><span class="nv">size_bytes</span><span class="o">=</span><span class="k">$(</span>du<span class="w"> </span>-sk<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$chezmoi_dir</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f1<span class="k">)</span>
<a id="__codelineno-50-60" name="__codelineno-50-60" href="#__codelineno-50-60"></a><span class="w">        </span><span class="nb">local</span><span class="w"> </span><span class="nv">size_mb</span><span class="o">=</span><span class="k">$((</span><span class="nv">size_bytes</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">1024</span><span class="k">))</span>
<a id="__codelineno-50-61" name="__codelineno-50-61" href="#__codelineno-50-61"></a>
<a id="__codelineno-50-62" name="__codelineno-50-62" href="#__codelineno-50-62"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>size_mb<span class="w"> </span>&lt;<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-50-63" name="__codelineno-50-63" href="#__codelineno-50-63"></a><span class="w">            </span>_dot_success<span class="w"> </span><span class="s2">&quot;Repository size: </span><span class="si">${</span><span class="nv">size_mb</span><span class="si">}</span><span class="s2"> MB (healthy)&quot;</span>
<a id="__codelineno-50-64" name="__codelineno-50-64" href="#__codelineno-50-64"></a><span class="w">        </span><span class="k">elif</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>size_mb<span class="w"> </span>&lt;<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-50-65" name="__codelineno-50-65" href="#__codelineno-50-65"></a><span class="w">            </span>_dot_warn<span class="w"> </span><span class="s2">&quot;Repository size: </span><span class="si">${</span><span class="nv">size_mb</span><span class="si">}</span><span class="s2"> MB (consider cleanup)&quot;</span>
<a id="__codelineno-50-66" name="__codelineno-50-66" href="#__codelineno-50-66"></a><span class="w">            </span>_dot_info<span class="w"> </span><span class="s2">&quot;Analyze with: dot size&quot;</span>
<a id="__codelineno-50-67" name="__codelineno-50-67" href="#__codelineno-50-67"></a><span class="w">        </span><span class="k">else</span>
<a id="__codelineno-50-68" name="__codelineno-50-68" href="#__codelineno-50-68"></a><span class="w">            </span>_dot_error<span class="w"> </span><span class="s2">&quot;Repository size: </span><span class="si">${</span><span class="nv">size_mb</span><span class="si">}</span><span class="s2"> MB (too large)&quot;</span>
<a id="__codelineno-50-69" name="__codelineno-50-69" href="#__codelineno-50-69"></a><span class="w">            </span>_dot_info<span class="w"> </span><span class="s2">&quot;Cleanup with: dot size&quot;</span>
<a id="__codelineno-50-70" name="__codelineno-50-70" href="#__codelineno-50-70"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-50-71" name="__codelineno-50-71" href="#__codelineno-50-71"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-50-72" name="__codelineno-50-72" href="#__codelineno-50-72"></a>
<a id="__codelineno-50-73" name="__codelineno-50-73" href="#__codelineno-50-73"></a><span class="w">    </span><span class="c1"># Check for large files</span>
<a id="__codelineno-50-74" name="__codelineno-50-74" href="#__codelineno-50-74"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">large_files</span><span class="o">=</span><span class="k">$(</span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$chezmoi_dir</span><span class="s2">&quot;</span><span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-not<span class="w"> </span>-path<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$chezmoi_dir</span><span class="s2">/.git/*&quot;</span><span class="w"> </span>-size<span class="w"> </span>+100k<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="k">)</span>
<a id="__codelineno-50-75" name="__codelineno-50-75" href="#__codelineno-50-75"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$large_files</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-50-76" name="__codelineno-50-76" href="#__codelineno-50-76"></a><span class="w">        </span>_dot_warn<span class="w"> </span><span class="s2">&quot;Large files tracked (&gt;100KB):&quot;</span>
<a id="__codelineno-50-77" name="__codelineno-50-77" href="#__codelineno-50-77"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$large_files</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>file<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-50-78" name="__codelineno-50-78" href="#__codelineno-50-78"></a><span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="k">$(</span>du<span class="w"> </span>-h<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f1<span class="k">)</span>
<a id="__codelineno-50-79" name="__codelineno-50-79" href="#__codelineno-50-79"></a><span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">rel_path</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">file</span><span class="p">#</span><span class="nv">$chezmoi_dir</span><span class="p">/</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-50-80" name="__codelineno-50-80" href="#__codelineno-50-80"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  - </span><span class="nv">$size</span><span class="s2">  </span><span class="nv">$rel_path</span><span class="s2">&quot;</span>
<a id="__codelineno-50-81" name="__codelineno-50-81" href="#__codelineno-50-81"></a><span class="w">        </span><span class="k">done</span>
<a id="__codelineno-50-82" name="__codelineno-50-82" href="#__codelineno-50-82"></a><span class="w">        </span>_dot_info<span class="w"> </span><span class="s2">&quot;Consider adding ignore patterns&quot;</span>
<a id="__codelineno-50-83" name="__codelineno-50-83" href="#__codelineno-50-83"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-50-84" name="__codelineno-50-84" href="#__codelineno-50-84"></a><span class="w">        </span>_dot_success<span class="w"> </span><span class="s2">&quot;No large files tracked&quot;</span>
<a id="__codelineno-50-85" name="__codelineno-50-85" href="#__codelineno-50-85"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-50-86" name="__codelineno-50-86" href="#__codelineno-50-86"></a>
<a id="__codelineno-50-87" name="__codelineno-50-87" href="#__codelineno-50-87"></a><span class="w">    </span><span class="c1"># Check for nested .git</span>
<a id="__codelineno-50-88" name="__codelineno-50-88" href="#__codelineno-50-88"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">git_dirs</span><span class="o">=</span><span class="k">$(</span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$chezmoi_dir</span><span class="s2">&quot;</span><span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;.git&quot;</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-not<span class="w"> </span>-path<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$chezmoi_dir</span><span class="s2">/.git&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="k">)</span>
<a id="__codelineno-50-89" name="__codelineno-50-89" href="#__codelineno-50-89"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">git_dot_dirs</span><span class="o">=</span><span class="k">$(</span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$chezmoi_dir</span><span class="s2">&quot;</span><span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;dot_git&quot;</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="k">)</span>
<a id="__codelineno-50-90" name="__codelineno-50-90" href="#__codelineno-50-90"></a>
<a id="__codelineno-50-91" name="__codelineno-50-91" href="#__codelineno-50-91"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$git_dirs</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$git_dot_dirs</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-50-92" name="__codelineno-50-92" href="#__codelineno-50-92"></a><span class="w">        </span>_dot_error<span class="w"> </span><span class="s2">&quot;Git directories tracked (should be ignored):&quot;</span>
<a id="__codelineno-50-93" name="__codelineno-50-93" href="#__codelineno-50-93"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$git_dirs</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-50-94" name="__codelineno-50-94" href="#__codelineno-50-94"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$git_dirs</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>gitdir<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-50-95" name="__codelineno-50-95" href="#__codelineno-50-95"></a><span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  - </span><span class="si">${</span><span class="nv">gitdir</span><span class="p">#</span><span class="nv">$chezmoi_dir</span><span class="p">/</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-50-96" name="__codelineno-50-96" href="#__codelineno-50-96"></a><span class="w">            </span><span class="k">done</span>
<a id="__codelineno-50-97" name="__codelineno-50-97" href="#__codelineno-50-97"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-50-98" name="__codelineno-50-98" href="#__codelineno-50-98"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$git_dot_dirs</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-50-99" name="__codelineno-50-99" href="#__codelineno-50-99"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$git_dot_dirs</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>gitdir<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-50-100" name="__codelineno-50-100" href="#__codelineno-50-100"></a><span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  - </span><span class="si">${</span><span class="nv">gitdir</span><span class="p">#</span><span class="nv">$chezmoi_dir</span><span class="p">/</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-50-101" name="__codelineno-50-101" href="#__codelineno-50-101"></a><span class="w">            </span><span class="k">done</span>
<a id="__codelineno-50-102" name="__codelineno-50-102" href="#__codelineno-50-102"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-50-103" name="__codelineno-50-103" href="#__codelineno-50-103"></a><span class="w">        </span>_dot_info<span class="w"> </span><span class="s2">&quot;Fix with: dot ignore add &#39;**/.git&#39;&quot;</span>
<a id="__codelineno-50-104" name="__codelineno-50-104" href="#__codelineno-50-104"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-50-105" name="__codelineno-50-105" href="#__codelineno-50-105"></a><span class="w">        </span>_dot_success<span class="w"> </span><span class="s2">&quot;No nested git directories tracked&quot;</span>
<a id="__codelineno-50-106" name="__codelineno-50-106" href="#__codelineno-50-106"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-50-107" name="__codelineno-50-107" href="#__codelineno-50-107"></a>
<a id="__codelineno-50-108" name="__codelineno-50-108" href="#__codelineno-50-108"></a><span class="w">    </span><span class="c1"># Check sync status</span>
<a id="__codelineno-50-109" name="__codelineno-50-109" href="#__codelineno-50-109"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">status</span><span class="o">=</span><span class="k">$(</span>_dot_get_sync_status<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;unknown&quot;</span><span class="k">)</span>
<a id="__codelineno-50-110" name="__codelineno-50-110" href="#__codelineno-50-110"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">last_sync</span><span class="o">=</span><span class="k">$(</span>_dot_get_last_sync_time<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;never&quot;</span><span class="k">)</span>
<a id="__codelineno-50-111" name="__codelineno-50-111" href="#__codelineno-50-111"></a>
<a id="__codelineno-50-112" name="__codelineno-50-112" href="#__codelineno-50-112"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$status</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<a id="__codelineno-50-113" name="__codelineno-50-113" href="#__codelineno-50-113"></a><span class="w">        </span><span class="s2">&quot;synced&quot;</span><span class="o">)</span>
<a id="__codelineno-50-114" name="__codelineno-50-114" href="#__codelineno-50-114"></a><span class="w">            </span>_dot_success<span class="w"> </span><span class="s2">&quot;Last sync: </span><span class="nv">$last_sync</span><span class="s2"> (synced)&quot;</span>
<a id="__codelineno-50-115" name="__codelineno-50-115" href="#__codelineno-50-115"></a><span class="w">            </span><span class="p">;;</span>
<a id="__codelineno-50-116" name="__codelineno-50-116" href="#__codelineno-50-116"></a><span class="w">        </span><span class="s2">&quot;modified&quot;</span><span class="o">)</span>
<a id="__codelineno-50-117" name="__codelineno-50-117" href="#__codelineno-50-117"></a><span class="w">            </span>_dot_warn<span class="w"> </span><span class="s2">&quot;Last sync: </span><span class="nv">$last_sync</span><span class="s2"> (local changes)&quot;</span>
<a id="__codelineno-50-118" name="__codelineno-50-118" href="#__codelineno-50-118"></a><span class="w">            </span>_dot_info<span class="w"> </span><span class="s2">&quot;Sync with: dot push&quot;</span>
<a id="__codelineno-50-119" name="__codelineno-50-119" href="#__codelineno-50-119"></a><span class="w">            </span><span class="p">;;</span>
<a id="__codelineno-50-120" name="__codelineno-50-120" href="#__codelineno-50-120"></a><span class="w">        </span><span class="s2">&quot;behind&quot;</span><span class="o">)</span>
<a id="__codelineno-50-121" name="__codelineno-50-121" href="#__codelineno-50-121"></a><span class="w">            </span>_dot_warn<span class="w"> </span><span class="s2">&quot;Last sync: </span><span class="nv">$last_sync</span><span class="s2"> (behind remote)&quot;</span>
<a id="__codelineno-50-122" name="__codelineno-50-122" href="#__codelineno-50-122"></a><span class="w">            </span>_dot_info<span class="w"> </span><span class="s2">&quot;Pull with: dot sync&quot;</span>
<a id="__codelineno-50-123" name="__codelineno-50-123" href="#__codelineno-50-123"></a><span class="w">            </span><span class="p">;;</span>
<a id="__codelineno-50-124" name="__codelineno-50-124" href="#__codelineno-50-124"></a><span class="w">        </span><span class="s2">&quot;ahead&quot;</span><span class="o">)</span>
<a id="__codelineno-50-125" name="__codelineno-50-125" href="#__codelineno-50-125"></a><span class="w">            </span>_dot_info<span class="w"> </span><span class="s2">&quot;Last sync: </span><span class="nv">$last_sync</span><span class="s2"> (ahead of remote)&quot;</span>
<a id="__codelineno-50-126" name="__codelineno-50-126" href="#__codelineno-50-126"></a><span class="w">            </span>_dot_info<span class="w"> </span><span class="s2">&quot;Push with: dot push&quot;</span>
<a id="__codelineno-50-127" name="__codelineno-50-127" href="#__codelineno-50-127"></a><span class="w">            </span><span class="p">;;</span>
<a id="__codelineno-50-128" name="__codelineno-50-128" href="#__codelineno-50-128"></a><span class="w">        </span>*<span class="o">)</span>
<a id="__codelineno-50-129" name="__codelineno-50-129" href="#__codelineno-50-129"></a><span class="w">            </span>_dot_info<span class="w"> </span><span class="s2">&quot;Sync status: </span><span class="nv">$status</span><span class="s2">&quot;</span>
<a id="__codelineno-50-130" name="__codelineno-50-130" href="#__codelineno-50-130"></a><span class="w">            </span><span class="p">;;</span>
<a id="__codelineno-50-131" name="__codelineno-50-131" href="#__codelineno-50-131"></a><span class="w">    </span><span class="k">esac</span>
<a id="__codelineno-50-132" name="__codelineno-50-132" href="#__codelineno-50-132"></a><span class="o">}</span>
</code></pre></div>
<p><strong>Integration:</strong> Add call to existing <code>flow doctor</code> command</p>
<p><strong>Testing:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>flow<span class="w"> </span>doctor
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="c1"># Expected: Includes &quot;Dotfile Management&quot; section with all checks</span>
</code></pre></div></p>
<h3 id="phase-3-integration-architecture-week-2-days-9-10">Phase 3: Integration &amp; Architecture (Week 2, Days 9-10)<a class="headerlink" href="#phase-3-integration-architecture-week-2-days-9-10" title="Permanent link">&para;</a></h3>
<p><strong>Effort:</strong> 4-5 hours
<strong>Dependencies:</strong> Phase 2 complete</p>
<h4 id="31-doctor-integration">3.1 Doctor Integration<a class="headerlink" href="#31-doctor-integration" title="Permanent link">&para;</a></h4>
<p><strong>File:</strong> <code>commands/doctor.zsh</code></p>
<p>Add chezmoi health check integration point:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="c1"># After existing token checks and before final summary</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="c1"># Source dotfile helpers if available</span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">FLOW_PLUGIN_DIR</span><span class="si">}</span><span class="s2">/lib/dotfile-helpers.zsh&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="w">    </span><span class="nb">source</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">FLOW_PLUGIN_DIR</span><span class="si">}</span><span class="s2">/lib/dotfile-helpers.zsh&quot;</span>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="k">fi</span>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a>
<a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="c1"># Dotfile Management Check (if chezmoi installed)</span>
<a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="k">if</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>chezmoi<span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a><span class="w">    </span>_dot_doctor_check_chezmoi_health
<a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a><span class="k">else</span>
<a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-52-14" name="__codelineno-52-14" href="#__codelineno-52-14"></a><span class="w">    </span>_flow_log_info<span class="w"> </span><span class="s2">&quot;Dotfile Management: chezmoi not installed (optional)&quot;</span>
<a id="__codelineno-52-15" name="__codelineno-52-15" href="#__codelineno-52-15"></a><span class="w">    </span>_flow_log_info<span class="w"> </span><span class="s2">&quot;Install with: brew install chezmoi&quot;</span>
<a id="__codelineno-52-16" name="__codelineno-52-16" href="#__codelineno-52-16"></a><span class="k">fi</span>
</code></pre></div>
<p><strong>Testing:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>flow<span class="w"> </span>doctor
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="c1"># Expected: Chezmoi health section appears after token checks</span>
</code></pre></div></p>
<h4 id="32-update-dot-status-command">3.2 Update <code>dot status</code> Command<a class="headerlink" href="#32-update-dot-status-command" title="Permanent link">&para;</a></h4>
<p><strong>File:</strong> <code>lib/dispatchers/dot-dispatcher.zsh</code></p>
<p>Enhance status display with repository health:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="c1"># In _dot_status() function, add after sync status:</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="c1"># Repository health</span>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.local/share/chezmoi/.git&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="w">    </span>_flow_log_info<span class="w"> </span><span class="s2">&quot;Repository Health:&quot;</span>
<a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a>
<a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="w">    </span><span class="c1"># Get cached size or calculate</span>
<a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span>size_display
<a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">size_display</span><span class="o">=</span><span class="k">$(</span>_dot_get_cached_size<span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  Size: </span><span class="nv">$size_display</span><span class="s2"> (cached)&quot;</span>
<a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-54-13" name="__codelineno-54-13" href="#__codelineno-54-13"></a><span class="w">        </span><span class="nb">local</span><span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="k">$(</span>du<span class="w"> </span>-sh<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.local/share/chezmoi&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f1<span class="k">)</span>
<a id="__codelineno-54-14" name="__codelineno-54-14" href="#__codelineno-54-14"></a><span class="w">        </span>_dot_cache_size<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$size</span><span class="s2">&quot;</span>
<a id="__codelineno-54-15" name="__codelineno-54-15" href="#__codelineno-54-15"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  Size: </span><span class="nv">$size</span><span class="s2">&quot;</span>
<a id="__codelineno-54-16" name="__codelineno-54-16" href="#__codelineno-54-16"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-54-17" name="__codelineno-54-17" href="#__codelineno-54-17"></a>
<a id="__codelineno-54-18" name="__codelineno-54-18" href="#__codelineno-54-18"></a><span class="w">    </span><span class="c1"># Warn if large</span>
<a id="__codelineno-54-19" name="__codelineno-54-19" href="#__codelineno-54-19"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">size_mb</span><span class="o">=</span><span class="k">$(</span>du<span class="w"> </span>-sm<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.local/share/chezmoi&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f1<span class="k">)</span>
<a id="__codelineno-54-20" name="__codelineno-54-20" href="#__codelineno-54-20"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>size_mb<span class="w"> </span>&gt;<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-54-21" name="__codelineno-54-21" href="#__codelineno-54-21"></a><span class="w">        </span>_flow_log_warn<span class="w"> </span><span class="s2">&quot;  Repository is large (</span><span class="si">${</span><span class="nv">size_mb</span><span class="si">}</span><span class="s2">MB)&quot;</span>
<a id="__codelineno-54-22" name="__codelineno-54-22" href="#__codelineno-54-22"></a><span class="w">        </span>_flow_log_info<span class="w"> </span><span class="s2">&quot;  Run &#39;dot size&#39; to analyze&quot;</span>
<a id="__codelineno-54-23" name="__codelineno-54-23" href="#__codelineno-54-23"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-54-24" name="__codelineno-54-24" href="#__codelineno-54-24"></a>
<a id="__codelineno-54-25" name="__codelineno-54-25" href="#__codelineno-54-25"></a><span class="w">    </span><span class="c1"># Managed file count</span>
<a id="__codelineno-54-26" name="__codelineno-54-26" href="#__codelineno-54-26"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">managed_count</span><span class="o">=</span><span class="k">$(</span>chezmoi<span class="w"> </span>managed<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="k">)</span>
<a id="__codelineno-54-27" name="__codelineno-54-27" href="#__codelineno-54-27"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  Managed files: </span><span class="nv">$managed_count</span><span class="s2">&quot;</span>
<a id="__codelineno-54-28" name="__codelineno-54-28" href="#__codelineno-54-28"></a>
<a id="__codelineno-54-29" name="__codelineno-54-29" href="#__codelineno-54-29"></a><span class="w">    </span><span class="c1"># Quick git check</span>
<a id="__codelineno-54-30" name="__codelineno-54-30" href="#__codelineno-54-30"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">git_count</span><span class="o">=</span><span class="k">$(</span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.local/share/chezmoi&quot;</span><span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;dot_git&quot;</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="k">)</span>
<a id="__codelineno-54-31" name="__codelineno-54-31" href="#__codelineno-54-31"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span>git_count<span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-54-32" name="__codelineno-54-32" href="#__codelineno-54-32"></a><span class="w">        </span>_flow_log_warn<span class="w"> </span><span class="s2">&quot;  Found </span><span class="nv">$git_count</span><span class="s2"> tracked git directories&quot;</span>
<a id="__codelineno-54-33" name="__codelineno-54-33" href="#__codelineno-54-33"></a><span class="w">        </span>_flow_log_info<span class="w"> </span><span class="s2">&quot;  Fix with: dot ignore add &#39;**/.git&#39;&quot;</span>
<a id="__codelineno-54-34" name="__codelineno-54-34" href="#__codelineno-54-34"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-54-35" name="__codelineno-54-35" href="#__codelineno-54-35"></a><span class="k">fi</span>
</code></pre></div>
<h4 id="33-gitignore-integration">3.3 <code>.gitignore</code> Integration<a class="headerlink" href="#33-gitignore-integration" title="Permanent link">&para;</a></h4>
<p><strong>File:</strong> <code>lib/dotfile-helpers.zsh</code></p>
<p>Add intelligent pattern suggestion based on existing <code>.gitignore</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>_dot_suggest_from_gitignore<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">target</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">gitignore</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">/.gitignore&quot;</span>
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="w">    </span><span class="o">[[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$gitignore</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a>
<a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">suggestions</span><span class="o">=()</span>
<a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a>
<a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="w">    </span><span class="c1"># Parse .gitignore for common patterns</span>
<a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>pattern<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a><span class="w">        </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$pattern</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>^#<span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">continue</span>
<a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a><span class="w">        </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$pattern</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">continue</span>
<a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a><span class="w">        </span><span class="nv">suggestions</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$pattern</span><span class="s2">&quot;</span><span class="o">)</span>
<a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a><span class="w">    </span><span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$gitignore</span><span class="s2">&quot;</span>
<a id="__codelineno-55-15" name="__codelineno-55-15" href="#__codelineno-55-15"></a>
<a id="__codelineno-55-16" name="__codelineno-55-16" href="#__codelineno-55-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span><span class="si">${#</span><span class="nv">suggestions</span><span class="p">[@]</span><span class="si">}</span><span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-55-17" name="__codelineno-55-17" href="#__codelineno-55-17"></a><span class="w">        </span>_dot_info<span class="w"> </span><span class="s2">&quot;üí° Found .gitignore with </span><span class="si">${#</span><span class="nv">suggestions</span><span class="p">[@]</span><span class="si">}</span><span class="s2"> patterns&quot;</span>
<a id="__codelineno-55-18" name="__codelineno-55-18" href="#__codelineno-55-18"></a><span class="w">        </span><span class="nb">read</span><span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;REPLY?Import patterns to .chezmoiignore? (Y/n) &quot;</span>
<a id="__codelineno-55-19" name="__codelineno-55-19" href="#__codelineno-55-19"></a><span class="w">        </span><span class="nb">echo</span>
<a id="__codelineno-55-20" name="__codelineno-55-20" href="#__codelineno-55-20"></a>
<a id="__codelineno-55-21" name="__codelineno-55-21" href="#__codelineno-55-21"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$REPLY</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>^<span class="o">[</span>Yy<span class="o">]</span>$<span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="nv">$REPLY</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-55-22" name="__codelineno-55-22" href="#__codelineno-55-22"></a><span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">ignore_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.local/share/chezmoi/.chezmoiignore&quot;</span>
<a id="__codelineno-55-23" name="__codelineno-55-23" href="#__codelineno-55-23"></a><span class="w">            </span><span class="o">[[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>touch<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span>
<a id="__codelineno-55-24" name="__codelineno-55-24" href="#__codelineno-55-24"></a>
<a id="__codelineno-55-25" name="__codelineno-55-25" href="#__codelineno-55-25"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span>pattern<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">suggestions</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-55-26" name="__codelineno-55-26" href="#__codelineno-55-26"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>grep<span class="w"> </span>-qF<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$pattern</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-55-27" name="__codelineno-55-27" href="#__codelineno-55-27"></a><span class="w">                    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$pattern</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span>
<a id="__codelineno-55-28" name="__codelineno-55-28" href="#__codelineno-55-28"></a><span class="w">                </span><span class="k">fi</span>
<a id="__codelineno-55-29" name="__codelineno-55-29" href="#__codelineno-55-29"></a><span class="w">            </span><span class="k">done</span>
<a id="__codelineno-55-30" name="__codelineno-55-30" href="#__codelineno-55-30"></a><span class="w">            </span>_dot_success<span class="w"> </span><span class="s2">&quot;Imported </span><span class="si">${#</span><span class="nv">suggestions</span><span class="p">[@]</span><span class="si">}</span><span class="s2"> patterns from .gitignore&quot;</span>
<a id="__codelineno-55-31" name="__codelineno-55-31" href="#__codelineno-55-31"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-55-32" name="__codelineno-55-32" href="#__codelineno-55-32"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-55-33" name="__codelineno-55-33" href="#__codelineno-55-33"></a><span class="o">}</span>
<a id="__codelineno-55-34" name="__codelineno-55-34" href="#__codelineno-55-34"></a>
<a id="__codelineno-55-35" name="__codelineno-55-35" href="#__codelineno-55-35"></a><span class="c1"># Call from _dot_preview_add() after git detection</span>
</code></pre></div>
<h3 id="phase-4-testing-documentation-week-2-days-11-14">Phase 4: Testing &amp; Documentation (Week 2, Days 11-14)<a class="headerlink" href="#phase-4-testing-documentation-week-2-days-11-14" title="Permanent link">&para;</a></h3>
<p><strong>Effort:</strong> 4-5 hours
<strong>Dependencies:</strong> Phase 3 complete</p>
<h4 id="41-test-suite-creation">4.1 Test Suite Creation<a class="headerlink" href="#41-test-suite-creation" title="Permanent link">&para;</a></h4>
<p>Create comprehensive test file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="c1"># Create test file</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>touch<span class="w"> </span>tests/test-dot-chezmoi-safety.zsh
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>chmod<span class="w"> </span>+x<span class="w"> </span>tests/test-dot-chezmoi-safety.zsh
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="c1"># Add to tests/run-all.sh</span>
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;./tests/test-dot-chezmoi-safety.zsh || FAILED=\$((FAILED + 1))&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>tests/run-all.sh
</code></pre></div>
<p>See "Test Infrastructure" section above for complete test implementation.</p>
<p><strong>Testing:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="c1"># Run all tests</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>./tests/run-all.sh
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="c1"># Run just safety tests</span>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a>./tests/test-dot-chezmoi-safety.zsh
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a>
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="c1"># Expected: All tests pass</span>
</code></pre></div></p>
<h4 id="42-completions-documentation">4.2 Completions &amp; Documentation<a class="headerlink" href="#42-completions-documentation" title="Permanent link">&para;</a></h4>
<p><strong>Effort:</strong> 2-3 hours</p>
<h4 id="31-update-completions">3.1 Update Completions<a class="headerlink" href="#31-update-completions" title="Permanent link">&para;</a></h4>
<p><strong>File:</strong> <code>completions/_dot</code></p>
<p>Add completions for new commands:
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="c1"># After existing completions, add:</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="s1">&#39;ignore:manage ignore patterns:-&gt;ignore_cmd&#39;</span>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="k">case</span><span class="w"> </span><span class="nv">$state</span><span class="w"> </span><span class="k">in</span>
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="w">    </span>ignore_cmd<span class="o">)</span>
<a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="w">        </span><span class="nb">local</span><span class="w"> </span>-a<span class="w"> </span>ignore_cmds
<a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a><span class="w">        </span><span class="nv">ignore_cmds</span><span class="o">=(</span>
<a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a><span class="w">            </span><span class="s1">&#39;add:add ignore pattern&#39;</span>
<a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a><span class="w">            </span><span class="s1">&#39;list:list ignore patterns&#39;</span>
<a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a><span class="w">            </span><span class="s1">&#39;ls:list ignore patterns (alias)&#39;</span>
<a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a><span class="w">            </span><span class="s1">&#39;remove:remove ignore pattern&#39;</span>
<a id="__codelineno-58-12" name="__codelineno-58-12" href="#__codelineno-58-12"></a><span class="w">            </span><span class="s1">&#39;rm:remove ignore pattern (alias)&#39;</span>
<a id="__codelineno-58-13" name="__codelineno-58-13" href="#__codelineno-58-13"></a><span class="w">            </span><span class="s1">&#39;edit:edit .chezmoiignore file&#39;</span>
<a id="__codelineno-58-14" name="__codelineno-58-14" href="#__codelineno-58-14"></a><span class="w">        </span><span class="o">)</span>
<a id="__codelineno-58-15" name="__codelineno-58-15" href="#__codelineno-58-15"></a><span class="w">        </span>_describe<span class="w"> </span>-t<span class="w"> </span>commands<span class="w"> </span><span class="s1">&#39;ignore commands&#39;</span><span class="w"> </span>ignore_cmds
<a id="__codelineno-58-16" name="__codelineno-58-16" href="#__codelineno-58-16"></a><span class="w">        </span><span class="p">;;</span>
<a id="__codelineno-58-17" name="__codelineno-58-17" href="#__codelineno-58-17"></a><span class="k">esac</span>
</code></pre></div></p>
<h4 id="32-update-documentation">3.2 Update Documentation<a class="headerlink" href="#32-update-documentation" title="Permanent link">&para;</a></h4>
<p><strong>Files:</strong>
- <code>docs/specs/dot-dispatcher-refcard.md</code> - Add new commands
- <code>docs/specs/SPEC-dotfile-integration-2026-01-08.md</code> - Mark enhancements
- <code>README.md</code> - Update feature list</p>
<p><strong>Updates:</strong>
- Add <code>dot ignore</code> section with examples
- Add <code>dot size</code> to troubleshooting section
- Update <code>flow doctor</code> section
- Add FAQ: "How do I prevent tracking .git directories?"</p>
<hr />
<h2 id="testing-strategy">Testing Strategy<a class="headerlink" href="#testing-strategy" title="Permanent link">&para;</a></h2>
<h3 id="unit-tests">Unit Tests<a class="headerlink" href="#unit-tests" title="Permanent link">&para;</a></h3>
<p><strong>File:</strong> <code>tests/test-dot-chezmoi-safety.zsh</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="ch">#!/usr/bin/env zsh</span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="c1"># Test git directory detection</span>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a>test_git_detection<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">test_dir</span><span class="o">=</span><span class="s2">&quot;/tmp/test-dot-</span><span class="nv">$$</span><span class="s2">&quot;</span>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">/.git&quot;</span>
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a>
<a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">result</span><span class="o">=</span><span class="k">$(</span>_dot_check_git_in_path<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">&quot;</span><span class="k">)</span>
<a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a><span class="w">    </span><span class="o">[[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$result</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;‚úì Git detection works&quot;</span>
<a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a>
<a id="__codelineno-59-11" name="__codelineno-59-11" href="#__codelineno-59-11"></a><span class="w">    </span>rm<span class="w"> </span>-rf<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">&quot;</span>
<a id="__codelineno-59-12" name="__codelineno-59-12" href="#__codelineno-59-12"></a><span class="o">}</span>
<a id="__codelineno-59-13" name="__codelineno-59-13" href="#__codelineno-59-13"></a>
<a id="__codelineno-59-14" name="__codelineno-59-14" href="#__codelineno-59-14"></a><span class="c1"># Test ignore management</span>
<a id="__codelineno-59-15" name="__codelineno-59-15" href="#__codelineno-59-15"></a>test_ignore_management<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-59-16" name="__codelineno-59-16" href="#__codelineno-59-16"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">ignore_file</span><span class="o">=</span><span class="s2">&quot;/tmp/test-chezmoiignore-</span><span class="nv">$$</span><span class="s2">&quot;</span>
<a id="__codelineno-59-17" name="__codelineno-59-17" href="#__codelineno-59-17"></a><span class="w">    </span><span class="nv">HOME</span><span class="o">=</span><span class="s2">&quot;/tmp&quot;</span><span class="w"> </span>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;**/.git&quot;</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<a id="__codelineno-59-18" name="__codelineno-59-18" href="#__codelineno-59-18"></a>
<a id="__codelineno-59-19" name="__codelineno-59-19" href="#__codelineno-59-19"></a><span class="w">    </span><span class="o">[[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;.git&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;‚úì Ignore add works&quot;</span>
<a id="__codelineno-59-20" name="__codelineno-59-20" href="#__codelineno-59-20"></a>
<a id="__codelineno-59-21" name="__codelineno-59-21" href="#__codelineno-59-21"></a><span class="w">    </span>rm<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ignore_file</span><span class="s2">&quot;</span>
<a id="__codelineno-59-22" name="__codelineno-59-22" href="#__codelineno-59-22"></a><span class="o">}</span>
<a id="__codelineno-59-23" name="__codelineno-59-23" href="#__codelineno-59-23"></a>
<a id="__codelineno-59-24" name="__codelineno-59-24" href="#__codelineno-59-24"></a><span class="c1"># Test preview calculation</span>
<a id="__codelineno-59-25" name="__codelineno-59-25" href="#__codelineno-59-25"></a>test_preview_calculation<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-59-26" name="__codelineno-59-26" href="#__codelineno-59-26"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">test_dir</span><span class="o">=</span><span class="s2">&quot;/tmp/test-preview-</span><span class="nv">$$</span><span class="s2">&quot;</span>
<a id="__codelineno-59-27" name="__codelineno-59-27" href="#__codelineno-59-27"></a><span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">&quot;</span>
<a id="__codelineno-59-28" name="__codelineno-59-28" href="#__codelineno-59-28"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">/file1.txt&quot;</span>
<a id="__codelineno-59-29" name="__codelineno-59-29" href="#__codelineno-59-29"></a><span class="w">    </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/zero<span class="w"> </span><span class="nv">of</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">/large.bin&quot;</span><span class="w"> </span><span class="nv">bs</span><span class="o">=</span><span class="m">1024</span><span class="w"> </span><span class="nv">count</span><span class="o">=</span><span class="m">100</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null
<a id="__codelineno-59-30" name="__codelineno-59-30" href="#__codelineno-59-30"></a>
<a id="__codelineno-59-31" name="__codelineno-59-31" href="#__codelineno-59-31"></a><span class="w">    </span><span class="c1"># Mock preview (capture output)</span>
<a id="__codelineno-59-32" name="__codelineno-59-32" href="#__codelineno-59-32"></a><span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">output</span><span class="o">=</span><span class="k">$(</span>_dot_preview_add<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="k">)</span>
<a id="__codelineno-59-33" name="__codelineno-59-33" href="#__codelineno-59-33"></a>
<a id="__codelineno-59-34" name="__codelineno-59-34" href="#__codelineno-59-34"></a><span class="w">    </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$output</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>*<span class="s2">&quot;Files to add: 2&quot;</span>*<span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;‚úì Preview counts files&quot;</span>
<a id="__codelineno-59-35" name="__codelineno-59-35" href="#__codelineno-59-35"></a><span class="w">    </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$output</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>*<span class="s2">&quot;Large files detected&quot;</span>*<span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;‚úì Preview detects large files&quot;</span>
<a id="__codelineno-59-36" name="__codelineno-59-36" href="#__codelineno-59-36"></a>
<a id="__codelineno-59-37" name="__codelineno-59-37" href="#__codelineno-59-37"></a><span class="w">    </span>rm<span class="w"> </span>-rf<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_dir</span><span class="s2">&quot;</span>
<a id="__codelineno-59-38" name="__codelineno-59-38" href="#__codelineno-59-38"></a><span class="o">}</span>
<a id="__codelineno-59-39" name="__codelineno-59-39" href="#__codelineno-59-39"></a>
<a id="__codelineno-59-40" name="__codelineno-59-40" href="#__codelineno-59-40"></a><span class="c1"># Run tests</span>
<a id="__codelineno-59-41" name="__codelineno-59-41" href="#__codelineno-59-41"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running dot chezmoi safety tests...&quot;</span>
<a id="__codelineno-59-42" name="__codelineno-59-42" href="#__codelineno-59-42"></a>test_git_detection
<a id="__codelineno-59-43" name="__codelineno-59-43" href="#__codelineno-59-43"></a>test_ignore_management
<a id="__codelineno-59-44" name="__codelineno-59-44" href="#__codelineno-59-44"></a>test_preview_calculation
<a id="__codelineno-59-45" name="__codelineno-59-45" href="#__codelineno-59-45"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Tests complete&quot;</span>
</code></pre></div>
<h3 id="integration-tests">Integration Tests<a class="headerlink" href="#integration-tests" title="Permanent link">&para;</a></h3>
<p><strong>Scenarios:</strong>
1. Add directory with .git ‚Üí Verify warning and ignore prompt
2. Add directory with .log files ‚Üí Verify suggestion
3. Run <code>dot size</code> ‚Üí Verify output format
4. Run <code>flow doctor</code> ‚Üí Verify chezmoi section included
5. Use <code>dot ignore add/list/remove</code> ‚Üí Verify file modified correctly</p>
<h3 id="manual-test-checklist">Manual Test Checklist<a class="headerlink" href="#manual-test-checklist" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="gu">## Pre-flight</span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="k">- [ ]</span> Backup ~/.local/share/chezmoi
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="k">- [ ]</span> Backup ~/.config/nvim
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a>
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="gu">## Git Detection</span>
<a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a><span class="k">- [ ]</span> Create test dir with .git
<a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a><span class="k">- [ ]</span> Run <span class="sb">`dot add &lt;dir&gt;`</span>
<a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a><span class="k">- [ ]</span> Verify warning shown
<a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a><span class="k">- [ ]</span> Accept auto-ignore
<a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a><span class="k">- [ ]</span> Verify .chezmoiignore updated
<a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a><span class="k">- [ ]</span> Verify <span class="sb">`chezmoi managed`</span> doesn&#39;t list .git files
<a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a>
<a id="__codelineno-60-13" name="__codelineno-60-13" href="#__codelineno-60-13"></a><span class="gu">## Preview Functionality</span>
<a id="__codelineno-60-14" name="__codelineno-60-14" href="#__codelineno-60-14"></a><span class="k">- [ ]</span> Create dir with mix of files (small, large, .log, .sqlite)
<a id="__codelineno-60-15" name="__codelineno-60-15" href="#__codelineno-60-15"></a><span class="k">- [ ]</span> Run <span class="sb">`dot add &lt;dir&gt;`</span>
<a id="__codelineno-60-16" name="__codelineno-60-16" href="#__codelineno-60-16"></a><span class="k">- [ ]</span> Verify file count shown
<a id="__codelineno-60-17" name="__codelineno-60-17" href="#__codelineno-60-17"></a><span class="k">- [ ]</span> Verify size calculated
<a id="__codelineno-60-18" name="__codelineno-60-18" href="#__codelineno-60-18"></a><span class="k">- [ ]</span> Verify warnings for large/.log/.sqlite
<a id="__codelineno-60-19" name="__codelineno-60-19" href="#__codelineno-60-19"></a><span class="k">- [ ]</span> Accept auto-ignore suggestions
<a id="__codelineno-60-20" name="__codelineno-60-20" href="#__codelineno-60-20"></a><span class="k">- [ ]</span> Verify correct files added
<a id="__codelineno-60-21" name="__codelineno-60-21" href="#__codelineno-60-21"></a>
<a id="__codelineno-60-22" name="__codelineno-60-22" href="#__codelineno-60-22"></a><span class="gu">## Ignore Management</span>
<a id="__codelineno-60-23" name="__codelineno-60-23" href="#__codelineno-60-23"></a><span class="k">- [ ]</span> Run <span class="sb">`dot ignore add &quot;*.log&quot;`</span>
<a id="__codelineno-60-24" name="__codelineno-60-24" href="#__codelineno-60-24"></a><span class="k">- [ ]</span> Run <span class="sb">`dot ignore list`</span> - verify shown
<a id="__codelineno-60-25" name="__codelineno-60-25" href="#__codelineno-60-25"></a><span class="k">- [ ]</span> Run <span class="sb">`dot ignore remove &quot;*.log&quot;`</span>
<a id="__codelineno-60-26" name="__codelineno-60-26" href="#__codelineno-60-26"></a><span class="k">- [ ]</span> Run <span class="sb">`dot ignore list`</span> - verify removed
<a id="__codelineno-60-27" name="__codelineno-60-27" href="#__codelineno-60-27"></a><span class="k">- [ ]</span> Run <span class="sb">`dot ignore edit`</span> - verify opens editor
<a id="__codelineno-60-28" name="__codelineno-60-28" href="#__codelineno-60-28"></a>
<a id="__codelineno-60-29" name="__codelineno-60-29" href="#__codelineno-60-29"></a><span class="gu">## Size Analysis</span>
<a id="__codelineno-60-30" name="__codelineno-60-30" href="#__codelineno-60-30"></a><span class="k">- [ ]</span> Run <span class="sb">`dot size`</span>
<a id="__codelineno-60-31" name="__codelineno-60-31" href="#__codelineno-60-31"></a><span class="k">- [ ]</span> Verify total size shown
<a id="__codelineno-60-32" name="__codelineno-60-32" href="#__codelineno-60-32"></a><span class="k">- [ ]</span> Verify top 10 files listed
<a id="__codelineno-60-33" name="__codelineno-60-33" href="#__codelineno-60-33"></a><span class="k">- [ ]</span> Verify .git warning if present
<a id="__codelineno-60-34" name="__codelineno-60-34" href="#__codelineno-60-34"></a><span class="k">- [ ]</span> Verify large file count if present
<a id="__codelineno-60-35" name="__codelineno-60-35" href="#__codelineno-60-35"></a>
<a id="__codelineno-60-36" name="__codelineno-60-36" href="#__codelineno-60-36"></a><span class="gu">## Doctor Integration</span>
<a id="__codelineno-60-37" name="__codelineno-60-37" href="#__codelineno-60-37"></a><span class="k">- [ ]</span> Run <span class="sb">`flow doctor`</span>
<a id="__codelineno-60-38" name="__codelineno-60-38" href="#__codelineno-60-38"></a><span class="k">- [ ]</span> Verify &quot;Dotfile Management&quot; section present
<a id="__codelineno-60-39" name="__codelineno-60-39" href="#__codelineno-60-39"></a><span class="k">- [ ]</span> Verify checks: installed, initialized, remote, .chezmoiignore, files managed, size, large files, .git dirs, sync status
<a id="__codelineno-60-40" name="__codelineno-60-40" href="#__codelineno-60-40"></a><span class="k">- [ ]</span> Verify actionable recommendations shown
<a id="__codelineno-60-41" name="__codelineno-60-41" href="#__codelineno-60-41"></a>
<a id="__codelineno-60-42" name="__codelineno-60-42" href="#__codelineno-60-42"></a><span class="gu">## Performance</span>
<a id="__codelineno-60-43" name="__codelineno-60-43" href="#__codelineno-60-43"></a><span class="k">- [ ]</span> Time <span class="sb">`dot add &lt;large-dir&gt;`</span> - verify &lt; 2s
<a id="__codelineno-60-44" name="__codelineno-60-44" href="#__codelineno-60-44"></a><span class="k">- [ ]</span> Time <span class="sb">`dot ignore list`</span> - verify &lt; 0.5s
<a id="__codelineno-60-45" name="__codelineno-60-45" href="#__codelineno-60-45"></a><span class="k">- [ ]</span> Time <span class="sb">`dot size`</span> - verify &lt; 3s
<a id="__codelineno-60-46" name="__codelineno-60-46" href="#__codelineno-60-46"></a><span class="k">- [ ]</span> Time <span class="sb">`flow doctor`</span> chezmoi section - verify &lt; 2s
<a id="__codelineno-60-47" name="__codelineno-60-47" href="#__codelineno-60-47"></a>
<a id="__codelineno-60-48" name="__codelineno-60-48" href="#__codelineno-60-48"></a><span class="gu">## Edge Cases</span>
<a id="__codelineno-60-49" name="__codelineno-60-49" href="#__codelineno-60-49"></a><span class="k">- [ ]</span> Run <span class="sb">`dot add`</span> on non-existent path - verify error
<a id="__codelineno-60-50" name="__codelineno-60-50" href="#__codelineno-60-50"></a><span class="k">- [ ]</span> Run <span class="sb">`dot ignore remove`</span> on non-existent pattern - verify error
<a id="__codelineno-60-51" name="__codelineno-60-51" href="#__codelineno-60-51"></a><span class="k">- [ ]</span> Run <span class="sb">`dot size`</span> with no chezmoi repo - verify error
<a id="__codelineno-60-52" name="__codelineno-60-52" href="#__codelineno-60-52"></a><span class="k">- [ ]</span> Run with empty .chezmoiignore - verify works
<a id="__codelineno-60-53" name="__codelineno-60-53" href="#__codelineno-60-53"></a><span class="k">- [ ]</span> Run with missing .chezmoiignore - verify creates
</code></pre></div>
<hr />
<h2 id="documentation-updates">Documentation Updates<a class="headerlink" href="#documentation-updates" title="Permanent link">&para;</a></h2>
<h3 id="quick-reference-card">Quick Reference Card<a class="headerlink" href="#quick-reference-card" title="Permanent link">&para;</a></h3>
<p><strong>File:</strong> <code>docs/specs/dot-dispatcher-refcard.md</code></p>
<p>Add sections:
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="gu">## Ignore Pattern Management</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>| Command | Action |
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a>|---------|--------|
<a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a>| <span class="sb">`dot ignore add &lt;pattern&gt;`</span> | Add ignore pattern |
<a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a>| <span class="sb">`dot ignore list`</span> | List all patterns |
<a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a>| <span class="sb">`dot ignore remove &lt;pattern&gt;`</span> | Remove pattern |
<a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a>| <span class="sb">`dot ignore edit`</span> | Edit .chezmoiignore |
<a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a>
<a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a><span class="gu">## Repository Health</span>
<a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a>
<a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a>| Command | Action |
<a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a>|---------|--------|
<a id="__codelineno-61-14" name="__codelineno-61-14" href="#__codelineno-61-14"></a>| <span class="sb">`dot size`</span> | Analyze repository size |
<a id="__codelineno-61-15" name="__codelineno-61-15" href="#__codelineno-61-15"></a>| <span class="sb">`flow doctor`</span> | Health checks (includes chezmoi) |
<a id="__codelineno-61-16" name="__codelineno-61-16" href="#__codelineno-61-16"></a>
<a id="__codelineno-61-17" name="__codelineno-61-17" href="#__codelineno-61-17"></a><span class="gu">## Safety Features</span>
<a id="__codelineno-61-18" name="__codelineno-61-18" href="#__codelineno-61-18"></a>
<a id="__codelineno-61-19" name="__codelineno-61-19" href="#__codelineno-61-19"></a><span class="k">-</span><span class="w"> </span><span class="gs">**Git detection**</span>: Warns when adding .git directories
<a id="__codelineno-61-20" name="__codelineno-61-20" href="#__codelineno-61-20"></a><span class="k">-</span><span class="w"> </span><span class="gs">**Preview**</span>: Shows file count/size before adding
<a id="__codelineno-61-21" name="__codelineno-61-21" href="#__codelineno-61-21"></a><span class="k">-</span><span class="w"> </span><span class="gs">**Auto-suggestions**</span>: Intelligent ignore pattern suggestions
<a id="__codelineno-61-22" name="__codelineno-61-22" href="#__codelineno-61-22"></a><span class="k">-</span><span class="w"> </span><span class="gs">**Large file warnings**</span>: Alerts for files &gt;50KB
</code></pre></div></p>
<h3 id="help-text">Help Text<a class="headerlink" href="#help-text" title="Permanent link">&para;</a></h3>
<p>Update <code>dot</code> help command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="s2">&quot;help&quot;</span><span class="p">|</span><span class="s2">&quot;h&quot;</span><span class="p">|</span><span class="s2">&quot;-h&quot;</span><span class="p">|</span><span class="s2">&quot;--help&quot;</span><span class="o">)</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="w">    </span>_dot_header<span class="w"> </span><span class="s2">&quot;Dotfile Management (dot)&quot;</span>
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: dot &lt;command&gt; [args]&quot;</span>
<a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Status &amp; Info:&quot;</span>
<a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  status, s          Show sync status and quick actions&quot;</span>
<a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  help, h            Show this help&quot;</span>
<a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;File Management:&quot;</span>
<a id="__codelineno-62-11" name="__codelineno-62-11" href="#__codelineno-62-11"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  add &lt;file&gt;         Add file to chezmoi (with preview)&quot;</span>
<a id="__codelineno-62-12" name="__codelineno-62-12" href="#__codelineno-62-12"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  edit &lt;file&gt;        Edit dotfile with auto-apply&quot;</span>
<a id="__codelineno-62-13" name="__codelineno-62-13" href="#__codelineno-62-13"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  diff, d            Show pending changes&quot;</span>
<a id="__codelineno-62-14" name="__codelineno-62-14" href="#__codelineno-62-14"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  apply              Apply changes with backup&quot;</span>
<a id="__codelineno-62-15" name="__codelineno-62-15" href="#__codelineno-62-15"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-62-16" name="__codelineno-62-16" href="#__codelineno-62-16"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Sync Operations:&quot;</span>
<a id="__codelineno-62-17" name="__codelineno-62-17" href="#__codelineno-62-17"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  sync, pull         Pull from remote with preview&quot;</span>
<a id="__codelineno-62-18" name="__codelineno-62-18" href="#__codelineno-62-18"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  push, p            Push to remote&quot;</span>
<a id="__codelineno-62-19" name="__codelineno-62-19" href="#__codelineno-62-19"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-62-20" name="__codelineno-62-20" href="#__codelineno-62-20"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Ignore Patterns:&quot;</span>
<a id="__codelineno-62-21" name="__codelineno-62-21" href="#__codelineno-62-21"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  ignore add &lt;pat&gt;   Add ignore pattern&quot;</span>
<a id="__codelineno-62-22" name="__codelineno-62-22" href="#__codelineno-62-22"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  ignore list        List all patterns&quot;</span>
<a id="__codelineno-62-23" name="__codelineno-62-23" href="#__codelineno-62-23"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  ignore remove &lt;pat&gt; Remove pattern&quot;</span>
<a id="__codelineno-62-24" name="__codelineno-62-24" href="#__codelineno-62-24"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  ignore edit        Edit .chezmoiignore&quot;</span>
<a id="__codelineno-62-25" name="__codelineno-62-25" href="#__codelineno-62-25"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-62-26" name="__codelineno-62-26" href="#__codelineno-62-26"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Repository Health:&quot;</span>
<a id="__codelineno-62-27" name="__codelineno-62-27" href="#__codelineno-62-27"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  size               Analyze repository size&quot;</span>
<a id="__codelineno-62-28" name="__codelineno-62-28" href="#__codelineno-62-28"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-62-29" name="__codelineno-62-29" href="#__codelineno-62-29"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Secrets:&quot;</span>
<a id="__codelineno-62-30" name="__codelineno-62-30" href="#__codelineno-62-30"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  secret &lt;name&gt;      Retrieve secret&quot;</span>
<a id="__codelineno-62-31" name="__codelineno-62-31" href="#__codelineno-62-31"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  token &lt;type&gt;       Manage API tokens&quot;</span>
<a id="__codelineno-62-32" name="__codelineno-62-32" href="#__codelineno-62-32"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-62-33" name="__codelineno-62-33" href="#__codelineno-62-33"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Troubleshooting:&quot;</span>
<a id="__codelineno-62-34" name="__codelineno-62-34" href="#__codelineno-62-34"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  doctor             Health checks (via &#39;flow doctor&#39;)&quot;</span>
<a id="__codelineno-62-35" name="__codelineno-62-35" href="#__codelineno-62-35"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  undo               Undo last apply&quot;</span>
<a id="__codelineno-62-36" name="__codelineno-62-36" href="#__codelineno-62-36"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-62-37" name="__codelineno-62-37" href="#__codelineno-62-37"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Options:&quot;</span>
<a id="__codelineno-62-38" name="__codelineno-62-38" href="#__codelineno-62-38"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  --no-preview       Skip preview on add&quot;</span>
<a id="__codelineno-62-39" name="__codelineno-62-39" href="#__codelineno-62-39"></a><span class="w">    </span><span class="nb">echo</span>
<a id="__codelineno-62-40" name="__codelineno-62-40" href="#__codelineno-62-40"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Examples:&quot;</span>
<a id="__codelineno-62-41" name="__codelineno-62-41" href="#__codelineno-62-41"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  dot add ~/.zshrc&quot;</span>
<a id="__codelineno-62-42" name="__codelineno-62-42" href="#__codelineno-62-42"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  dot ignore add &#39;**/.git&#39;&quot;</span>
<a id="__codelineno-62-43" name="__codelineno-62-43" href="#__codelineno-62-43"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  dot size&quot;</span>
<a id="__codelineno-62-44" name="__codelineno-62-44" href="#__codelineno-62-44"></a><span class="w">    </span><span class="p">;;</span>
</code></pre></div>
<hr />
<h2 id="success-criteria">Success Criteria<a class="headerlink" href="#success-criteria" title="Permanent link">&para;</a></h2>
<h3 id="functional-requirements">Functional Requirements<a class="headerlink" href="#functional-requirements" title="Permanent link">&para;</a></h3>
<ul>
<li>[x] Git directory detection warns before adding</li>
<li>[x] Auto-creates ignore patterns on user confirmation</li>
<li>[x] Preview shows file count, size, warnings</li>
<li>[x] Auto-suggests ignore patterns for .log/.sqlite/.db/.cache</li>
<li>[x] <code>dot ignore</code> manages patterns without manual editing</li>
<li>[x] <code>dot size</code> reports repository size and identifies bloat</li>
<li>[x] <code>flow doctor</code> includes comprehensive chezmoi health checks</li>
<li>[x] All operations complete within performance targets</li>
</ul>
<h3 id="non-functional-requirements">Non-Functional Requirements<a class="headerlink" href="#non-functional-requirements" title="Permanent link">&para;</a></h3>
<ul>
<li>[x] Maintains existing <code>dot</code> command behavior (backward compatible)</li>
<li>[x] No breaking changes to existing workflows</li>
<li>[x] Preserves &lt; 3s performance target for all commands</li>
<li>[x] Clear, actionable error messages</li>
<li>[x] ADHD-friendly output (scannable, hierarchical)</li>
</ul>
<h3 id="user-experience">User Experience<a class="headerlink" href="#user-experience" title="Permanent link">&para;</a></h3>
<ul>
<li>[x] No false positives in git detection</li>
<li>[x] Confirmation prompts respect muscle memory (Y default)</li>
<li>[x] Preview can be skipped with --no-preview flag</li>
<li>[x] Help text includes all new commands</li>
<li>[x] Completions work for all new commands</li>
</ul>
<hr />
<h2 id="rollback-plan">Rollback Plan<a class="headerlink" href="#rollback-plan" title="Permanent link">&para;</a></h2>
<p>If issues arise:</p>
<ol>
<li>
<p><strong>Backup restoration:</strong>
   <div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="c1"># Restore chezmoi repo</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="nb">cd</span><span class="w"> </span>~/.local/share/chezmoi
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>git<span class="w"> </span>reset<span class="w"> </span>--hard<span class="w"> </span>&lt;commit-before-changes&gt;
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a>
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="c1"># Restore flow-cli</span>
<a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="nb">cd</span><span class="w"> </span>~/projects/dev-tools/flow-cli
<a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a>git<span class="w"> </span>checkout<span class="w"> </span>&lt;previous-version-tag&gt;
</code></pre></div></p>
</li>
<li>
<p><strong>Feature flags:</strong></p>
</li>
<li>Add <code>FLOW_DOT_PREVIEW_ENABLED</code> env var (default: true)</li>
<li>Add <code>FLOW_DOT_GIT_CHECK_ENABLED</code> env var (default: true)</li>
<li>
<p>Users can disable with <code>export FLOW_DOT_PREVIEW_ENABLED=false</code></p>
</li>
<li>
<p><strong>Gradual rollout:</strong></p>
</li>
<li>Phase 1: Git detection only</li>
<li>Phase 2: Add preview (opt-in with --preview flag)</li>
<li>Phase 3: Make preview default (opt-out with --no-preview)</li>
</ol>
<hr />
<h2 id="frequently-asked-questions-faq">Frequently Asked Questions (FAQ)<a class="headerlink" href="#frequently-asked-questions-faq" title="Permanent link">&para;</a></h2>
<h3 id="general-questions">General Questions<a class="headerlink" href="#general-questions" title="Permanent link">&para;</a></h3>
<p><strong>Q: Will this delete my .git directories?</strong></p>
<p>A: No. The safety features only prevent chezmoi from tracking .git directories. Your actual .git directories in <code>~/.config</code> or elsewhere remain untouched.</p>
<p><strong>Q: Can I bypass the preview if I'm in a hurry?</strong></p>
<p>A: Yes. Use the <code>--no-preview</code> flag:
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>dot<span class="w"> </span>add<span class="w"> </span>~/.config/nvim<span class="w"> </span>--no-preview
</code></pre></div></p>
<p><strong>Q: What if I accidentally added .git files before this update?</strong></p>
<p>A: Follow the Migration Guide section above. In summary:
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="c1"># 1. Add ignore patterns</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>dot<span class="w"> </span>ignore<span class="w"> </span>add<span class="w"> </span><span class="s2">&quot;**/.git&quot;</span>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a>
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="c1"># 2. Remove tracked files</span>
<a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a>chezmoi<span class="w"> </span>forget<span class="w"> </span><span class="s1">&#39;.config/nvim/.git&#39;</span>
<a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a>
<a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="c1"># 3. Verify</span>
<a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a>dot<span class="w"> </span>size
</code></pre></div></p>
<p><strong>Q: How do I know if I have .git directories tracked?</strong></p>
<p>A: Run the new size analysis command:
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>dot<span class="w"> </span>size
</code></pre></div></p>
<p>Look for warnings about git directories. Or check manually:
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="nb">cd</span><span class="w"> </span>~/.local/share/chezmoi
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>find<span class="w"> </span>.<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;dot_git&quot;</span><span class="w"> </span>-type<span class="w"> </span>d
</code></pre></div></p>
<p><strong>Q: Will this slow down my workflow?</strong></p>
<p>A: No. Performance targets ensure all operations complete within 2-3 seconds. Preview adds &lt; 1s overhead for most directories.</p>
<p><strong>Q: Can I customize which patterns trigger warnings?</strong></p>
<p>A: Not in this release. Common patterns (.log, .sqlite, .db, .cache, .git) are hard-coded. Future releases may add configuration.</p>
<p><strong>Q: Does this work on Linux?</strong></p>
<p>A: Yes. The spec includes cross-platform compatibility for BSD (macOS) and GNU (Linux) commands.</p>
<h3 id="technical-questions">Technical Questions<a class="headerlink" href="#technical-questions" title="Permanent link">&para;</a></h3>
<p><strong>Q: How does git detection work?</strong></p>
<p>A: It uses <code>find</code> to search for <code>.git</code> directories with a 2-second timeout. For large directories, it warns users first. If the target is a git repo, it can optionally use <code>git ls-files</code> for faster scanning.</p>
<p><strong>Q: What if <code>find</code> times out?</strong></p>
<p>A: The timeout prevents hanging on very large directories (10,000+ files). If timeout occurs, you'll see a warning but the add operation continues. You can manually check with <code>dot size</code> later.</p>
<p><strong>Q: How often is the size cache refreshed?</strong></p>
<p>A: Cache TTL is 5 minutes. After 5 minutes, the next <code>dot size</code> or <code>dot status</code> command will recalculate.</p>
<p><strong>Q: Can I disable the safety features?</strong></p>
<p>A: Not currently. If needed, you can bypass preview with <code>--no-preview</code>. Future releases may add <code>FLOW_DOT_PREVIEW_ENABLED=false</code> environment variable.</p>
<p><strong>Q: What if chezmoi is not installed?</strong></p>
<p>A: Commands will fail gracefully with helpful error messages suggesting <code>brew install chezmoi</code>.</p>
<h3 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h3>
<p><strong>Q: <code>dot size</code> shows "command not found: numfmt"</strong></p>
<p>A: The spec includes a fallback manual conversion. This is expected on systems without GNU coreutils. Sizes will be shown as "1 MB" instead of "1.0 MB".</p>
<p><strong>Q: Ignore patterns aren't working</strong></p>
<p>A: Verify patterns are in <code>.chezmoiignore</code>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>dot<span class="w"> </span>ignore<span class="w"> </span>list
</code></pre></div></p>
<p>Test if pattern matches:
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="nb">cd</span><span class="w"> </span>~/.local/share/chezmoi
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>chezmoi<span class="w"> </span>ignored<span class="w"> </span>~/.config/nvim/.git
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="c1"># Should output: true</span>
</code></pre></div></p>
<p><strong>Q: Preview shows wrong file count</strong></p>
<p>A: Preview is point-in-time. Files may be added/removed between preview and actual add. This is documented as expected behavior.</p>
<p><strong>Q: Large file warnings are annoying</strong></p>
<p>A: You can bypass preview for single operations with <code>--no-preview</code>. For permanent changes, future releases may add configuration.</p>
<hr />
<h2 id="future-enhancements-out-of-scope">Future Enhancements (Out of Scope)<a class="headerlink" href="#future-enhancements-out-of-scope" title="Permanent link">&para;</a></h2>
<h3 id="phase-4-candidates">Phase 4 Candidates<a class="headerlink" href="#phase-4-candidates" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Conflict resolution UI</strong> - Interactive 3-way merge for chezmoi conflicts</li>
<li><strong>Template validation</strong> - Check chezmoi templates for syntax errors</li>
<li><strong>Backup history</strong> - Show last N backups, restore from backup</li>
<li><strong>Multi-machine sync status</strong> - Show which machines are ahead/behind</li>
<li><strong>Secret rotation reminders</strong> - Warn when tokens/secrets are old</li>
</ol>
<h3 id="integration-opportunities">Integration Opportunities<a class="headerlink" href="#integration-opportunities" title="Permanent link">&para;</a></h3>
<ol>
<li><strong><code>work</code> command</strong> - Auto-sync dotfiles on session start</li>
<li><strong>Dashboard</strong> - Show dotfile health score</li>
<li><strong>Plugin system</strong> - Allow custom ignore pattern rules</li>
</ol>
<hr />
<h2 id="appendix">Appendix<a class="headerlink" href="#appendix" title="Permanent link">&para;</a></h2>
<h3 id="example-outputs">Example Outputs<a class="headerlink" href="#example-outputs" title="Permanent link">&para;</a></h3>
<h4 id="dot-add-with-git-detection"><code>dot add</code> with git detection<a class="headerlink" href="#dot-add-with-git-detection" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>$ dot add ~/.config/ghostty
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a>
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a>‚ö†Ô∏è  Git directory detected in /Users/dt/.config/ghostty
<a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a>    Git metadata should not be tracked by chezmoi.
<a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a>
<a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a>Auto-create ignore rule? (Y/n): y
<a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a>‚úì Added .config/ghostty/.git to .chezmoiignore
<a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a>‚úì Added .config/ghostty/.git/** to .chezmoiignore
<a id="__codelineno-70-9" name="__codelineno-70-9" href="#__codelineno-70-9"></a>
<a id="__codelineno-70-10" name="__codelineno-70-10" href="#__codelineno-70-10"></a>Preview: dot add /Users/dt/.config/ghostty
<a id="__codelineno-70-11" name="__codelineno-70-11" href="#__codelineno-70-11"></a>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
<a id="__codelineno-70-12" name="__codelineno-70-12" href="#__codelineno-70-12"></a>Files to add: 12
<a id="__codelineno-70-13" name="__codelineno-70-13" href="#__codelineno-70-13"></a>Total size: 24 KB
<a id="__codelineno-70-14" name="__codelineno-70-14" href="#__codelineno-70-14"></a>
<a id="__codelineno-70-15" name="__codelineno-70-15" href="#__codelineno-70-15"></a>Proceed with add? (Y/n): y
<a id="__codelineno-70-16" name="__codelineno-70-16" href="#__codelineno-70-16"></a>‚úì Added /Users/dt/.config/ghostty to chezmoi
</code></pre></div>
<h4 id="dot-size-output"><code>dot size</code> output<a class="headerlink" href="#dot-size-output" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>$ dot size
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>Chezmoi Repository Size
<a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
<a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a>Total: 1.2 MB
<a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a>
<a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a>Top 10 largest files:
<a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a>      7.4 KB  dot_config/wezterm/wezterm.lua
<a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a>      6.9 KB  dot_config/CLAUDE.md
<a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a>      6.3 KB  dot_config/nvim/lazy-lock.json
<a id="__codelineno-71-11" name="__codelineno-71-11" href="#__codelineno-71-11"></a>      3.4 KB  dot_config/starship.toml
<a id="__codelineno-71-12" name="__codelineno-71-12" href="#__codelineno-71-12"></a>      3.1 KB  dot_config/GEMINI.md
<a id="__codelineno-71-13" name="__codelineno-71-13" href="#__codelineno-71-13"></a>      1.4 KB  dot_config/nvim/lazyvim.json
<a id="__codelineno-71-14" name="__codelineno-71-14" href="#__codelineno-71-14"></a>      1.2 KB  dot_config/ghostty/config
<a id="__codelineno-71-15" name="__codelineno-71-15" href="#__codelineno-71-15"></a>      0.8 KB  dot_config/git/ignore
<a id="__codelineno-71-16" name="__codelineno-71-16" href="#__codelineno-71-16"></a>      0.5 KB  dot_config/git/gitk
<a id="__codelineno-71-17" name="__codelineno-71-17" href="#__codelineno-71-17"></a>      0.4 KB  dot_zshrc
<a id="__codelineno-71-18" name="__codelineno-71-18" href="#__codelineno-71-18"></a>
<a id="__codelineno-71-19" name="__codelineno-71-19" href="#__codelineno-71-19"></a>‚úì No nested git directories tracked
</code></pre></div>
<h4 id="flow-doctor-with-chezmoi-checks"><code>flow doctor</code> with chezmoi checks<a class="headerlink" href="#flow-doctor-with-chezmoi-checks" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a>$ flow doctor
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a>
<a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a>System Health Check
<a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
<a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a>
<a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a>... (existing checks) ...
<a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a>
<a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a>Dotfile Management:
<a id="__codelineno-72-9" name="__codelineno-72-9" href="#__codelineno-72-9"></a>  ‚úì chezmoi installed (v2.69.3)
<a id="__codelineno-72-10" name="__codelineno-72-10" href="#__codelineno-72-10"></a>  ‚úì Repository initialized
<a id="__codelineno-72-11" name="__codelineno-72-11" href="#__codelineno-72-11"></a>  ‚úì Connected to remote (github.com/data-wise/dotfiles)
<a id="__codelineno-72-12" name="__codelineno-72-12" href="#__codelineno-72-12"></a>  ‚úì .chezmoiignore configured (5 patterns)
<a id="__codelineno-72-13" name="__codelineno-72-13" href="#__codelineno-72-13"></a>  ‚úì 47 files managed
<a id="__codelineno-72-14" name="__codelineno-72-14" href="#__codelineno-72-14"></a>  ‚úì Repository size: 1.2 MB (healthy)
<a id="__codelineno-72-15" name="__codelineno-72-15" href="#__codelineno-72-15"></a>  ‚úì No large files tracked
<a id="__codelineno-72-16" name="__codelineno-72-16" href="#__codelineno-72-16"></a>  ‚úì No nested git directories tracked
<a id="__codelineno-72-17" name="__codelineno-72-17" href="#__codelineno-72-17"></a>  ‚úì Last sync: 2 hours ago (synced)
</code></pre></div>
<hr />
<p><strong>End of Specification</strong></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 DT. Released under MIT License.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/data-wise/flow-cli" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.code.copy", "content.action.edit"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>