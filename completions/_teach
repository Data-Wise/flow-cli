#compdef teach

# Completion for teach command - teaching workflow dispatcher
# Includes Scholar wrapper commands for AI-assisted content generation

_teach() {
  local -a subcommands
  local -a scholar_flags
  local -a formats

  # All subcommands (Scholar wrappers + local commands)
  subcommands=(
    # Scholar wrapper commands (invoke Claude + Scholar plugin)
    'exam:Generate exam questions via Scholar'
    'e:Generate exam (alias)'
    'quiz:Generate quiz questions via Scholar'
    'q:Generate quiz (alias)'
    'slides:Generate presentation slides via Scholar'
    'sl:Generate slides (alias)'
    'lecture:Generate lecture notes via Scholar'
    'lec:Generate lecture (alias)'
    'assignment:Generate homework assignment via Scholar'
    'hw:Generate assignment (alias)'
    'syllabus:Generate course syllabus via Scholar'
    'syl:Generate syllabus (alias)'
    'rubric:Generate grading rubric via Scholar'
    'rb:Generate rubric (alias)'
    'feedback:Generate student feedback via Scholar'
    'fb:Generate feedback (alias)'
    'demo:Create demo course materials via Scholar'
    # Local commands (no Claude needed)
    'init:Initialize teaching workflow'
    'i:Initialize (alias)'
    'deploy:Deploy draft â†’ production branch'
    'd:Deploy (alias)'
    'archive:Archive semester and create tag'
    'a:Archive (alias)'
    'config:Edit .flow/teach-config.yml'
    'c:Config (alias)'
    'status:Show teaching project status'
    's:Status (alias)'
    'week:Show current week number'
    'w:Week (alias)'
    'help:Show help message'
    # Template management (v5.20.0)
    'templates:Manage content templates'
    'tmpl:Templates (alias)'
    'tpl:Templates (alias)'
    # LaTeX macro management (v5.21.0)
    'macros:Manage LaTeX macros'
    'macro:Macros (alias)'
    'm:Macros (alias)'
    # Lesson plan management (v5.22.0)
    'plan:Manage lesson plan weeks'
    'pl:Plan (alias)'
  )

  # Universal flags for Scholar commands (v5.13.0+ with Phases 1-6)
  scholar_flags=(
    # Selection flags
    '--topic[Explicit topic (bypasses lesson plan)]:topic:'
    '-t[Explicit topic (short form)]:topic:'
    '--week[Week number (uses lesson plan if exists)]:week:'
    '-w[Week number (short form)]:week:'
    '--style[Content style preset]:style:(conceptual computational rigorous applied)'

    # Content flags (positive)
    '--explanation[Include conceptual explanations]'
    '-e[Include explanations (short form)]'
    '--definitions[Include formal definitions]'
    '--proof[Include mathematical proofs]'
    '--math[Include mathematical notation]'
    '-m[Include math (short form)]'
    '--examples[Include numerical examples]'
    '-x[Include examples (short form)]'
    '--code[Include code snippets]'
    '-c[Include code (short form)]'
    '--diagrams[Include diagrams/visualizations]'
    '-d[Include diagrams (short form)]'
    '--practice-problems[Include practice problems]'
    '-p[Include practice (short form)]'
    '--references[Include citations/references]'
    '-r[Include references (short form)]'

    # Content flags (negation)
    '--no-explanation[Exclude conceptual explanations]'
    '--no-definitions[Exclude formal definitions]'
    '--no-proof[Exclude mathematical proofs]'
    '--no-math[Exclude mathematical notation]'
    '--no-examples[Exclude numerical examples]'
    '--no-code[Exclude code snippets]'
    '--no-diagrams[Exclude diagrams/visualizations]'
    '--no-practice-problems[Exclude practice problems]'
    '--no-references[Exclude citations/references]'

    # Workflow modes
    '--interactive[Interactive wizard mode]'
    '-i[Interactive mode (short form)]'
    '--revise[Revision workflow (improve existing)]:file:_files'
    '--context[Include course context from materials]'

    # Standard flags
    '--dry-run[Preview output without saving]'
    '--format[Output format]:format:(markdown quarto latex qti json)'
    '--output[Custom output path]:path:_files'
    '--verbose[Show Scholar command being executed]'
    '--help[Show command help]'
  )

  # Output formats
  formats=(markdown quarto latex qti json)

  _arguments -C \
    '1:subcommand:->subcommand' \
    '*::arg:->args' \
  && return 0

  case "$state" in
    subcommand)
      _describe -t subcommands 'teach subcommand' subcommands
      ;;
    args)
      case "$line[1]" in
        # Scholar commands with topic argument
        exam|e)
          _arguments \
            '1:topic:' \
            '--questions[Number of questions]:number:' \
            '--duration[Time limit in minutes]:minutes:' \
            '--types[Question types (mc,sa,essay,calc)]:types:' \
            $scholar_flags
          ;;
        quiz|q)
          _arguments \
            '1:topic:' \
            '--questions[Number of questions]:number:' \
            '--time-limit[Time limit in minutes]:minutes:' \
            $scholar_flags
          ;;
        slides|sl)
          _arguments \
            '1:topic:' \
            '--theme[Slide theme]:theme:(default academic minimal)' \
            '--from-lecture[Generate from lecture file]:file:_files' \
            $scholar_flags
          ;;
        lecture|lec)
          _arguments \
            '1:topic:' \
            '--outline[Generate outline only]' \
            '--notes[Include speaker notes]' \
            '--from-plan[Generate from lesson plan]:week:' \
            $scholar_flags
          ;;
        assignment|hw)
          _arguments \
            '1:topic:' \
            '--due-date[Due date (YYYY-MM-DD)]:date:' \
            '--points[Total points]:points:' \
            $scholar_flags
          ;;
        syllabus|syl)
          _arguments \
            $scholar_flags
          ;;
        rubric|rb)
          _arguments \
            '1:assignment name:' \
            '--criteria[Number of criteria]:number:' \
            $scholar_flags
          ;;
        feedback|fb)
          _arguments \
            '1:student work:_files' \
            '--tone[Feedback tone]:tone:(supportive direct detailed)' \
            $scholar_flags
          ;;
        demo)
          _arguments \
            '--course-name[Course name]:name:' \
            '--force[Overwrite existing demo files]'
          ;;
        # Local commands
        init|i)
          _arguments \
            '1:course name:' \
            '-y[Non-interactive mode]' \
            '--yes[Non-interactive mode]'
          ;;
        deploy|d|archive|a)
          # No additional arguments
          ;;
        config|c|status|s|week|w|help)
          # No additional arguments
          ;;
        # Template management (v5.20.0)
        templates|tmpl|tpl)
          local -a template_subcmds
          template_subcmds=(
            'list:List all templates'
            'new:Create content from template'
            'validate:Check template syntax'
            'sync:Update from plugin defaults'
            'help:Show templates help'
          )
          _arguments -C \
            '1:action:->template_action' \
            '*::arg:->template_args' \
          && return 0
          case "$state" in
            template_action)
              _describe -t template_subcmds 'templates action' template_subcmds
              ;;
            template_args)
              case "$line[1]" in
                new)
                  _arguments \
                    '1:template type:(lecture lab slides assignment exam quiz)' \
                    '2:name:' \
                    '--topic[Topic for template]:topic:' \
                    '--week[Week number]:week:'
                  ;;
                list)
                  _arguments \
                    '--type[Filter by type]:type:(content prompts metadata checklists)' \
                    '--source[Filter by source]:source:(project plugin)'
                  ;;
              esac
              ;;
          esac
          ;;
        # Lesson plan management (v5.22.0)
        plan|pl)
          local -a plan_subcmds
          plan_subcmds=(
            'create:Add week to lesson plans'
            'c:Create (alias)'
            'new:Create (alias)'
            'list:Show all weeks in table'
            'ls:List (alias)'
            'l:List (alias)'
            'show:Display week details'
            's:Show (alias)'
            'view:Show (alias)'
            'edit:Open in $EDITOR at correct line'
            'e:Edit (alias)'
            'delete:Remove week entry'
            'del:Delete (alias)'
            'rm:Delete (alias)'
            'help:Show plan help'
          )
          _arguments -C \
            '1:action:->plan_action' \
            '*::arg:->plan_args' \
          && return 0
          case "$state" in
            plan_action)
              _describe -t plan_subcmds 'plan action' plan_subcmds
              ;;
            plan_args)
              case "$line[1]" in
                create|c|new)
                  _arguments \
                    '1:week number:' \
                    '--topic[Topic name]:topic:' \
                    '-t[Topic (short form)]:topic:' \
                    '--style[Content style]:style:(conceptual computational rigorous applied)' \
                    '-s[Style (short form)]:style:(conceptual computational rigorous applied)' \
                    '--force[Overwrite existing week]' \
                    '-f[Force (short form)]'
                  ;;
                list|ls|l)
                  _arguments \
                    '--json[Output as JSON array]' \
                    '-j[JSON output (short form)]'
                  ;;
                show|s|view)
                  _arguments \
                    '1:week number:' \
                    '--json[Output as JSON object]' \
                    '-j[JSON output (short form)]'
                  ;;
                edit|e)
                  _arguments \
                    '1:week number:'
                  ;;
                delete|del|rm)
                  _arguments \
                    '1:week number:' \
                    '--force[Skip confirmation]' \
                    '-f[Force (short form)]'
                  ;;
              esac
              ;;
          esac
          ;;
        # LaTeX macro management (v5.21.0)
        macros|macro|m)
          local -a macro_subcmds
          macro_subcmds=(
            'list:List all macros with examples'
            'ls:List (alias)'
            'l:List (alias)'
            'sync:Sync macros from source files'
            's:Sync (alias)'
            'export:Export macros in various formats'
            'e:Export (alias)'
            'x:Export (alias)'
            'help:Show macros help'
          )
          _arguments -C \
            '1:action:->macro_action' \
            '*::arg:->macro_args' \
          && return 0
          case "$state" in
            macro_action)
              _describe -t macro_subcmds 'macros action' macro_subcmds
              ;;
            macro_args)
              case "$line[1]" in
                list|ls|l)
                  _arguments \
                    '--all[Show all macros including hidden]' \
                    '-a[Show all (short form)]' \
                    '--category[Filter by category]:category:(operators distributions estimators tests greek formatting)' \
                    '--json[Output as JSON]' \
                    '-j[JSON output (short form)]'
                  ;;
                sync|s)
                  _arguments \
                    '--force[Force sync even if up to date]' \
                    '-f[Force (short form)]' \
                    '--verbose[Show detailed output]' \
                    '-v[Verbose (short form)]'
                  ;;
                export|e|x)
                  _arguments \
                    '--format[Export format]:format:(json mathjax latex qmd)' \
                    '-f[Format (short form)]:format:(json mathjax latex qmd)' \
                    '--json[Export as JSON]' \
                    '-j[JSON (short form)]' \
                    '--mathjax[Export as MathJax config]' \
                    '-m[MathJax (short form)]' \
                    '--latex[Export as LaTeX newcommand]' \
                    '-l[LaTeX (short form)]' \
                    '--qmd[Export as Quarto include]' \
                    '-q[Quarto (short form)]'
                  ;;
              esac
              ;;
          esac
          ;;
      esac
      ;;
  esac
}

_teach "$@"
